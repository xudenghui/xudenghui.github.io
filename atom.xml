<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Zhisheng的博客</title>
  <subtitle>永远不要跟别人比幸运，我从来没想过我比别人幸运，我也许比他们更有毅力，在最困难的时候，他们熬不住了，我可以多熬一秒钟、两秒钟。</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2017-07-14T11:25:37.314Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>Zhisheng Tian</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>看透 Spring MVC 源代码分析与实践 ——  俯视 Spring MVC</title>
    <link href="http://yoursite.com/2017/07/14/Spring-MVC02/"/>
    <id>http://yoursite.com/2017/07/14/Spring-MVC02/</id>
    <published>2017-07-14T11:15:25.357Z</published>
    <updated>2017-07-14T11:25:37.314Z</updated>
    
    <content type="html"><![CDATA[<p>Spring MVC</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/spring-mvc.png" alt="spring-mvc"><br><a id="more"></a></p>
<h3 id="Spring-MVC-之初体验"><a href="#Spring-MVC-之初体验" class="headerlink" title="Spring MVC 之初体验"></a>Spring MVC 之初体验</h3><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4><p>在 IDEA 中新建一个 web 项目，用 Maven 管理项目的话，在 pom.xml 中加入 Spring MVC 和 Servlet 依赖即可。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.springframework/spring-webmvc --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.9.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/javax.servlet/javax.servlet-api --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="Spring-MVC-简单配置"><a href="#Spring-MVC-简单配置" class="headerlink" title="Spring MVC 简单配置"></a>Spring MVC 简单配置</h4><ul>
<li>在 web.xml 中配置 Servlet</li>
<li>创建 Spring MVC 的 xml 配置文件</li>
<li>创建 Controller 和 View</li>
</ul>
<p>1、web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- Spring MVC配置 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- ====================================== --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 可以自定义servlet.xml配置文件的位置和名称，默认为WEB-INF目录下，名称为[&lt;servlet-name&gt;]-servlet.xml，如spring-servlet.xml</span></div><div class="line">    &lt;init-param&gt;</div><div class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</div><div class="line">        &lt;param-value&gt;/WEB-INF/spring-servlet.xml&lt;/param-value&gt;&amp;nbsp; 默认</div><div class="line">    &lt;/init-param&gt;</div><div class="line">    --&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- Spring配置 --&gt;</span></div><div class="line"><span class="comment">&lt;!-- ====================================== --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">listener</span>&gt;</span></div><div class="line">   <span class="tag">&lt;<span class="name">listenerclass</span>&gt;</span></div><div class="line">     org.springframework.web.context.ContextLoaderListener</div><div class="line">   <span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">listener</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 指定Spring Bean的配置文件所在目录。默认配置在WEB-INF目录下 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:config/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2、spring-servlet.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">        <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">   <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></div><div class="line">       http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.0.xsd</div><div class="line">       http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-3.0.xsd</div><div class="line">       http://www.springframework.org/schema/context &lt;a href="<span class="attr">http:</span>//<span class="attr">www.springframework.org</span>/<span class="attr">schema</span>/<span class="attr">context</span>/<span class="attr">spring-context-3.0.xsd</span>"&gt;http://www.springframework.org/schema/context/spring-context-3.0.xsd<span class="tag">&lt;/<span class="name">a</span>&gt;</span>"&gt;</div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 启用spring mvc 注解 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span> /&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 设置使用注解的类所在的jar包 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="comment">&lt;!-- 完成请求和注解POJO的映射 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.mvc.annotation.AnnotationMethodHandlerAdapter"</span> /&gt;</span></div><div class="line">　　</div><div class="line">    <span class="comment">&lt;!-- 对转向页面的路径解析。prefix：前缀， suffix：后缀 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span> <span class="attr">p:prefix</span>=<span class="string">"/jsp/"</span> <span class="attr">p:suffix</span>=<span class="string">".jsp"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<p>3、Controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> controller;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpServletRequest;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</div><div class="line"></div><div class="line"><span class="keyword">import</span> entity.User;</div><div class="line"></div><div class="line"><span class="meta">@Controller</span>  <span class="comment">//类似Struts的Action</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/login.do"</span>)  <span class="comment">// 请求url地址映射，类似Struts的action-mapping</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testLogin</span><span class="params">(@RequestParam(value=<span class="string">"username"</span>)</span>String username, String password, HttpServletRequest request) </span>&#123;</div><div class="line">        <span class="comment">// @RequestParam是指请求url地址映射中必须含有的参数(除非属性 required=false, 默认为 true)</span></div><div class="line">        <span class="comment">// @RequestParam可简写为：@RequestParam("username")</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!<span class="string">"admin"</span>.equals(username) || !<span class="string">"admin"</span>.equals(password)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"loginError"</span>; <span class="comment">// 跳转页面路径（默认为转发），该路径不需要包含spring-servlet配置文件中配置的前缀和后缀</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"loginSuccess"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/login2.do"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testLogin2</span><span class="params">(String username, String password, <span class="keyword">int</span> age)</span></span>&#123;</div><div class="line">        <span class="comment">// request和response不必非要出现在方法中，如果用不上的话可以去掉</span></div><div class="line">        <span class="comment">// 参数的名称是与页面控件的name相匹配，参数类型会自动被转换</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!<span class="string">"admin"</span>.equals(username) || !<span class="string">"admin"</span>.equals(password) || age &lt; <span class="number">5</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"loginError"</span>); <span class="comment">// 手动实例化ModelAndView完成跳转页面（转发），效果等同于上面的方法返回字符串</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="keyword">new</span> RedirectView(<span class="string">"../index.jsp"</span>));  <span class="comment">// 采用重定向方式跳转页面</span></div><div class="line">        <span class="comment">// 重定向还有一种简单写法</span></div><div class="line">        <span class="comment">// return new ModelAndView("redirect:../index.jsp");</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/login3.do"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testLogin3</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        <span class="comment">// 同样支持参数为表单对象，类似于Struts的ActionForm，User不需要任何配置，直接写即可</span></div><div class="line">        String username = user.getUsername();</div><div class="line">        String password = user.getPassword();</div><div class="line">        <span class="keyword">int</span> age = user.getAge();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!<span class="string">"admin"</span>.equals(username) || !<span class="string">"admin"</span>.equals(password) || age &lt; <span class="number">5</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"loginError"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="string">"loginSuccess"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Resource</span>(name = <span class="string">"loginService"</span>)  <span class="comment">// 获取applicationContext.xml中bean的id为loginService的，并注入</span></div><div class="line">    <span class="keyword">private</span> LoginService loginService;  <span class="comment">//等价于spring传统注入方式写get和set方法，这样的好处是简洁工整，省去了不必要得代码</span></div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/test/login4.do"</span>)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testLogin4</span><span class="params">(User user)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (loginService.login(user) == <span class="keyword">false</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"loginError"</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"loginSuccess"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>@RequestMapping 可以写在方法上，也可以写在类上，上面代码方法上的 RequestMapping 都含有 <code>/test</code> ， 那么我们就可以将其抽出直接写在类上，那么方法里面就不需要写 <code>/test</code> 了。</p>
<p>如下即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/test"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/login.do"</span>)  <span class="comment">// 请求url地址映射，类似Struts的action-mapping</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testLogin</span><span class="params">(@RequestParam(value=<span class="string">"username"</span>)</span>String username, String password, HttpServletRequest request) </span>&#123;</div><div class="line">        <span class="comment">// @RequestParam是指请求url地址映射中必须含有的参数(除非属性 required=false, 默认为 true)</span></div><div class="line">        <span class="comment">// @RequestParam可简写为：@RequestParam("username")</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!<span class="string">"admin"</span>.equals(username) || !<span class="string">"admin"</span>.equals(password)) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"loginError"</span>; <span class="comment">// 跳转页面路径（默认为转发），该路径不需要包含spring-servlet配置文件中配置的前缀和后缀</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="string">"loginSuccess"</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//省略其他的</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面的代码方法的参数中可以看到有一个 <code>@RequestParam</code> 注解，其实还有 <code>@PathVariable</code> 。这两个的区别是啥呢？</p>
<ul>
<li><code>@PathVariable</code> 标记在方法的参数上，利用它标记的参数可以利用请求路径传值。</li>
<li>@RequestParam是指请求url地址映射中必须含有的参数(除非属性 required=false, 默认为 true)</li>
</ul>
<p>看如下例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user/&#123;userId&#125;"</span>)  <span class="comment">// 请求url地址映射</span></div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">userinfo</span><span class="params">(Model model, @PathVariable(<span class="string">"userId"</span>)</span> <span class="keyword">int</span> userId,  HttpSession session) </span>&#123;</div><div class="line">         System.out.println(<span class="string">"进入  userinfo  页面"</span>);</div><div class="line">        <span class="comment">//判断是否有用户登录</span></div><div class="line">        User user1 = (User) session.getAttribute(<span class="string">"user"</span>);</div><div class="line">        <span class="keyword">if</span> (user1 == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">"login"</span>;</div><div class="line">        &#125;</div><div class="line">        User user = userService.selectUserById(userId);</div><div class="line">        model.addAttribute(<span class="string">"user"</span>, user);</div><div class="line">        <span class="keyword">return</span> <span class="string">"userinfo"</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>上面例子中如果浏览器请求的是 <code>/user/1</code>  的时候，就表示此时的用户 id 为 1，此时就会先从 session 中查找是否有 “user” 属性，如果有的话，就代表用户此时处于登录的状态，如果没有的话，就会让用户返回到登录页面，这种机制在各种网站经常会使用的，然后根据这个 id = 1 ，去查找用户的信息，然后把查找的 “user” 放在 model 中，然后返回用户详情页面，最后在页面中用 <code>$!{user.name}</code> 获取用户的名字，同样的方式可以获取用户的其他信息，把所有的用户详情信息展示出来。</p>
<h3 id="创建-Spring-MVC-之器"><a href="#创建-Spring-MVC-之器" class="headerlink" title="创建 Spring MVC 之器"></a>创建 Spring MVC 之器</h3><p>Spring MVC 核心 Servlet 架构图如下：</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/spring-mvc1.jpg" alt="spring-mvc1"></p>
<p>Java 中常用的 Servlet 我在另外一篇文章写的很清楚了，有兴趣的请看：<a href="http://www.54tianzhisheng.cn/2017/07/09/servlet/" target="_blank" rel="external">通过源码详解 Servlet</a>  ，这里我就不再解释了。</p>
<p>这里主要讲 Spring 中的 HttpServletBean、FrameworkServlet、DispatcherServlet 这三个类的创建过程。</p>
<p>通过上面的图，可以看到这三个类直接实现三个接口：EnvironmentCapable、EnvironmentAware、ApplicationContextAware。下面我们直接看下这三个接口的内部是怎样写的。</p>
<p>EnvironmentCapable.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EnvironmentCapable</span> </span>&#123;</div><div class="line">    <span class="comment">//返回组件的环境，可能返回 null 或者默认环境</span></div><div class="line">    <span class="meta">@Nullable</span></div><div class="line">    <span class="function">Environment <span class="title">getEnvironment</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>EnvironmentAware.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EnvironmentAware</span> <span class="keyword">extends</span> <span class="title">Aware</span> </span>&#123;</div><div class="line">    <span class="comment">//设置组件的运行环境</span></div><div class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setEnvironment</span><span class="params">(Environment environment)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ApplicationContextAware.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public interface ApplicationContextAware extends Aware &#123;</div><div class="line">    //设置运行对象的应用上下文</div><div class="line">    //当类实现这个接口后，这个类可以获取ApplicationContext中所有的bean，也就是说这个类可以直接获取Spring配置文件中所有有引用到的bean对象</div><div class="line">    void setApplicationContext(ApplicationContext applicationContext) throws BeansException;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>怎么使用这个这个接口呢？</p>
<p>参考文章：<a href="http://blog.csdn.net/kaiwii/article/details/6872642" target="_blank" rel="external">org.springframework.context.ApplicationContextAware使用理解</a></p>
<p><strong>HttpServletBean</strong></p>
<p>这里就直接看其中最重要的 init() 方法的代码了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 将配置参数映射到此servlet的bean属性，并调用子类初始化。</div><div class="line"> *  如果 bean 配置不合法（或者需要的参数丢失）或者子类初始化发生错误，那么就会抛出 ServletException 异常</div><div class="line"> */</div><div class="line"><span class="meta">@Override</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">   <span class="comment">//日志代码删除了</span></div><div class="line"></div><div class="line">   <span class="comment">// 从init参数设置bean属性。</span></div><div class="line">   <span class="comment">//获得web.xml中的contextConfigLocation配置属性，就是spring MVC的配置文件</span></div><div class="line">   PropertyValues pvs = <span class="keyword">new</span> ServletConfigPropertyValues(getServletConfig(), <span class="keyword">this</span>.requiredProperties);</div><div class="line">   <span class="keyword">if</span> (!pvs.isEmpty()) &#123;</div><div class="line">      <span class="keyword">try</span> &#123;</div><div class="line">         BeanWrapper bw = PropertyAccessorFactory.forBeanPropertyAccess(<span class="keyword">this</span>);</div><div class="line">         <span class="comment">//获取服务器的各种信息</span></div><div class="line">         ResourceLoader resourceLoader = <span class="keyword">new</span> ServletContextResourceLoader(getServletContext());</div><div class="line">         bw.registerCustomEditor(Resource.class, <span class="keyword">new</span> ResourceEditor(resourceLoader, getEnvironment()));</div><div class="line">         <span class="comment">//模板方法，可以在子类中调用，做一些初始化工作，bw代表DispatcherServelt</span></div><div class="line">         initBeanWrapper(bw);</div><div class="line">         <span class="comment">//将配置的初始化值设置到DispatcherServlet中</span></div><div class="line">         bw.setPropertyValues(pvs, <span class="keyword">true</span>);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">catch</span> (BeansException ex) &#123;</div><div class="line">         <span class="comment">//日志代码</span></div><div class="line">         <span class="keyword">throw</span> ex;</div><div class="line">      &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="comment">// Let subclasses do whatever initialization they like.</span></div><div class="line">   <span class="comment">//模板方法，子类初始化的入口方法</span></div><div class="line">   initServletBean();</div><div class="line"></div><div class="line">   <span class="comment">//日志代码删除了</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>FrameworkServlet</strong></p>
<p>其中重要方法如下：里面也就两句关键代码，日志代码我直接删掉了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">initServletBean</span><span class="params">()</span> <span class="keyword">throws</span> ServletException </span>&#123;</div><div class="line">        <span class="comment">//日志代码删除了</span></div><div class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</div><div class="line"></div><div class="line">        <span class="comment">//就是 try 语句里面有两句关键代码</span></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//初始化 webApplicationContext</span></div><div class="line">            <span class="keyword">this</span>.webApplicationContext = initWebApplicationContext();</div><div class="line">            <span class="comment">//模板方法，</span></div><div class="line">            initFrameworkServlet();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">catch</span> (ServletException ex) &#123;</div><div class="line">            <span class="keyword">this</span>.logger.error(<span class="string">"Context initialization failed"</span>, ex);</div><div class="line">            <span class="keyword">throw</span> ex;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">catch</span> (RuntimeException ex) &#123;</div><div class="line">            <span class="keyword">this</span>.logger.error(<span class="string">"Context initialization failed"</span>, ex);</div><div class="line">            <span class="keyword">throw</span> ex;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">//日志代码删除了</span></div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>再来看看上面代码中调用的 initWebApplicationContext() 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> WebApplicationContext <span class="title">initWebApplicationContext</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//获取 rootContext</span></div><div class="line">        WebApplicationContext rootContext =</div><div class="line">                WebApplicationContextUtils.getWebApplicationContext(getServletContext());</div><div class="line">        WebApplicationContext wac = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.webApplicationContext != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// 上下文实例在构造时注入 - &gt;使用它</span></div><div class="line">            wac = <span class="keyword">this</span>.webApplicationContext;</div><div class="line">            <span class="keyword">if</span> (wac <span class="keyword">instanceof</span> ConfigurableWebApplicationContext) &#123;</div><div class="line">                ConfigurableWebApplicationContext cwac = (ConfigurableWebApplicationContext) wac;</div><div class="line">                <span class="keyword">if</span> (!cwac.isActive()) &#123;</div><div class="line">                <span class="comment">// 如果上下文尚未刷新 -&gt; 提供诸如设置父上下文，设置应用程序上下文ID等服务</span></div><div class="line">                    <span class="keyword">if</span> (cwac.getParent() == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// 上下文实例被注入没有显式的父类 -&gt; 将根应用程序上下文（如果有的话可能为null）设置为父级</span></div><div class="line">                        cwac.setParent(rootContext);</div><div class="line">                    &#125;</div><div class="line">                    configureAndRefreshWebApplicationContext(cwac);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (wac == <span class="keyword">null</span>) &#123;</div><div class="line">    <span class="comment">// 当 WebApplicationContext 已经存在 ServletContext 中时，通过配置在 servlet 中的 ContextAttribute 参数获取</span></div><div class="line">            wac = findWebApplicationContext();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (wac == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// 如果 WebApplicationContext 还没有创建，则创建一个</span></div><div class="line">            wac = createWebApplicationContext(rootContext);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.refreshEventReceived) &#123;</div><div class="line">            <span class="comment">// 当 ContextRefreshedEvent 事件没有触发时调用此方法，模板方法，可以在子类重写</span></div><div class="line">            onRefresh(wac);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.publishContext) &#123;</div><div class="line">            <span class="comment">// 将 ApplicationContext 保存到 ServletContext 中去</span></div><div class="line">            String attrName = getServletContextAttributeName();</div><div class="line">            getServletContext().setAttribute(attrName, wac);</div><div class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.logger.isDebugEnabled()) &#123;</div><div class="line">                <span class="keyword">this</span>.logger.debug(<span class="string">"Published WebApplicationContext of servlet '"</span> + getServletName() +</div><div class="line">                        <span class="string">"' as ServletContext attribute with name ["</span> + attrName + <span class="string">"]"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wac;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>initWebApplicationContext 方法做了三件事：</p>
<ul>
<li>获取 Spring 的根容器 rootContext</li>
<li>设置 webApplicationContext 并根据情况调用 onRefresh 方法</li>
<li>将 webApplicationContext 设置到 ServletContext 中</li>
</ul>
<p>这里在讲讲上面代码中的 wac == null 的几种情况：</p>
<p>1）、当 WebApplicationContext 已经存在 ServletContext 中时，通过配置在 servlet 中的 ContextAttribute 参数获取，调用的是 findWebApplicationContext() 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> WebApplicationContext <span class="title">findWebApplicationContext</span><span class="params">()</span> </span>&#123;</div><div class="line">        String attrName = getContextAttribute();</div><div class="line">        <span class="keyword">if</span> (attrName == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">        WebApplicationContext wac =</div><div class="line">                WebApplicationContextUtils.getWebApplicationContext(getServletContext(), attrName);</div><div class="line">        <span class="keyword">if</span> (wac == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"No WebApplicationContext found: initializer not registered?"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> wac;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>2)、如果 WebApplicationContext 还没有创建，调用的是 createWebApplicationContext 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> WebApplicationContext <span class="title">createWebApplicationContext</span><span class="params">(@Nullable ApplicationContext parent)</span> </span>&#123;</div><div class="line">        <span class="comment">//获取创建类型</span></div><div class="line">        Class&lt;?&gt; contextClass = getContextClass();</div><div class="line">        <span class="comment">//删除了打印日志代码</span></div><div class="line"></div><div class="line">        <span class="comment">//检查创建类型</span></div><div class="line">        <span class="keyword">if</span> (!ConfigurableWebApplicationContext.class.isAssignableFrom(contextClass)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ApplicationContextException(</div><div class="line">                    <span class="string">"Fatal initialization error in servlet with name '"</span> + getServletName() +</div><div class="line">                    <span class="string">"': custom WebApplicationContext class ["</span> + contextClass.getName() +</div><div class="line">                    <span class="string">"] is not of type ConfigurableWebApplicationContext"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//具体创建</span></div><div class="line">        ConfigurableWebApplicationContext wac =</div><div class="line">                (ConfigurableWebApplicationContext) BeanUtils.instantiateClass(contextClass);</div><div class="line"></div><div class="line">        wac.setEnvironment(getEnvironment());</div><div class="line">        wac.setParent(parent);</div><div class="line">  <span class="comment">//并设置的 contextConfigLocation 参数传给 wac，默认是 WEB-INFO/[ServletName]-Servlet.xml</span></div><div class="line">        wac.setConfigLocation(getContextConfigLocation());</div><div class="line"></div><div class="line">        <span class="comment">//调用的是下面的方法</span></div><div class="line">        configureAndRefreshWebApplicationContext(wac);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> wac;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configureAndRefreshWebApplicationContext</span><span class="params">(ConfigurableWebApplicationContext wac)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (ObjectUtils.identityToString(wac).equals(wac.getId())) &#123;</div><div class="line">            <span class="comment">// The application context id is still set to its original default value</span></div><div class="line">            <span class="comment">// -&gt; assign a more useful id based on available information</span></div><div class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.contextId != <span class="keyword">null</span>) &#123;</div><div class="line">                wac.setId(<span class="keyword">this</span>.contextId);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// Generate default id...</span></div><div class="line">                wac.setId(ConfigurableWebApplicationContext.APPLICATION_CONTEXT_ID_PREFIX +</div><div class="line">                        ObjectUtils.getDisplayString(getServletContext().getContextPath()) + <span class="string">'/'</span> + getServletName());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        wac.setServletContext(getServletContext());</div><div class="line">        wac.setServletConfig(getServletConfig());</div><div class="line">        wac.setNamespace(getNamespace());</div><div class="line">        wac.addApplicationListener(<span class="keyword">new</span> SourceFilteringListener(wac, <span class="keyword">new</span> ContextRefreshListener()));</div><div class="line"></div><div class="line">        <span class="comment">// The wac environment's #initPropertySources will be called in any case when the context</span></div><div class="line">        <span class="comment">// is refreshed; do it eagerly here to ensure servlet property sources are in place for</span></div><div class="line">        <span class="comment">// use in any post-processing or initialization that occurs below prior to #refresh</span></div><div class="line">        ConfigurableEnvironment env = wac.getEnvironment();</div><div class="line">        <span class="keyword">if</span> (env <span class="keyword">instanceof</span> ConfigurableWebEnvironment) &#123;</div><div class="line">            ((ConfigurableWebEnvironment) env).initPropertySources(getServletContext(), getServletConfig());</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        postProcessWebApplicationContext(wac);</div><div class="line">        applyInitializers(wac);</div><div class="line">        wac.refresh();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>里面还有 doXXX() 方法，大家感兴趣的可以去看看。</p>
<p><strong>DispatcherServlet</strong></p>
<p>DispatcherServlet 继承自 FrameworkServlet，onRefresh 方法是 DispatcherServlet 的入口方法，在 initStrategies 方法中调用了 9 个初始化的方法。</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/onrefresh.jpg" alt="onrefresh"></p>
<p>这里分析其中一个初始化方法：initLocaleResolver() 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initLocaleResolver</span><span class="params">(ApplicationContext context)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//在 context 中获取</span></div><div class="line">            <span class="keyword">this</span>.localeResolver = context.getBean(LOCALE_RESOLVER_BEAN_NAME, LocaleResolver.class);</div><div class="line">            <span class="comment">//删除了打印日志的代码</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</div><div class="line">            <span class="comment">//使用默认的策略</span></div><div class="line">            <span class="keyword">this</span>.localeResolver = getDefaultStrategy(context, LocaleResolver.class);</div><div class="line">            <span class="comment">//删除了打印日志的代码</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>查看默认策略代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">protected</span> &lt;T&gt; <span class="function">T <span class="title">getDefaultStrategy</span><span class="params">(ApplicationContext context, Class&lt;T&gt; strategyInterface)</span> </span>&#123;</div><div class="line">        <span class="comment">//调用 getDefaultStrategies 方法</span></div><div class="line">        List&lt;T&gt; strategies = getDefaultStrategies(context, strategyInterface);</div><div class="line">        <span class="keyword">if</span> (strategies.size() != <span class="number">1</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> BeanInitializationException(</div><div class="line">                    <span class="string">"DispatcherServlet needs exactly 1 strategy for interface ["</span> + strategyInterface.getName() + <span class="string">"]"</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> strategies.get(<span class="number">0</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Create a List of default strategy objects for the given strategy interface.</div><div class="line">     * &lt;p&gt;The default implementation uses the "DispatcherServlet.properties" file (in the same</div><div class="line">     * package as the DispatcherServlet class) to determine the class names. It instantiates</div><div class="line">     * the strategy objects through the context's BeanFactory.</div><div class="line">     */</div><div class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">    <span class="keyword">protected</span> &lt;T&gt; <span class="function">List&lt;T&gt; <span class="title">getDefaultStrategies</span><span class="params">(ApplicationContext context, Class&lt;T&gt; strategyInterface)</span> </span>&#123;</div><div class="line">        String key = strategyInterface.getName();</div><div class="line">        <span class="comment">//根据策略接口的名字从 defaultStrategies 获取所需策略的类型</span></div><div class="line">        String value = defaultStrategies.getProperty(key);</div><div class="line">        <span class="keyword">if</span> (value != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">//如果有多个默认值的话，就以逗号分隔为数组</span></div><div class="line">            String[] classNames = StringUtils.commaDelimitedListToStringArray(value);</div><div class="line">            List&lt;T&gt; strategies = <span class="keyword">new</span> ArrayList&lt;&gt;(classNames.length);</div><div class="line">            <span class="comment">//按获取到的类型初始化策略</span></div><div class="line">            <span class="keyword">for</span> (String className : classNames) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    Class&lt;?&gt; clazz = ClassUtils.forName(className, DispatcherServlet.class.getClassLoader());</div><div class="line">                    Object strategy = createDefaultStrategy(context, clazz);</div><div class="line">                    strategies.add((T) strategy);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">catch</span> (ClassNotFoundException ex) &#123;</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> BeanInitializationException(</div><div class="line">                            <span class="string">"Could not find DispatcherServlet's default strategy class ["</span> + className + <span class="string">"] for interface ["</span> + key + <span class="string">"]"</span>, ex);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">catch</span> (LinkageError err) &#123;</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> BeanInitializationException(</div><div class="line">                            <span class="string">"Error loading DispatcherServlet's default strategy class ["</span> + className + <span class="string">"] for interface ["</span> + key + <span class="string">"]: problem with class file or dependent class"</span>, err);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> strategies;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">new</span> LinkedList&lt;&gt;();</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>其他几个方法大概也类似，我就不再写了。</p>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><p>主要讲了 Spring MVC 自身创建过程，分析了 Spring MVC 中 Servlet 的三个层次：HttpServletBean、FrameworkServlet 和 DispatcherServlet。HttpServletBean 继承自 Java 的 HttpServlet，其作用是将配置的参数设置到相应的属性上；FrameworkServlet 初始化了 WebApplicationContext；DispatcherServlet 初始化了自身的 9 个组件。</p>
<h3 id="Spring-MVC-之用"><a href="#Spring-MVC-之用" class="headerlink" title="Spring MVC 之用"></a>Spring MVC 之用</h3><p>分析 Spring MVC 是怎么处理请求的。首先分析 HttpServletBean、FrameworkServlet 和 DispatcherServlet 这三个 Servlet 的处理过程，最后分析 doDispatcher 的结构。</p>
<p><strong>HttpServletBean</strong></p>
<p>参与了创建工作，并没有涉及请求的处理。</p>
<p><strong>FrameworkServlet</strong></p>
<p>在类中的 service() 、doGet()、doPost()、doPut()、doDelete()、doOptions()、doTrace() 这些方法中可以看到都调用了一个共同的方法 processRequest() ，它是类在处理请求中最核心的方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">processRequest</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span></span></div><div class="line">            <span class="keyword">throws</span> ServletException, IOException &#123;</div><div class="line"></div><div class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</div><div class="line">        Throwable failureCause = <span class="keyword">null</span>;</div><div class="line">        <span class="comment">//获取 LocaleContextHolder 中原来保存的 LocaleContext</span></div><div class="line">        LocaleContext previousLocaleContext = LocaleContextHolder.getLocaleContext();</div><div class="line">        <span class="comment">//获取当前请求的 LocaleContext</span></div><div class="line">        LocaleContext localeContext = buildLocaleContext(request);</div><div class="line">        <span class="comment">//获取 RequestContextHolder 中原来保存的 RequestAttributes</span></div><div class="line">        RequestAttributes previousAttributes = RequestContextHolder.getRequestAttributes();</div><div class="line">        <span class="comment">//获取当前请求的 ServletRequestAttributes</span></div><div class="line">        ServletRequestAttributes requestAttributes = buildRequestAttributes(request, response, previousAttributes);</div><div class="line"></div><div class="line">        WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</div><div class="line">        asyncManager.registerCallableInterceptor(FrameworkServlet.class.getName(), <span class="keyword">new</span> RequestBindingInterceptor());</div><div class="line"><span class="comment">//将当前请求的 LocaleContext 和 ServletRequestAttributes 设置到 LocaleContextHolder 和 RequestContextHolder</span></div><div class="line">        initContextHolders(request, localeContext, requestAttributes);</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//实际处理请求的入口，这是一个模板方法，在 Dispatcher 类中才有具体实现</span></div><div class="line">            doService(request, response);</div><div class="line">        &#125;<span class="keyword">catch</span> (ServletException ex) &#123;</div><div class="line">            failureCause = ex;</div><div class="line">            <span class="keyword">throw</span> ex;</div><div class="line">        &#125;<span class="keyword">catch</span> (IOException ex) &#123;</div><div class="line">            failureCause = ex;</div><div class="line">            <span class="keyword">throw</span> ex;</div><div class="line">        &#125;<span class="keyword">catch</span> (Throwable ex) &#123;</div><div class="line">            failureCause = ex;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> NestedServletException(<span class="string">"Request processing failed"</span>, ex);</div><div class="line">        &#125;<span class="keyword">finally</span> &#123;</div><div class="line">            <span class="comment">//将 previousLocaleContext，previousAttributes 恢复到 LocaleContextHolder 和 RequestContextHolder 中</span></div><div class="line">            resetContextHolders(request, previousLocaleContext, previousAttributes);</div><div class="line">            <span class="keyword">if</span> (requestAttributes != <span class="keyword">null</span>) &#123;</div><div class="line">                requestAttributes.requestCompleted();</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//删除了日志打印代码</span></div><div class="line">            <span class="comment">//发布了一个 ServletRequestHandledEvent 类型的消息</span></div><div class="line">            publishRequestHandledEvent(request, response, startTime, failureCause);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>DispatcherServlet</strong></p>
<p>上一章中其实还没把该类讲清楚，在这个类中，里面的智行处理的入口方法应该是 doService 方法，方法里面调用了 doDispatch 进行具体的处理，在调用 doDispatch  方法之前  doService 做了一些事情：首先判断是不是 include 请求，如果是则对 request 的 Attribute 做个快照备份，等 doDispatcher 处理完之后（如果不是异步调用且未完成）进行还原 ，在做完快照后又对 request 设置了一些属性。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doService</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        <span class="comment">// Keep a snapshot of the request attributes in case of an include,</span></div><div class="line">        <span class="comment">// to be able to restore the original attributes after the include.</span></div><div class="line">        Map&lt;String, Object&gt; attributesSnapshot = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">if</span> (WebUtils.isIncludeRequest(request)) &#123;</div><div class="line">            attributesSnapshot = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">            Enumeration&lt;?&gt; attrNames = request.getAttributeNames();</div><div class="line">            <span class="keyword">while</span> (attrNames.hasMoreElements()) &#123;</div><div class="line">                String attrName = (String) attrNames.nextElement();</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">this</span>.cleanupAfterInclude || attrName.startsWith(DEFAULT_STRATEGIES_PREFIX))&#123;</div><div class="line">                    attributesSnapshot.put(attrName, request.getAttribute(attrName));</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// Make framework objects available to handlers and view objects.</span></div><div class="line">        request.setAttribute(WEB_APPLICATION_CONTEXT_ATTRIBUTE, getWebApplicationContext());</div><div class="line">        request.setAttribute(LOCALE_RESOLVER_ATTRIBUTE, <span class="keyword">this</span>.localeResolver);</div><div class="line">        request.setAttribute(THEME_RESOLVER_ATTRIBUTE, <span class="keyword">this</span>.themeResolver);</div><div class="line">        request.setAttribute(THEME_SOURCE_ATTRIBUTE, getThemeSource());</div><div class="line"></div><div class="line">        FlashMap inputFlashMap = <span class="keyword">this</span>.flashMapManager.retrieveAndUpdate(request, response);</div><div class="line">        <span class="keyword">if</span> (inputFlashMap != <span class="keyword">null</span>) &#123;</div><div class="line">            request.setAttribute(INPUT_FLASH_MAP_ATTRIBUTE, Collections.unmodifiableMap(inputFlashMap));</div><div class="line">        &#125;</div><div class="line">        request.setAttribute(OUTPUT_FLASH_MAP_ATTRIBUTE, <span class="keyword">new</span> FlashMap());</div><div class="line">        request.setAttribute(FLASH_MAP_MANAGER_ATTRIBUTE, <span class="keyword">this</span>.flashMapManager);</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//调用 doDispatch 方法</span></div><div class="line">            doDispatch(request, response);</div><div class="line">        &#125;<span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">if</span> (!WebAsyncUtils.getAsyncManager(request).isConcurrentHandlingStarted()) &#123;</div><div class="line">                <span class="comment">// Restore the original attribute snapshot, in case of an include.</span></div><div class="line">                <span class="keyword">if</span> (attributesSnapshot != <span class="keyword">null</span>) &#123;</div><div class="line">                    restoreAttributesAfterInclude(request, attributesSnapshot);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>doDispatch() 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doDispatch</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        HttpServletRequest processedRequest = request;</div><div class="line">        HandlerExecutionChain mappedHandler = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">boolean</span> multipartRequestParsed = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        WebAsyncManager asyncManager = WebAsyncUtils.getAsyncManager(request);</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ModelAndView mv = <span class="keyword">null</span>;</div><div class="line">            Exception dispatchException = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="comment">//检查是不是上传请求</span></div><div class="line">                processedRequest = checkMultipart(request);</div><div class="line">                multipartRequestParsed = (processedRequest != request);</div><div class="line"></div><div class="line">                <span class="comment">// Determine handler for the current request.  根据 request 找到 Handler</span></div><div class="line">                mappedHandler = getHandler(processedRequest);</div><div class="line">                <span class="keyword">if</span> (mappedHandler == <span class="keyword">null</span> || mappedHandler.getHandler() == <span class="keyword">null</span>) &#123;</div><div class="line">                    noHandlerFound(processedRequest, response);</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line"></div><div class="line">    <span class="comment">// Determine handler adapter for the current request.根据 Handler 找到对应的 HandlerAdapter</span></div><div class="line">                HandlerAdapter ha = getHandlerAdapter(mappedHandler.getHandler());</div><div class="line">                <span class="comment">// Process last-modified header, if supported by the handler.</span></div><div class="line">                <span class="comment">//处理 GET 、 HEAD 请求的 LastModified</span></div><div class="line">                String method = request.getMethod();</div><div class="line">                <span class="keyword">boolean</span> isGet = <span class="string">"GET"</span>.equals(method);</div><div class="line">                <span class="keyword">if</span> (isGet || <span class="string">"HEAD"</span>.equals(method)) &#123;</div><div class="line">                    <span class="keyword">long</span> lastModified = ha.getLastModified(request, mappedHandler.getHandler());</div><div class="line">                    <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</div><div class="line">                        logger.debug(<span class="string">"Last-Modified value for ["</span> + getRequestUri(request) + <span class="string">"] is: "</span> + lastModified);</div><div class="line">                    &#125;</div><div class="line">                    <span class="keyword">if</span> (<span class="keyword">new</span> ServletWebRequest(request, response).checkNotModified(lastModified) &amp;&amp; isGet) &#123;</div><div class="line">                        <span class="keyword">return</span>;</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//执行相应的 Interceptor 的 preHandle</span></div><div class="line">                <span class="keyword">if</span> (!mappedHandler.applyPreHandle(processedRequest, response)) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">// Actually invoke the handler. HandlerAdapter 使用 Handler 处理请求</span></div><div class="line">                mv = ha.handle(processedRequest, response, mappedHandler.getHandler());</div><div class="line">                <span class="comment">//如果需要异步处理，直接返回</span></div><div class="line">                <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</div><div class="line">                    <span class="keyword">return</span>;</div><div class="line">                &#125;</div><div class="line">                <span class="comment">//当 view 为空时，根据 request 设置默认 view</span></div><div class="line">                applyDefaultViewName(processedRequest, mv);</div><div class="line">                <span class="comment">//执行相应 Interceptor 的 postHandler</span></div><div class="line">                mappedHandler.applyPostHandle(processedRequest, response, mv);</div><div class="line">            &#125;<span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">                dispatchException = ex;</div><div class="line">            &#125;<span class="keyword">catch</span> (Throwable err) &#123;</div><div class="line">                <span class="comment">// As of 4.3, we're processing Errors thrown from handler methods as well,</span></div><div class="line">                <span class="comment">// making them available for @ExceptionHandler methods and other scenarios.</span></div><div class="line">                dispatchException = <span class="keyword">new</span> NestedServletException(<span class="string">"Handler dispatch failed"</span>, err);</div><div class="line">            &#125;</div><div class="line">            <span class="comment">//调用 processDispatchResult 方法处理上面处理之后的结果（包括处理异常，渲染页面，发出完成通知触发 Interceptor 的 afterCompletion）</span></div><div class="line">            processDispatchResult(processedRequest, response, mappedHandler, mv, dispatchException);</div><div class="line">        &#125;<span class="keyword">catch</span> (Exception ex) &#123;</div><div class="line">            triggerAfterCompletion(processedRequest, response, mappedHandler, ex);</div><div class="line">        &#125;<span class="keyword">catch</span> (Throwable err) &#123;</div><div class="line">            triggerAfterCompletion(processedRequest, response, mappedHandler,</div><div class="line">                    <span class="keyword">new</span> NestedServletException(<span class="string">"Handler processing failed"</span>, err));</div><div class="line">        &#125;<span class="keyword">finally</span> &#123;</div><div class="line">          <span class="comment">//判断是否执行异步请求</span></div><div class="line">            <span class="keyword">if</span> (asyncManager.isConcurrentHandlingStarted()) &#123;</div><div class="line">                <span class="comment">// Instead of postHandle and afterCompletion</span></div><div class="line">                <span class="keyword">if</span> (mappedHandler != <span class="keyword">null</span>) &#123;</div><div class="line">                    mappedHandler.applyAfterConcurrentHandlingStarted(processedRequest, response);</div><div class="line">                &#125;</div><div class="line">            &#125;<span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// Clean up any resources used by a multipart request. 删除上传请求的资源</span></div><div class="line">                <span class="keyword">if</span> (multipartRequestParsed) &#123;</div><div class="line">                    cleanupMultipart(processedRequest);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p> Handler，HandlerMapping，HandlerAdapter 三个区别：</p>
<ul>
<li>Handler：处理器，对应 MVC 的 C层，也就是 Controller 层，具体表现形式有很多种，可以是类，方法，它的类型是 Object，只要可以处理实际请求就可以是 Handler。</li>
<li>HandlerMapping：用来查找 Handler 的。</li>
<li>HandlerAdapter ：Handler 适配器，</li>
</ul>
<p>另外 View 和 ViewResolver 的原理与 Handler 和 HandlerMapping 的原理类似。</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/doDispatcher.png" alt="doDispatcher"></p>
<h4 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h4><p>本章分析了 Spring MVC 的请求处理的过程。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Spring MVC&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://ohfk1r827.bkt.clouddn.com/spring-mvc.png&quot; alt=&quot;spring-mvc&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Spring MVC" scheme="http://yoursite.com/tags/Spring-MVC/"/>
    
  </entry>
  
  <entry>
    <title>看透 Spring MVC 源代码分析与实践 ——  网站基础知识</title>
    <link href="http://yoursite.com/2017/07/14/Spring-MVC01/"/>
    <id>http://yoursite.com/2017/07/14/Spring-MVC01/</id>
    <published>2017-07-14T11:08:14.505Z</published>
    <updated>2017-07-14T11:26:28.978Z</updated>
    
    <content type="html"><![CDATA[<h3 id="网站架构及其演变过程"><a href="#网站架构及其演变过程" class="headerlink" title="网站架构及其演变过程"></a>网站架构及其演变过程</h3><h4 id="基础结构"><a href="#基础结构" class="headerlink" title="基础结构"></a>基础结构</h4><p>网络传输分解方式：</p>
<ul>
<li>标准的 OSI 参考模型</li>
<li>TCP/IP 参考模型</li>
</ul>
<p><img src="http://ohfk1r827.bkt.clouddn.com/OSI-TCPIP.jpg" alt="OSI-TCPIP"><br><a id="more"></a></p>
<h4 id="海量数据的解决方案"><a href="#海量数据的解决方案" class="headerlink" title="海量数据的解决方案"></a>海量数据的解决方案</h4><ul>
<li><p>缓存和页面静态化</p>
<ul>
<li>缓存<ul>
<li>通过程序直接保存在内存中</li>
<li>使用缓存框架 （Encache、Redis、Memcache）</li>
</ul>
</li>
<li>页面静态化<ul>
<li>使用模板技术生成（Velocity、FreeMaker等）</li>
</ul>
</li>
</ul>
</li>
<li><p>数据库优化</p>
<ul>
<li>表结构优化</li>
<li>SQL 语句优化</li>
<li>分区</li>
<li>分表</li>
<li>索引优化</li>
<li>使用存储过程代替直接操作过程</li>
</ul>
</li>
<li><p>分离活跃数据</p>
</li>
<li><p>批量读取和延迟修改</p>
</li>
<li><p>读写分离</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/read-write.jpg" alt="read-write"></p>
</li>
<li><p>分布式数据库</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/sql-1.jpg" alt="sql-1"></p>
</li>
<li><p>NoSQL 和 Hadoop</p>
</li>
</ul>
<h4 id="高并发的解决方案"><a href="#高并发的解决方案" class="headerlink" title="高并发的解决方案"></a>高并发的解决方案</h4><ul>
<li>应用和静态资源的分离：静态文件（图片、视频、JS、CSS等）放在专门的服务器上</li>
<li>页面缓存（Nginx 服务器、Squid 服务器）</li>
<li>集群与分布式</li>
<li>反向代理</li>
<li>CDN</li>
<li>底层优化：网络传输协议</li>
</ul>
<h3 id="常见协议和标准"><a href="#常见协议和标准" class="headerlink" title="常见协议和标准"></a>常见协议和标准</h3><h4 id="TCP-IP-协议"><a href="#TCP-IP-协议" class="headerlink" title="TCP/IP 协议"></a>TCP/IP 协议</h4><p>IP：查找地址，对应着国际互联网</p>
<p>TCP：规范传输规则，对应着传输层</p>
<p>TCP 在传输之前会进行三次沟通，称 “三次握手”，传完数据断开的时候要进行四次沟通，称 “四次挥手”。</p>
<p>TCP 两个序号，三个标志位含义：</p>
<ul>
<li>seq：表示所传数据的序号。TCP 传输时每一个字节都有一个序号，发送数据的时候会将数据的第一个序号发送给对方，接收方会按序号检查是否接收完整了，如果没接收完整就需要重新传送，这样就可以保证数据的完整性。</li>
<li>ack：表示确认号。接收端用它来给发送端反馈已经成功接收到的数据信息，它的值为希望接收的下一个数据包起始序号。</li>
<li>ACK：确认位，只有 ACK = 1 的时候 ack 才起作用。正常通信时 ACK 为 1，第一次发起请求时因为没有需要确认接收的数据所以 ACK 为 0。</li>
<li>SYN：同步位，用于在建立连接时同步序号。刚开始建立连接时并没有历史接收的数据，所以 ack  也就没有办法设置，这是按照正常的机制就无法运行了，SYN 的作用就是解决这个问题的，当接收端接收到 SYN = 1 的报文时就会直接将 ack 设置为接收到的 seq + 1 的值，注意这里的值并不是检验后设置的，而是根据 SYN 直接设置的，这样正常的机制就可以运行了，所以 SYN 叫同步位。SYN 会在前两次握手时都为 1，这是因为通信的双方的 ack 都需要设置一个初始值。</li>
<li>FIN：终止位，用来在数据传输完毕后释放连接。</li>
</ul>
<p><img src="http://ohfk1r827.bkt.clouddn.com/TCP.jpg" alt="TCP"></p>
<h3 id="DNS-的设置"><a href="#DNS-的设置" class="headerlink" title="DNS 的设置"></a>DNS 的设置</h3><h4 id="DNS-解析"><a href="#DNS-解析" class="headerlink" title="DNS 解析"></a>DNS 解析</h4><p>参考域名设置，如下是我在腾讯云域名的设置</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/dns.jpg" alt="dns"></p>
<p>记录类型：</p>
<p><strong>A记录：</strong> 将域名指向一个IPv4地址（例如：8.8.8.8）<br><strong>CNAME</strong>：将域名指向另一个域名（例如 www.54tianzhisheng.cn）<br><strong>MX</strong>： 将域名指向邮件服务器地址<br><strong>TXT</strong>： 可任意填写，长度限制255，通常做SPF记录（反垃圾邮件）<br><strong>NS</strong>： 域名服务器记录，将子域名指定其他DNS服务器解析<br><strong>AAAA</strong>：将域名指向一个iPv6地址（例如：ff06:0:0:0:0:0:0:c3）<br><strong>SRV</strong>：记录提供特定服务的服务器（例如_xmpp-server._tcp）<br><strong>显性URL</strong>：将域名301重定向到另一个地址<br><strong>隐性URL</strong>：类似显性URL，但是会隐藏真实目标地址</p>
<p>主机记录：</p>
<p><strong>要解析 www.54tianzhisheng.cn，请填写 www。</strong><br><strong>主机记录就是域名前缀，常见用法有：</strong></p>
<p><strong>www: </strong>解析后的域名为 www.54tianzhisheng.cn。<br><strong>@:</strong> 直接解析主域名 54tianzhisheng.cn。<br><strong>*:</strong> 泛解析，匹配其他所有域名 <em>.54tianzhisheng.cn。<br><strong>mail:</strong> 将域名解析为 mail.54tianzhisheng.cn，通常用于解析邮箱服务器。<br><strong>二级域名:</strong> 如：abc.54tianzhisheng.cn，填写abc。<br><em>*手机网站:</em></em> 如：m.54tianzhisheng.cn，填写m。</p>
<h3 id="Java-中-Socket-的用法"><a href="#Java-中-Socket-的用法" class="headerlink" title="Java 中 Socket 的用法"></a>Java 中 Socket 的用法</h3><h4 id="普通-Soket-的用法"><a href="#普通-Soket-的用法" class="headerlink" title="普通 Soket 的用法"></a>普通 Soket 的用法</h4><p>Socket 分为 ServerSocket 和 Socket 两大类。</p>
<p>ServerSocket 用于服务器端，可以通过 accept 方法监听请求，监听到请求后返回 Socket；</p>
<p>Socket 用户具体完成数据传输，客户端直接使用 Socket 发送请求并传输数据。</p>
<p>随便写了个单方面发送消息的 demo：</p>
<p>客户端：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.OutputStream;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/5/2.</div><div class="line"> * TCP客户端：</div><div class="line"> ①：建立tcp的socket服务，最好明确具体的地址和端口。这个对象在创建时，就已经可以对指定ip和端口进行连接(三次握手)。</div><div class="line"> ②：如果连接成功，就意味着通道建立了，socket流就已经产生了。只要获取到socket流中的读取流和写入流即可，只要通过getInputStream和getOutputStream就可以获取两个流对象。</div><div class="line"> ③：关闭资源。</div><div class="line"> */</div><div class="line"><span class="comment">//单方面的输入！</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TcpClient</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Socket s = <span class="keyword">new</span> Socket(<span class="string">"127.0.0.1"</span>, <span class="number">9999</span>);</div><div class="line">            OutputStream o = s.getOutputStream();</div><div class="line">            o.write(<span class="string">"tcp sssss"</span>.getBytes());</div><div class="line">            s.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>服务器端：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.io.InputStream;</div><div class="line"><span class="keyword">import</span> java.net.ServerSocket;</div><div class="line"><span class="keyword">import</span> java.net.Socket;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/5/2.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TcpServer</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            ServerSocket ss = <span class="keyword">new</span> ServerSocket(<span class="number">9999</span>);<span class="comment">//建立服务端的socket服务</span></div><div class="line">            Socket s = ss.accept();<span class="comment">//获取客户端对象</span></div><div class="line">            String ip = s.getInetAddress().getHostAddress();</div><div class="line">            <span class="keyword">int</span> port = s.getPort();</div><div class="line">            System.out.println(ip + <span class="string">" : "</span> + port + <span class="string">" connected"</span>);</div><div class="line"></div><div class="line">            <span class="comment">// 可以通过获取到的socket对象中的socket流和具体的客户端进行通讯。</span></div><div class="line">            InputStream ins = s.getInputStream();<span class="comment">//读取客户端的数据，使用客户端对象的socket读取流</span></div><div class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span>];</div><div class="line">            <span class="keyword">int</span> len = ins.read(bytes);</div><div class="line">            String text = <span class="keyword">new</span> String(bytes, <span class="number">0</span>, len);</div><div class="line">            System.out.println(text);</div><div class="line">            <span class="comment">//关闭资源</span></div><div class="line">            s.close();</div><div class="line">            ss.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="NioSocket-的用法"><a href="#NioSocket-的用法" class="headerlink" title="NioSocket 的用法"></a>NioSocket 的用法</h4><p>见以前的一篇文章：<a href="http://www.54tianzhisheng.cn/2017/03/28/Java%20NIO%20%E7%B3%BB%E5%88%97%E6%95%99%E7%A8%8B/" target="_blank" rel="external">Java NIO 系列教程</a></p>
<p>书中第五章简单的讲了下实现 HTTP 协议。第六章主要讲 Servlet，写了 Servlet 接口和其实现类。第七章把 Tomcat 分析的很不错，如果有读者感兴趣的话，可以去看看。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;网站架构及其演变过程&quot;&gt;&lt;a href=&quot;#网站架构及其演变过程&quot; class=&quot;headerlink&quot; title=&quot;网站架构及其演变过程&quot;&gt;&lt;/a&gt;网站架构及其演变过程&lt;/h3&gt;&lt;h4 id=&quot;基础结构&quot;&gt;&lt;a href=&quot;#基础结构&quot; class=&quot;headerlink&quot; title=&quot;基础结构&quot;&gt;&lt;/a&gt;基础结构&lt;/h4&gt;&lt;p&gt;网络传输分解方式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;标准的 OSI 参考模型&lt;/li&gt;
&lt;li&gt;TCP/IP 参考模型&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img src=&quot;http://ohfk1r827.bkt.clouddn.com/OSI-TCPIP.jpg&quot; alt=&quot;OSI-TCPIP&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="Spring MVC" scheme="http://yoursite.com/tags/Spring-MVC/"/>
    
  </entry>
  
  <entry>
    <title>通过源码详解 Servlet</title>
    <link href="http://yoursite.com/2017/07/09/servlet/"/>
    <id>http://yoursite.com/2017/07/09/servlet/</id>
    <published>2017-07-09T05:47:19.553Z</published>
    <updated>2017-07-09T05:54:51.276Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Servlet-结构"><a href="#Servlet-结构" class="headerlink" title="Servlet 结构"></a>Servlet 结构</h2><p><img src="http://ohfk1r827.bkt.clouddn.com/servlet1.png" alt="servlet1"></p>
<h3 id="1、Servlet"><a href="#1、Servlet" class="headerlink" title="1、Servlet"></a>1、Servlet</h3><p>Servlet 该接口定义了5个方法。<br><a id="more"></a></p>
<ul>
<li>init()，初始化 servlet 对象，完成一些初始化工作。它是由 servlet 容器控制的，该方法只能被调用一次</li>
<li>service()，接受客户端请求对象，执行业务操作，利用响应对象响应客户端请求。</li>
<li>destroy()，当容器监测到一个servlet从服务中被移除时，容器调用该方法，释放资源，该方法只能被调用一次。</li>
<li>getServletConfig()，ServletConfig 是容器向 servlet 传递参数的载体。</li>
<li>getServletInfo()，获取 servlet 相关信息。</li>
</ul>
<p>Servlet 的生命周期：</p>
<blockquote>
<p>1，初始化阶段  调用 init() 方法</p>
<p>2，响应客户请求阶段　　调用 service() 方法</p>
<p>3，终止阶段　　调用 destroy() 方法</p>
</blockquote>
<p>在 Servlet 接口中的五个方法中涉及的接口有三个：ServletConfig 、 ServletRequest、 ServletResponse</p>
<p>这里先讲讲 ServletRequest 和 ServletResponse。</p>
<p>1）ServletRequest  由 Servlet 容器来管理，当客户请求到来时，容器创建一个 ServletRequest 对象，封装请求数据，同时创建一个 ServletResponse 对象，封装响应数据。这两个对象将被容器作为 service（）方法的参数传递给 Servlet，Serlvet 利用 ServletRequest 对象获取客户端发来的请求数据，利用 ServletResponse 对象发送响应数据。</p>
<p>下面是 ServletRequest  中所有的方法，根据方法名大概就可以猜到这些方法到底是干啥用的。</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/ServletRequest.png" alt="ServletRequest"></p>
<p>2）ServletResponse 发送响应数据</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/ServletResponse.png" alt="ServletResponse"></p>
<h3 id="2、ServletConfig"><a href="#2、ServletConfig" class="headerlink" title="2、ServletConfig"></a>2、ServletConfig</h3><p>ServletConfig 是容器向 servlet 传递参数的载体。</p>
<p>ServletConfig的4个常用方法：</p>
<p>1）public String getInitParameter（String name）：返回指定名称的初始化参数值；</p>
<p>2）public Enumeration getInitParameterNames（）：返回一个包含所有初始化参数名的 Enumeration 对象；</p>
<p>3）public String getServletName()：返回在 DD 文件中<code>&lt;servlet-name&gt;</code>元素指定的 Servlet 名称；</p>
<p>4）public ServletContext getServletContext（）：返回该 Servlet 所在的上下文对象；</p>
<p>这里详细讲下 ServletContext ：</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/ServletContext.png" alt="ServletContext"></p>
<p>Servlet 上下文对象（ServletContext）：每个Web应用程序在被启动时都会创建一个唯一的上下文对象，Servlet 可通过其获得 Web 应用程序的初始化参数或 Servlet 容器的版本等信息，也可被 Servlet 用来与其他 Servlet 共享数据。</p>
<p>1、获得 ServletContext 应用：</p>
<p>（1）、直接调用 getServletContext（）方法</p>
<p>ServletContext context = getServletContext（）;</p>
<p>（2）、使用 ServletConfig 应用，再调用它的 getServletContext（）方法</p>
<p>ServletContext context = getServletConfig.getServletContext();</p>
<p>2、获得应用程序的初始化参数：</p>
<p>（1）、public String getInitParameter（String name）：返回指定参数名的字符串参数值，没有则返回 null；</p>
<p>（2）、public Enumeration getInitParameterNames()：返回一个包含多有初始化参数名的 Enumeration 对象；</p>
<p>3、通过 ServletContext 对象获得资源</p>
<p>（1）、public URl getResource（String path）:返回由给定路径的资源的 URL 对象，以 “/” 开头，为相对路径，相对于Web 应用程序的文档根目录；</p>
<p>（2）、public InputStream getResourceAsStream（String path）：从资源上获得一个 InputStream 对象，等价于getResource（path）.oprenStream();</p>
<p>（3）、public String getRealPath(String path)：返回给定的虚拟路径的真实路径；</p>
<p>4、登陆日志：使用 log（）方法可以将指定的消息写到服务器的日志文件中</p>
<p>（1）、public void log（String msg）：参数 msg 为写入日志文件消息</p>
<p>（2）、public void log（String msg，Throwable throwable）：将 msg 指定的消息和异常的栈跟踪信息写入日志文件</p>
<p>5、使用 RequestDispatcher 实现请求转发</p>
<p>（1）、RequestDispatcher getRequestDiapatcher(String path)：必须以 “/“ 开头相对于应用程序根目录，而ServletRequest 可以传递一个相对路径</p>
<p>（2）、RequestDipatcher getNamedDiapatcher（String name）：参数 name 为一个命名的 Servlet 对象</p>
<p>6、使用 ServletContext 对象存储数据</p>
<p>（1）、public void serAttribute（String name，Object object）：将给定名称的属性值对象绑定到上下文对象上；</p>
<p>（2）、public Object getAttribute（String name）：返回绑定到上下文对象的给定名称的属性值；</p>
<p>（3）、public Enumeration getAttributeNames()：返回绑定到上下文对象上的所有属性名的 Enumeration 对象；</p>
<p>（4）、public void removeAttribute（String name）：删除绑定到上下文对象指定名称的属性；</p>
<p>ServletRequest 共享的对象仅在请求的生存周期中可以被访问；</p>
<p>HttpSession 共享的对象仅在会话的生存周期中可以被访问；</p>
<p>ServletContext 共享的对象在整个 Web 应用程序启动的生存周期中可以被访问；</p>
<p>7、检索 Servlet 容器的信息</p>
<p>（1）、public String getServletInfo()：返回 Servlet 所运行容器的名称和版本；</p>
<p>（2）、public int getMajorVersion（）：返回容器所支持的 Servlet API 的主版本号；</p>
<p>（3）、public int  getMinorVersion（）：返回容器所支持的 Servlet API 的次版本号；</p>
<p>（4）、public String getServletContext（）：返回 ServletContext 对应的 web 应用程序名称 <code>&lt;display-name&gt;</code>元素定义的名称；</p>
<h3 id="3、GenericServlet-抽象类"><a href="#3、GenericServlet-抽象类" class="headerlink" title="3、GenericServlet 抽象类"></a>3、GenericServlet 抽象类</h3><p>GenericServlet  定义了一个通用的，不依赖具体协议的 Servlet，它实现了 Servlet 接口和 ServletConfig 接口，它的方法在文章的第一张图就给出了。</p>
<h3 id="4、HttpServlet-抽象类"><a href="#4、HttpServlet-抽象类" class="headerlink" title="4、HttpServlet 抽象类"></a>4、HttpServlet 抽象类</h3><h4 id="4-1、HTTP-请求方式"><a href="#4-1、HTTP-请求方式" class="headerlink" title="4.1、HTTP 请求方式"></a>4.1、HTTP 请求方式</h4><p><img src="http://ohfk1r827.bkt.clouddn.com/http-request-method.jpg" alt="http-request-method"></p>
<ol>
<li>GET : 获取由请求 URL 标识的资源</li>
<li>POST : 向 Web 服务器发送无限制长度的数据</li>
<li>PUT : 存储一个资源到请求的 URL</li>
<li>DELETE : 删除由 URL 标识的资源</li>
<li>HEAD : 返回 URL 标识的头信息</li>
<li>OPTIONS : 返回服务器支持的 HTTP 方法</li>
<li>TRACE : 返回 TRACE 请求附带的头字段</li>
</ol>
<h4 id="4-2、对应的服务方法："><a href="#4-2、对应的服务方法：" class="headerlink" title="4.2、对应的服务方法："></a>4.2、对应的服务方法：</h4><ol>
<li>doGet() : 调用服务器的资源, 并将其作为响应返回给客户端.  doGet() 调用在 URL 里显示正在传送给 Servlet 的数据,这在系统的安全方面可能带来一些问题, 比如说, 用户登录时,  表单里的用户名和密码需要发送到服务器端, doGet() 调用会在浏览器的 URL 里显示用户名和密码.</li>
<li>doPost() : 它用于把客户端的数据传给服务端, 使用它可以以隐藏方式给服务器端发送数据. Post 适合发送大量数据.</li>
<li>doPut() : 调用和 doPost() 相似, 并且它允许客户端把真正的文件存放在服务器上, 而不仅仅是传送数据.</li>
<li>doDelete() : 它允许客户端删除服务器端的文件或者 Web 页面．它的使用非常少．</li>
<li>doHead() : 它用于处理客户端的 Head 调用,并且返回一个 response. 当客户端只需要响应的 Header 时,它就发出一个Header 请求.这种情况下客户端往往关心响应的长度和响应的 MIME 类型.</li>
<li>doOptions(): 它用于处理客户端的 Options 调用,通过这个调用, 客户端可以获得此 Servlet 支持的方法.如果 Servlet 覆盖了 doPost() 方法, 那么将返回: Allow: POST, TRACE, OPTIONS, HEAD</li>
<li>doTrace：处理 TRACE 请求</li>
</ol>
<h4 id="4-3、Servlet-Service-方法详解"><a href="#4-3、Servlet-Service-方法详解" class="headerlink" title="4.3、Servlet   Service 方法详解"></a>4.3、Servlet   Service 方法详解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span></span></div><div class="line">        <span class="keyword">throws</span> ServletException, IOException</div><div class="line">    &#123;</div><div class="line">        HttpServletRequest  request;</div><div class="line">        HttpServletResponse response;</div><div class="line">        <span class="comment">// 如果传入的 HTTP 请求和 HTTP 响应不是 HTTP 的领域模型，则抛出 Servlet 异常，这个异常会被 Servlet 容器所处理</span></div><div class="line">        <span class="keyword">if</span> (!(req <span class="keyword">instanceof</span> HttpServletRequest &amp;&amp;</div><div class="line">                res <span class="keyword">instanceof</span> HttpServletResponse)) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ServletException(<span class="string">"non-HTTP request or response"</span>);</div><div class="line">        &#125;</div><div class="line">		<span class="comment">// 既然是 HTTP 协议绑定的 Serlvet, 强制转换到 HTTP 的领域模型</span></div><div class="line">        request = (HttpServletRequest) req;</div><div class="line">        response = (HttpServletResponse) res;</div><div class="line">		<span class="comment">// 如果传入的请求和响应是预期的 HTTP 请求和 HTTP 响应，则调用 HttpServlet 的 service() 方法。</span></div><div class="line">        service(request, response);</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h4 id="4-4、HttpServlet-service-方法详解"><a href="#4-4、HttpServlet-service-方法详解" class="headerlink" title="4.4、HttpServlet   service  方法详解"></a>4.4、HttpServlet   service  方法详解</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span></span></div><div class="line">        <span class="keyword">throws</span> ServletException, IOException</div><div class="line">    &#123;</div><div class="line">    <span class="comment">// 从 HTTP 请求中取得这次请求所使用的 HTTT 方法</span></div><div class="line">        String method = req.getMethod();</div><div class="line">		<span class="comment">// 如果这次请求使用 GET 方法</span></div><div class="line">        <span class="keyword">if</span> (method.equals(METHOD_GET)) &#123;</div><div class="line">        	<span class="comment">// 取得这个 Servlet 的最后修改的时间</span></div><div class="line">            <span class="keyword">long</span> lastModified = getLastModified(req);</div><div class="line">            <span class="keyword">if</span> (lastModified == -<span class="number">1</span>) &#123;</div><div class="line">                <span class="comment">// servlet doesn't support if-modified-since, no reason</span></div><div class="line">                <span class="comment">// to go through further expensive logic</span></div><div class="line">                <span class="comment">//-1 代表这个 Servlet 不支持最后修改操作，直接调用 doGet() 进行处理 HTTP GET 请求</span></div><div class="line">                doGet(req, resp);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">            	<span class="comment">// 如果这个 Servlet 支持最后修改操作，取得请求头中包含的请求的最后修改时间</span></div><div class="line">                <span class="keyword">long</span> ifModifiedSince = req.getDateHeader(HEADER_IFMODSINCE);</div><div class="line">                <span class="keyword">if</span> (ifModifiedSince &lt; lastModified) &#123;</div><div class="line">                    <span class="comment">// If the servlet mod time is later, call doGet()</span></div><div class="line">                    <span class="comment">// Round down to the nearest second for a proper compare</span></div><div class="line">                    <span class="comment">// A ifModifiedSince of -1 will always be less</span></div><div class="line">                    <span class="comment">// 如果请求头中包含的修改时间早于这个 Servlet 的最后修改时间，说明这个 Servlet 自从客户上一次 HTTP 请求已经被修改了 , 设置最新修改时间到响应头中</span></div><div class="line">                    maybeSetLastModified(resp, lastModified);</div><div class="line">                    <span class="comment">// 调用 doGet 进行进行处理 HTTP GET 请求</span></div><div class="line">                    doGet(req, resp);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// 如果请求头中包含修改时间晚于这个 Servlet 的最后修改时间，说明这个 Servlet 自从请求的最后修改时间后没有更改过，这种情况下，仅仅返回一个 HTTP 响应状态 SC_NOT_MODIFIED</span></div><div class="line">                    resp.setStatus(HttpServletResponse.SC_NOT_MODIFIED);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_HEAD)) &#123;</div><div class="line">        <span class="comment">// 如果这次请求使用 HEAD 方法</span></div><div class="line">         <span class="comment">// 如果这个 Servlet 支持最后修改操作，则设置这个 Servlet 的最后修改时间到响应头中</span></div><div class="line">            <span class="keyword">long</span> lastModified = getLastModified(req);</div><div class="line">            maybeSetLastModified(resp, lastModified);</div><div class="line">            <span class="comment">// 和对 HTTP GET 方法处理不同的是，无论请求头中的修改时间是不是早于这个 Sevlet 的最后修改时间，都会发 HEAD 响应给客户，因为 HTTP HEAD 响应是用来查询 Servlet 头信息的操作</span></div><div class="line">            doHead(req, resp);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_POST)) &#123;</div><div class="line">        <span class="comment">// 如果这次请求使用 POST 方法</span></div><div class="line">            doPost(req, resp);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_PUT)) &#123;</div><div class="line">        <span class="comment">// 如果这次请求使用 PUT 方法</span></div><div class="line">            doPut(req, resp);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_DELETE)) &#123;</div><div class="line">        <span class="comment">// 如果这次请求使用 DELETE 方法</span></div><div class="line">            doDelete(req, resp);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_OPTIONS)) &#123;</div><div class="line">        <span class="comment">// 如果这次请求使用 OPTIONS 方法</span></div><div class="line">            doOptions(req,resp);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (method.equals(METHOD_TRACE)) &#123;</div><div class="line">        <span class="comment">// 如果这次请求使用 TRACE 方法</span></div><div class="line">            doTrace(req,resp);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// Note that this means NO servlet supports whatever</span></div><div class="line">            <span class="comment">// method was requested, anywhere on this server.</span></div><div class="line">			<span class="comment">// 如果这次请求是其他未知方法，返回错误代码 SC_NOT_IMPLEMENTED 给 HTTP 响应，并且显示一个错误消息，说明这个操作是没有实现的</span></div><div class="line">            String errMsg = lStrings.getString(<span class="string">"http.method_not_implemented"</span>);</div><div class="line">            Object[] errArgs = <span class="keyword">new</span> Object[<span class="number">1</span>];</div><div class="line">            errArgs[<span class="number">0</span>] = method;</div><div class="line">            errMsg = MessageFormat.format(errMsg, errArgs);</div><div class="line"></div><div class="line">            resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED, errMsg);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="5、Servlet-的多线程问题"><a href="#5、Servlet-的多线程问题" class="headerlink" title="5、Servlet 的多线程问题"></a>5、Servlet 的多线程问题</h3><p>1、当涉及到 Servlet 需要共享资源是，需保证 Servlet 是线程安全的</p>
<p>2、注意事项：</p>
<p>（1）、用方法的局部变量保持请求中的专有数据；</p>
<p>（2）、只用 Servlet 的成员变量来存放那些不会改变的数据；</p>
<p>（3）、对可能被请求修改的成员变量同步（用 Synchronized 关键字修饰）；</p>
<p>（4）、如果 Servlet 访问外部资源，那么需要同步访问这些资源；</p>
<p>3、实现 SingleThreadModel 接口的 Servlet 在被多个客户请求时一个时刻只能有一个线程运行，不推荐使用。</p>
<p>4、如果必须在 servlet 使用同步代码，应尽量在最小的范围上（代码块）进行同步，同步代码越少，Servlet 执行才能越好，避免对 doGet() 或 doPost() 方法同步。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>全文首先通过一张 Servlet 中的核心 Servlet 类图关系，了解了几种 Servlet 之间的关系及其内部方法。然后在分别介绍这几种 Servlet，通过分析部分重要方法的源码来了解，还介绍了 Servlet 中多线程的问题的解决方法。</p>
<p>注：文章原创，首发于：<a href="http://www.54tianzhisheng.cn" target="_blank" rel="external">zhisheng 的博客</a>，文章可转载但请注明地址为：<a href="http://www.54tianzhisheng.cn/2017/07/09/servlet/" target="_blank" rel="external">http://www.54tianzhisheng.cn/2017/07/09/servlet/</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Servlet-结构&quot;&gt;&lt;a href=&quot;#Servlet-结构&quot; class=&quot;headerlink&quot; title=&quot;Servlet 结构&quot;&gt;&lt;/a&gt;Servlet 结构&lt;/h2&gt;&lt;p&gt;&lt;img src=&quot;http://ohfk1r827.bkt.clouddn.com/servlet1.png&quot; alt=&quot;servlet1&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;1、Servlet&quot;&gt;&lt;a href=&quot;#1、Servlet&quot; class=&quot;headerlink&quot; title=&quot;1、Servlet&quot;&gt;&lt;/a&gt;1、Servlet&lt;/h3&gt;&lt;p&gt;Servlet 该接口定义了5个方法。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="Servlet" scheme="http://yoursite.com/tags/Servlet/"/>
    
  </entry>
  
  <entry>
    <title>Velocity 循环指令一种好的解决方法</title>
    <link href="http://yoursite.com/2017/06/25/Velocity-foreach/"/>
    <id>http://yoursite.com/2017/06/25/Velocity-foreach/</id>
    <published>2017-06-25T05:01:16.352Z</published>
    <updated>2017-06-28T02:42:50.345Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>前台的数据经常是由需要通过 foreach 循环获取。</p>
<h3 id="好的解决方案：（拿我最近做的一个项目做例子）"><a href="#好的解决方案：（拿我最近做的一个项目做例子）" class="headerlink" title="好的解决方案：（拿我最近做的一个项目做例子）"></a>好的解决方案：（拿我最近做的一个项目做例子）</h3><p>购物商城左边的导航栏，商品大分类和小分类（Category）</p>
<p><strong>1、在 model 包下创建一个 ViewObject 类</strong></p>
<a id="more"></a>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public class ViewObject</div><div class="line">&#123;</div><div class="line">    private Map&lt;String, Object&gt; objs = new HashMap&lt;&gt;();</div><div class="line">    public void set(String key, Object value) &#123;</div><div class="line">        objs.put(key, value);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public Object get(String key) &#123;</div><div class="line">        return objs.get(key);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>2、在 controller 包下创建个 BaseController 类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 在每个页面显示图书大分类，抽离出来</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;ViewObject&gt; <span class="title">selectAllCategory</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;Category&gt; categories = categoryService.selectAllCategory();</div><div class="line">        List&lt;ViewObject&gt; vos = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (Category category : categories) &#123;</div><div class="line">            ViewObject vo = <span class="keyword">new</span> ViewObject();</div><div class="line">            vo.set(<span class="string">"category"</span>, category);</div><div class="line">            vo.set(<span class="string">"id"</span>, category.getId());</div><div class="line">            <span class="comment">//System.out.println("category 中的 id 是 "+category.getId());</span></div><div class="line">            vos.add(vo);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> vos;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 获取图书的小分类，在这里将小分类中的大分类id查找出来，保存在 cds.id 中，</div><div class="line">     * 然后在模板引擎中通过将 vos.id 和 cds.id 相比较。然后如果相同的话，就取出来放在对应的大分类下</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;ViewObject&gt; <span class="title">selectAllCategoryDetail</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;CategoryDetail&gt; categoryDetails  = categoryDetailService.selectAllCategoryDetail();</div><div class="line">        List&lt;ViewObject&gt; cds = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (CategoryDetail categoryDetail : categoryDetails) &#123;</div><div class="line">            ViewObject vo = <span class="keyword">new</span> ViewObject();</div><div class="line">            vo.set(<span class="string">"categoryDetail"</span>, categoryDetail);</div><div class="line">            <span class="comment">//System.out.println("categoryDetail 中的 categoryDetail  id  =" + categoryDetail.getId() + "category id = " + categoryDetail.getCategory_id() + " name = " + categoryDetail.getName());</span></div><div class="line">            vo.set(<span class="string">"id"</span>, categoryDetail.getCategory_id());</div><div class="line">            cds.add(vo);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> cds;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>3、在 IndexController 类下，需要继承 BaseController.java 类</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 返回首页</div><div class="line">     * <span class="doctag">@param</span> model</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@RequestMapping</span>(path = &#123;<span class="string">"/"</span>, <span class="string">"/index"</span>&#125;)</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">index</span><span class="params">(Model model)</span> </span>&#123;</div><div class="line">        <span class="comment">//模板引擎设置图书分类左边导航栏</span></div><div class="line">        model.addAttribute(<span class="string">"vos"</span>, selectAllCategory());</div><div class="line">        model.addAttribute(<span class="string">"cds"</span>, selectAllCategoryDetail());</div><div class="line">      <span class="comment">//返回主页</span></div><div class="line">        <span class="keyword">return</span> <span class="string">"index"</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p><strong>4、抽离导航部分的代码 left.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--左边图书分类导航栏--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"c3_b1_left"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dl</span>&gt;</span></div><div class="line">        #foreach($vo in $vos)</div><div class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">h1</span>&gt;</span>$!&#123;vo.category.name&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">                #foreach($cd in $cds)</div><div class="line">                #if($vo.id == $cd.id)</div><div class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/list"</span>&gt;</span>$!&#123;cd.categoryDetail.name&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line">                #end</div><div class="line">                #end</div><div class="line">            <span class="tag">&lt;/<span class="name">p</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dd</span>&gt;</span></div><div class="line">        #end</div><div class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>5、首页中相应的位置引入 left.html</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#parse("left.html")</div></pre></td></tr></table></figure>
<p>这样就可以解决问题了，可是有时候我们需要控制循环的个数，因为我们网页端可能只需要特定的数据量</p>
<p>那么就需要中断 foreach，可以使用 #break 指令终止循环</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#foreach( $vo in $vos )</div><div class="line">    #if( $foreach.count &gt; 5 )</div><div class="line">        #break</div><div class="line">    #end</div><div class="line">    $!&#123;vo.customer.Name&#125;</div><div class="line">#end</div></pre></td></tr></table></figure>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://my.oschina.net/u/2000201/blog/539217" target="_blank" rel="external">Velocity入门指南——第七章 循环指令 </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前提&quot;&gt;&lt;a href=&quot;#前提&quot; class=&quot;headerlink&quot; title=&quot;前提&quot;&gt;&lt;/a&gt;前提&lt;/h3&gt;&lt;p&gt;前台的数据经常是由需要通过 foreach 循环获取。&lt;/p&gt;
&lt;h3 id=&quot;好的解决方案：（拿我最近做的一个项目做例子）&quot;&gt;&lt;a href=&quot;#好的解决方案：（拿我最近做的一个项目做例子）&quot; class=&quot;headerlink&quot; title=&quot;好的解决方案：（拿我最近做的一个项目做例子）&quot;&gt;&lt;/a&gt;好的解决方案：（拿我最近做的一个项目做例子）&lt;/h3&gt;&lt;p&gt;购物商城左边的导航栏，商品大分类和小分类（Category）&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;1、在 model 包下创建一个 ViewObject 类&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="Velocity" scheme="http://yoursite.com/tags/Velocity/"/>
    
  </entry>
  
  <entry>
    <title>AJAX 学习</title>
    <link href="http://yoursite.com/2017/06/23/AJAX/"/>
    <id>http://yoursite.com/2017/06/23/AJAX/</id>
    <published>2017-06-23T14:00:05.420Z</published>
    <updated>2017-06-23T15:17:44.523Z</updated>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>最近的项目中大量地方需要使用 AJAX，无奈，谁叫我既要写前台又要写后台呢，只好学习下这个技术点，主要参考 <a href="http://www.w3school.com.cn/ajax/index.asp" target="_blank" rel="external">W3school 文档</a>，下面记录下这些知识点，便于日后自己查阅，下面的一些测试代码建议在 W3school 中测试。</p>
<h3 id="AJAX-基础："><a href="#AJAX-基础：" class="headerlink" title="AJAX 基础："></a>AJAX 基础：</h3><p> AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。</p>
<p><strong>AJAX 是一种在无需重新加载整个网页的情况下，能够更新部分网页的技术。</strong> 在很多网站可以见到使用这种技术。<br><a id="more"></a></p>
<h3 id="AJAX-XMLHttpRequest"><a href="#AJAX-XMLHttpRequest" class="headerlink" title="AJAX -  XMLHttpRequest"></a>AJAX -  XMLHttpRequest</h3><ul>
<li>创建 XMLHttpRequest 对象</li>
</ul>
<p><strong>XMLHttpRequest 是 AJAX 的基础。</strong>XMLHttpRequest 用于在后台与服务器交换数据。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>
<p>创建 XMLHttpRequest 对象的语法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">variable = <span class="keyword">new</span> XMLHttpRequest();</div></pre></td></tr></table></figure>
<p>但是对于老版本的 Internet Explorer （IE5 和 IE6）却是使用 ActiveX 对象，所以在开发中为了适应大多数的浏览器，常使用如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp = <span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp = <span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<ul>
<li>向服务器发送请求</li>
</ul>
<p>使用 XMLHttpRequest 对象的 open() 和 send() 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"test1.txt"</span>,<span class="literal">true</span>);</div><div class="line">xmlhttp.send();</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>method</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>open(method, url, async)</td>
<td>规定请求的类型、URL 以及是否异步处理请求。method：请求的类型；GET 或 POST   url：文件在服务器上的位置   async：true（异步）或 false（同步）</td>
</tr>
<tr>
<td>send(string)</td>
<td>将请求发送到服务器。string：仅用于 POST 请求</td>
</tr>
</tbody>
</table>
<p><strong>GET 还是 POST？</strong></p>
<p>与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。</p>
<p>然而，在以下情况中，请使用 POST 请求：</p>
<ul>
<li>无法使用缓存文件（更新服务器上的文件或数据库）</li>
<li>向服务器发送大量数据（POST 没有数据量限制）</li>
<li>发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</li>
</ul>
<p>示例：<strong>GET 请求</strong></p>
<p>1、简单的 GET 请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadXMLDoc</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div><div class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"/ajax/demo_get.asp?t="</span> + <span class="built_in">Math</span>.random(),<span class="literal">true</span>);</div><div class="line">xmlhttp.send();</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>AJAX<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"loadXMLDoc()"</span>&gt;</span>请求数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2、通过 GET 方法发送信息</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadXMLDoc</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div><div class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"/ajax/demo_get2.asp?fname=Bill&amp;lname=Gates"</span>,<span class="literal">true</span>);</div><div class="line">xmlhttp.send();</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>AJAX<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"loadXMLDoc()"</span>&gt;</span>请求数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>示例：<strong>POST 请求</strong></p>
<p>1、简单 POST 请求</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadXMLDoc</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div><div class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">xmlhttp.open(<span class="string">"POST"</span>,<span class="string">"/ajax/demo_post.asp"</span>,<span class="literal">true</span>);</div><div class="line">xmlhttp.send();</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>AJAX<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"loadXMLDoc()"</span>&gt;</span>请求数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>2、像 HTML 表单那样 POST 数据，请使用 setRequestHeader() 来添加 HTTP 头。然后在 send() 方法中规定您希望发送的数据</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadXMLDoc</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div><div class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">xmlhttp.open(<span class="string">"POST"</span>,<span class="string">"/ajax/demo_post2.asp"</span>,<span class="literal">true</span>);</div><div class="line">xmlhttp.setRequestHeader(<span class="string">"Content-type"</span>,<span class="string">"application/x-www-form-urlencoded"</span>);</div><div class="line"></div><div class="line">xmlhttp.send(<span class="string">"fname=Bill&amp;lname=Gates"</span>);</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>AJAX<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"loadXMLDoc()"</span>&gt;</span>请求数据<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>注意：<code>setRequestHeader(header, value)</code>  向请求添加 HTTP 头，<code>header</code>: 规定头的名称,  <code>value</code>: 规定头的值。</p>
<p><strong>url - 服务器上的文件</strong></p>
<p>open() 方法的 <em>url</em> 参数是服务器上文件的地址：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"ajax_test.asp"</span>,<span class="literal">true</span>);</div></pre></td></tr></table></figure>
<p>该文件可以是任何类型的文件，比如 .txt 和 .xml，或者服务器脚本文件，比如 .asp 和 .php （在传回响应之前，能够在服务器上执行任务）。</p>
<p><strong>异步 - True or False ？</strong></p>
<p>XMLHttpRequest 对象如果要用于 AJAX 的话，其 open() 方法的 async 参数必须设置为 true，对于 web 开发人员来说，发送异步请求是一个巨大的进步。很多在服务器执行的任务都相当费时。AJAX 出现之前，这可能会引起应用程序挂起或停止。</p>
<p>通过 AJAX，JavaScript 无需等待服务器的响应，而是：</p>
<ul>
<li>在等待服务器响应时执行其他脚本</li>
<li>当响应就绪后对响应进行处理</li>
</ul>
<p><strong>Async = true</strong></p>
<p>当使用 async = true 时，请规定在响应处于 onreadystatechange 事件中的就绪状态时执行的函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadXMLDoc</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div><div class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"/ajax/test1.txt"</span>,<span class="literal">true</span>);</div><div class="line">xmlhttp.send();</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Let AJAX change this text<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"loadXMLDoc()"</span>&gt;</span>通过 AJAX 改变内容<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p><strong>Async = false</strong></p>
<p>如需使用 async = false，请将 open() 方法中的第三个参数改为 false</p>
<p>不推荐使用 async = false，但是对于一些小型的请求，也是可以的。</p>
<p>请记住，JavaScript 会等到服务器响应就绪才继续执行。如果服务器繁忙或缓慢，应用程序会挂起或停止。</p>
<p>注释：当您使用 async=false 时，请不要编写 onreadystatechange 函数 - 把代码放到 send() 语句后面即可：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadXMLDoc</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div><div class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"/ajax/test1.txt"</span>,<span class="literal">false</span>);</div><div class="line">xmlhttp.send();</div><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span><span class="tag">&lt;<span class="name">h2</span>&gt;</span>Let AJAX change this text<span class="tag">&lt;/<span class="name">h2</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"loadXMLDoc()"</span>&gt;</span>通过 AJAX 改变内容<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>服务器响应</li>
</ul>
<p>使用 XMLHttpRequest 对象的 responseText 或 responseXML 属性。</p>
<ul>
<li>responseText  获得字符串形式的响应数据。</li>
<li>responseXML  获得 XML 形式的响应数据。</li>
</ul>
<p>1、responseText 属性</p>
<p>如果来自服务器的响应并非 XML，请使用 responseText 属性。</p>
<p>responseText 属性返回字符串形式的响应，因此您可以这样使用：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div></pre></td></tr></table></figure>
<p>2、responseXML 属性</p>
<p>如果来自服务器的响应是 XML，而且需要作为 XML 对象进行解析，请使用 responseXML 属性：</p>
<p>请求 <a href="http://www.w3school.com.cn/example/xmle/books.xml" target="_blank" rel="external">books.xml</a> 文件，并解析响应：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="javascript"></span></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">loadXMLDoc</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line"><span class="keyword">var</span> xmlhttp;</div><div class="line"><span class="keyword">var</span> txt,x,i;</div><div class="line"><span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest)</div><div class="line">  &#123;<span class="comment">// code for IE7+, Firefox, Chrome, Opera, Safari</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> XMLHttpRequest();</div><div class="line">  &#125;</div><div class="line"><span class="keyword">else</span></div><div class="line">  &#123;<span class="comment">// code for IE6, IE5</span></div><div class="line">  xmlhttp=<span class="keyword">new</span> ActiveXObject(<span class="string">"Microsoft.XMLHTTP"</span>);</div><div class="line">  &#125;</div><div class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    xmlDoc=xmlhttp.responseXML;</div><div class="line">    txt=<span class="string">""</span>;</div><div class="line">    x=xmlDoc.getElementsByTagName(<span class="string">"title"</span>);</div><div class="line">    <span class="keyword">for</span> (i=<span class="number">0</span>;i&lt;x.length;i++)</div><div class="line">      &#123;</div><div class="line">      txt=txt + x[i].childNodes[<span class="number">0</span>].nodeValue + <span class="string">"&lt;br /&gt;"</span>;</div><div class="line">      &#125;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=txt;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">xmlhttp.open(<span class="string">"GET"</span>,<span class="string">"/example/xmle/books.xml"</span>,<span class="literal">true</span>);</div><div class="line">xmlhttp.send();</div><div class="line">&#125;</div><div class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>My Book Collection:<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"myDiv"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">onclick</span>=<span class="string">"loadXMLDoc()"</span>&gt;</span>获得我的图书收藏列表<span class="tag">&lt;/<span class="name">button</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>onreadystatechange 事件</li>
</ul>
<p>当请求被发送到服务器时，我们需要执行一些基于响应的任务。每当 readyState 改变时，就会触发 onreadystatechange 事件。readyState 属性存有 XMLHttpRequest 的状态信息。</p>
<p>下面是 XMLHttpRequest 对象的三个重要的属性：</p>
<blockquote>
<ul>
<li>onreadystatechange  存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数</li>
<li>readyState  存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。<ul>
<li>0: 请求未初始化</li>
<li>1: 服务器连接已建立</li>
<li>2: 请求已接收</li>
<li>3: 请求处理中</li>
<li>4: 请求已完成，且响应已就绪</li>
</ul>
</li>
<li>status<ul>
<li>200:  “OK”</li>
<li>404:  未找到页面</li>
</ul>
</li>
</ul>
</blockquote>
<p>在 onreadystatechange 事件中，我们规定当服务器响应已做好被处理的准备时所执行的任务。</p>
<p>当 readyState 等于 4 且状态为 200 时，表示响应已就绪：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">xmlhttp.onreadystatechange=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p><strong>使用 Callback 函数</strong></p>
<p>callback 函数是一种以参数形式传递给另一个函数的函数。</p>
<p>如果您的网站上存在多个 AJAX 任务，那么您应该为创建 XMLHttpRequest 对象编写一个<em>标准</em> 的函数，并为每个 AJAX 任务调用该函数。</p>
<p>该函数调用应该包含 URL 以及发生 onreadystatechange 事件时执行的任务（每次调用可能不尽相同）：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">myFunction</span>(<span class="params"></span>)</span></div><div class="line">&#123;</div><div class="line">loadXMLDoc(<span class="string">"ajax_info.txt"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span></div><div class="line">  &#123;</div><div class="line">  <span class="keyword">if</span> (xmlhttp.readyState==<span class="number">4</span> &amp;&amp; xmlhttp.status==<span class="number">200</span>)</div><div class="line">    &#123;</div><div class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"myDiv"</span>).innerHTML=xmlhttp.responseText;</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="AJAX-高级"><a href="#AJAX-高级" class="headerlink" title="AJAX - 高级"></a>AJAX - 高级</h3><p><a href="http://www.w3school.com.cn/ajax/ajax_asp_php.asp" target="_blank" rel="external">ASP/PHP 请求实例 - AJAX 用于创造动态性更强的应用程序。</a></p>
<p><a href="http://www.w3school.com.cn/ajax/ajax_database.asp" target="_blank" rel="external">AJAX 可用来与数据库进行动态通信。</a></p>
<p><a href="http://www.w3school.com.cn/ajax/ajax_xmlfile.asp" target="_blank" rel="external">AJAX 可用来与 XML 文件进行交互式通信。</a></p>
<h3 id="AJAX-实例"><a href="#AJAX-实例" class="headerlink" title="AJAX 实例"></a>AJAX 实例</h3><p><a href="http://www.w3school.com.cn/example/ajax_examples.asp" target="_blank" rel="external">使用 XMLHttpRequest 对象的实例</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;背景&quot;&gt;&lt;a href=&quot;#背景&quot; class=&quot;headerlink&quot; title=&quot;背景&quot;&gt;&lt;/a&gt;背景&lt;/h3&gt;&lt;p&gt;最近的项目中大量地方需要使用 AJAX，无奈，谁叫我既要写前台又要写后台呢，只好学习下这个技术点，主要参考 &lt;a href=&quot;http://www.w3school.com.cn/ajax/index.asp&quot;&gt;W3school 文档&lt;/a&gt;，下面记录下这些知识点，便于日后自己查阅，下面的一些测试代码建议在 W3school 中测试。&lt;/p&gt;
&lt;h3 id=&quot;AJAX-基础：&quot;&gt;&lt;a href=&quot;#AJAX-基础：&quot; class=&quot;headerlink&quot; title=&quot;AJAX 基础：&quot;&gt;&lt;/a&gt;AJAX 基础：&lt;/h3&gt;&lt;p&gt; AJAX = Asynchronous JavaScript and XML（异步的 JavaScript 和 XML）。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;AJAX 是一种在无需重新加载整个网页的情况下，能够更新部分网页的技术。&lt;/strong&gt; 在很多网站可以见到使用这种技术。&lt;br&gt;
    
    </summary>
    
    
      <category term="AJAX" scheme="http://yoursite.com/tags/AJAX/"/>
    
  </entry>
  
  <entry>
    <title>java.sql.SQLException Field &#39;id&#39; doesn&#39;t have a default value</title>
    <link href="http://yoursite.com/2017/06/20/Java-error1/"/>
    <id>http://yoursite.com/2017/06/20/Java-error1/</id>
    <published>2017-06-20T07:10:47.405Z</published>
    <updated>2017-06-20T07:15:22.728Z</updated>
    
    <content type="html"><![CDATA[<p>1、错误描述</p>
<p>在做一个电商网站项目时，使用 Mybatis + MySQL 时出现问题 <code>Caused by: java.sql.SQLException: Field &#39;id&#39; doesn&#39;t have a default value</code> ，网上很多人说是 <a href="https://my.oschina.net/boonya/blog/692232" target="_blank" rel="external">MyBatis 插入数据行 ID 没生成自增</a>。但是我尝试好久，没解决该问题。</p>
<p>2、错误原因</p>
<p>后来才发现是因为创建数据库时的建表语句中的 id 是主键的，但是在插入的过程中，没有给予数值，并且没有让 id 自增。</p>
<p>3、解决办法</p>
<p>修改数据库表中的id，让其自增（在插入的过程中，不插入id数据时）。</p>
<p>（我是直接将整个数据库都导出来，然后在每个表的 id 后面加上一个 <code>auto_increment</code>）, 如下 ：<br><a id="more"></a><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`d_user`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> auto_increment,</div><div class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`zip`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`address`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`phone`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</div><div class="line">)</div></pre></td></tr></table></figure></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;1、错误描述&lt;/p&gt;
&lt;p&gt;在做一个电商网站项目时，使用 Mybatis + MySQL 时出现问题 &lt;code&gt;Caused by: java.sql.SQLException: Field &amp;#39;id&amp;#39; doesn&amp;#39;t have a default value&lt;/code&gt; ，网上很多人说是 &lt;a href=&quot;https://my.oschina.net/boonya/blog/692232&quot;&gt;MyBatis 插入数据行 ID 没生成自增&lt;/a&gt;。但是我尝试好久，没解决该问题。&lt;/p&gt;
&lt;p&gt;2、错误原因&lt;/p&gt;
&lt;p&gt;后来才发现是因为创建数据库时的建表语句中的 id 是主键的，但是在插入的过程中，没有给予数值，并且没有让 id 自增。&lt;/p&gt;
&lt;p&gt;3、解决办法&lt;/p&gt;
&lt;p&gt;修改数据库表中的id，让其自增（在插入的过程中，不插入id数据时）。&lt;/p&gt;
&lt;p&gt;（我是直接将整个数据库都导出来，然后在每个表的 id 后面加上一个 &lt;code&gt;auto_increment&lt;/code&gt;）, 如下 ：&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>搭建一个博客项目后的碎碎念</title>
    <link href="http://yoursite.com/2017/06/17/blog-talk/"/>
    <id>http://yoursite.com/2017/06/17/blog-talk/</id>
    <published>2017-06-17T14:01:44.007Z</published>
    <updated>2017-06-17T14:02:13.016Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><blockquote>
<p>以前大二的时候就想一个人独立做一个由 Java 开发的个人博客, 可耐当时还很弱鸡，一个人难以独挡一片，因为要会的东西太多，后来自己看到很多都是由 WordPress 搭建的博客，很多模板很漂亮，可是自己要稍微对 “拍黄片” 了解一点，并且里面的各种插件特特别的多。去年的时候就开始用上了 GitHub Page 搭建静态的博客，因为自己一直习惯用 Markdown 写作，写完后，软件可以直接生成 PDF 和 HTML 文件，这样就很方便了，直接将自己的 HTML、PDF 和 MD 文件一起 push 到 GitHub 上，然后自己在通过域名加上文章链接就可以直接访问我的博客了，这样就省了很多事了。还提供了 PDF 和 MD 版本，对有不同需求的人都可满足了。可是后来觉得这样的逼格还是不够高，就又开始折腾 Hexo 了，发现用 Hexo 也是很非常简单的（其实是看到 Hexo 的 yilia 主题非常漂亮）。于是就换上了 Hexo 了，自己在这上面写博客也很方便。每次用软件写完后，在 Git Bash 下敲一行命令 <code>hexo d -g</code> 就行了，很方便！前段时间看到了一款开源的博客（由 Java 搭建而成）——  Tale，主题比较简洁，符合程序员的范。也刚好符合自己最初的想法，但是我是没打算放弃现在的博客，就是有一个想法，自己也跟着在那个基础山修改下。（因为 Tale 使用的是轻量级 mvc 框架 <code>Blade</code> 开发，我好像不太了解这个框架呢），想着就 SpringBoot 开发比较快，上手也简单。当时就有这个想法，可怜没时间，不过前些天发现有人就是基于那个 Tale 博客重新修改了，用的就是 SpringBoot ，哇，果然是英雄所见略同。当时就和作者邮件联系了，于是蹭这些天的时间赶紧去看看，结果不只是看看，完全自己就全部敲了一遍，终于在今天搞定了，为了庆祝，才写下这篇文章，好好记录这些美好的时刻（博客可以完全发挥，不限题材）。通过自己深入这个项目，才能够很了解内部的实现方式，这点收获很大，这十天时间花的值，再此感谢两位原作者 <a href="https://github.com/ZHENFENG13" target="_blank" rel="external">ZHENFENG13</a> 、<a href="https://github.com/otale" target="_blank" rel="external">otale</a> 。</p>
</blockquote>
<a id="more"></a>
<h3 id="博客介绍"><a href="#博客介绍" class="headerlink" title="博客介绍"></a>博客介绍</h3><p><code>Tale</code> 使用了轻量级 mvc 框架 <code>Blade</code> 开发，默认主题使用了漂亮的 <code>pinghsu</code> 。</p>
<p><code>My-Blog</code> 使用的是 Docker + SpringBoot + Mybatis + thymeleaf 打造的一个个人博客模板。</p>
<p><a href="https://github.com/zhisheng17/blog" target="_blank" rel="external">Blog</a>  是自己花了十天的时间把整个项目的代码都敲了一遍，熟悉了整个项目，做了优化，去除了 Docker， 其中修改了原来的一些 bug，并在原作者的项目中提出了 issue ， 原作者已修复。</p>
<p>: 喜欢该项目的话，可以给项目点个 star，如果你想在这基础上修改，那么建议你 fork 该<a href="https://github.com/zhisheng17/blog" target="_blank" rel="external">项目</a>，然后再修改哦。</p>
<p>博客首页：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/index.png" alt=""></p>
<p>归档：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/metas.png" alt=""></p>
<p>友链：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/links.png" alt=""></p>
<p>关于：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/about.png" alt=""></p>
<p>搜索：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/search.png" alt=""></p>
<p><strong>后台管理</strong></p>
<p>管理登录：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-login.png" alt=""></p>
<p>管理首页：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-index.png" alt=""></p>
<p>发布文章：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-publish.png" alt=""></p>
<p>文章管理：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-article.png" alt=""></p>
<p>页面管理：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-pages.png" alt=""></p>
<p>分类标签：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-category.png" alt=""></p>
<p>文件管理：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-upload.png" alt=""></p>
<p>友链管理：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-links.png" alt=""></p>
<p>系统设置：</p>
<p><img src="https://github.com/zhisheng17/blog/raw/master/img/admin-setting.png" alt=""></p>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>我什么我这么喜欢折腾博客呢，熟悉我的朋友都知道，我再很多平台都写过博客，有些是他们平台的运营人员邀请过去的。可是在这些平台上写博客终究是没有感觉，如今自己在自己的博客网站写文章，比较轻松，而且也符合我的写作风格。在其他的平台都有些大大小小的不适（对程序员来说应该是 bug），虽然目前还是会在这些平台继续发布我新写的文章，但是我保证最新的文章，首发肯定是我自己的博客网站，有些是不会在其他平台发的，有觉得不错的可以 RSS 订阅我的博客，或者是直接收藏网址下来。自从写博客下来遇到很多志同道合的人，这点正是让我觉得有写下去的必要了。自己将会坚持下去，时刻警醒自己：勿忘初心！最后的最后，还是想说一句：如果你想和我一样折腾博客，那么我建议你先在一家平台坚持写下去，等博客数量上来了，在自己折腾自己的博客网站。还有就是你想提高自己的话，还是需要很在意你的基础，然后就是要多练手几个项目，我自己在练手这个项目的时候就收获很多。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;以前大二的时候就想一个人独立做一个由 Java 开发的个人博客, 可耐当时还很弱鸡，一个人难以独挡一片，因为要会的东西太多，后来自己看到很多都是由 WordPress 搭建的博客，很多模板很漂亮，可是自己要稍微对 “拍黄片” 了解一点，并且里面的各种插件特特别的多。去年的时候就开始用上了 GitHub Page 搭建静态的博客，因为自己一直习惯用 Markdown 写作，写完后，软件可以直接生成 PDF 和 HTML 文件，这样就很方便了，直接将自己的 HTML、PDF 和 MD 文件一起 push 到 GitHub 上，然后自己在通过域名加上文章链接就可以直接访问我的博客了，这样就省了很多事了。还提供了 PDF 和 MD 版本，对有不同需求的人都可满足了。可是后来觉得这样的逼格还是不够高，就又开始折腾 Hexo 了，发现用 Hexo 也是很非常简单的（其实是看到 Hexo 的 yilia 主题非常漂亮）。于是就换上了 Hexo 了，自己在这上面写博客也很方便。每次用软件写完后，在 Git Bash 下敲一行命令 &lt;code&gt;hexo d -g&lt;/code&gt; 就行了，很方便！前段时间看到了一款开源的博客（由 Java 搭建而成）——  Tale，主题比较简洁，符合程序员的范。也刚好符合自己最初的想法，但是我是没打算放弃现在的博客，就是有一个想法，自己也跟着在那个基础山修改下。（因为 Tale 使用的是轻量级 mvc 框架 &lt;code&gt;Blade&lt;/code&gt; 开发，我好像不太了解这个框架呢），想着就 SpringBoot 开发比较快，上手也简单。当时就有这个想法，可怜没时间，不过前些天发现有人就是基于那个 Tale 博客重新修改了，用的就是 SpringBoot ，哇，果然是英雄所见略同。当时就和作者邮件联系了，于是蹭这些天的时间赶紧去看看，结果不只是看看，完全自己就全部敲了一遍，终于在今天搞定了，为了庆祝，才写下这篇文章，好好记录这些美好的时刻（博客可以完全发挥，不限题材）。通过自己深入这个项目，才能够很了解内部的实现方式，这点收获很大，这十天时间花的值，再此感谢两位原作者 &lt;a href=&quot;https://github.com/ZHENFENG13&quot;&gt;ZHENFENG13&lt;/a&gt; 、&lt;a href=&quot;https://github.com/otale&quot;&gt;otale&lt;/a&gt; 。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Hexo + yilia 主题实现文章目录</title>
    <link href="http://yoursite.com/2017/06/13/Hexo-yilia-toc/"/>
    <id>http://yoursite.com/2017/06/13/Hexo-yilia-toc/</id>
    <published>2017-06-13T10:53:33.974Z</published>
    <updated>2017-06-13T11:04:57.548Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>为了方便查看每篇文章的目录结构，可以定位到想看的地方，特地找了下如何实现这个功能。</p>
<h3 id="添加-CSS-样式"><a href="#添加-CSS-样式" class="headerlink" title="添加 CSS 样式"></a>添加 CSS 样式</h3><p>打开 <code>themes\yilia\source</code> 下的 <code>main.234bc0.css</code> 文件，直接在后面添加如下代码：<br><a id="more"></a><br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* 新添加的 */</span></div><div class="line"><span class="selector-id">#container</span> <span class="selector-class">.show-toc-btn</span>,<span class="selector-id">#container</span> <span class="selector-class">.toc-article</span>&#123;<span class="attribute">display</span>:block&#125;</div><div class="line"><span class="selector-class">.toc-article</span>&#123;<span class="attribute">z-index</span>:<span class="number">100</span>;<span class="attribute">background</span>:<span class="number">#fff</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ccc</span>;<span class="attribute">max-width</span>:<span class="number">250px</span>;<span class="attribute">min-width</span>:<span class="number">150px</span>;<span class="attribute">max-height</span>:<span class="number">500px</span>;<span class="attribute">overflow-y</span>:auto;<span class="attribute">-webkit-box-shadow</span>:<span class="number">5px</span> <span class="number">5px</span> <span class="number">2px</span> <span class="number">#ccc</span>;<span class="attribute">box-shadow</span>:<span class="number">5px</span> <span class="number">5px</span> <span class="number">2px</span> <span class="number">#ccc</span>;<span class="attribute">font-size</span>:<span class="number">12px</span>;<span class="attribute">padding</span>:<span class="number">10px</span>;<span class="attribute">position</span>:fixed;<span class="attribute">right</span>:<span class="number">35px</span>;<span class="attribute">top</span>:<span class="number">129px</span>&#125;<span class="selector-class">.toc-article</span> <span class="selector-class">.toc-close</span>&#123;<span class="attribute">font-weight</span>:<span class="number">700</span>;<span class="attribute">font-size</span>:<span class="number">20px</span>;<span class="attribute">cursor</span>:pointer;<span class="attribute">float</span>:right;<span class="attribute">color</span>:<span class="number">#ccc</span>&#125;<span class="selector-class">.toc-article</span> <span class="selector-class">.toc-close</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">color</span>:<span class="number">#000</span>&#125;<span class="selector-class">.toc-article</span> <span class="selector-class">.toc</span>&#123;<span class="attribute">font-size</span>:<span class="number">12px</span>;<span class="attribute">padding</span>:<span class="number">0</span>;<span class="attribute">line-height</span>:<span class="number">20px</span>&#125;<span class="selector-class">.toc-article</span> <span class="selector-class">.toc</span> <span class="selector-class">.toc-number</span>&#123;<span class="attribute">color</span>:<span class="number">#333</span>&#125;<span class="selector-class">.toc-article</span> <span class="selector-class">.toc</span> <span class="selector-class">.toc-text</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">text-decoration</span>:underline;<span class="attribute">color</span>:<span class="number">#2a6496</span>&#125;<span class="selector-class">.toc-article</span> <span class="selector-tag">li</span>&#123;<span class="attribute">list-style-type</span>:none&#125;<span class="selector-class">.toc-article</span> <span class="selector-class">.toc-level-1</span>&#123;<span class="attribute">margin</span>:<span class="number">4px</span> <span class="number">0</span>&#125;<span class="selector-class">.toc-article</span> <span class="selector-class">.toc-child</span>&#123;&#125;@-<span class="keyword">moz</span>-<span class="keyword">keyframes</span> cd-bounce-<span class="number">1</span>&#123;0%&#123;<span class="attribute">opacity</span>:<span class="number">0</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;60%&#123;<span class="attribute">opacity</span>:<span class="number">1</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1.01)&#125;100%&#123;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;&#125;@-<span class="keyword">webkit</span>-<span class="keyword">keyframes</span> cd-bounce-<span class="number">1</span>&#123;0%&#123;<span class="attribute">opacity</span>:<span class="number">0</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;60%&#123;<span class="attribute">opacity</span>:<span class="number">1</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1.01)&#125;100%&#123;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;&#125;@-<span class="keyword">o</span>-<span class="keyword">keyframes</span> cd-bounce-<span class="number">1</span>&#123;0%&#123;<span class="attribute">opacity</span>:<span class="number">0</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;60%&#123;<span class="attribute">opacity</span>:<span class="number">1</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1.01)&#125;100%&#123;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;&#125;@<span class="keyword">keyframes</span> cd-bounce-<span class="number">1</span>&#123;0%&#123;<span class="attribute">opacity</span>:<span class="number">0</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;60%&#123;<span class="attribute">opacity</span>:<span class="number">1</span>;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1.01);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1.01)&#125;100%&#123;<span class="attribute">-o-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-webkit-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-moz-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">-ms-transform</span>:<span class="built_in">scale</span>(1);<span class="attribute">transform</span>:<span class="built_in">scale</span>(1)&#125;&#125;<span class="selector-class">.show-toc-btn</span>&#123;<span class="attribute">display</span>:none;<span class="attribute">z-index</span>:<span class="number">10</span>;<span class="attribute">width</span>:<span class="number">30px</span>;<span class="attribute">min-height</span>:<span class="number">14px</span>;<span class="attribute">overflow</span>:hidden;<span class="attribute">padding</span>:<span class="number">4px</span> <span class="number">6px</span> <span class="number">8px</span> <span class="number">5px</span>;<span class="attribute">border</span>:<span class="number">1px</span> solid <span class="number">#ddd</span>;<span class="attribute">border-right</span>:none;<span class="attribute">position</span>:fixed;<span class="attribute">right</span>:<span class="number">40px</span>;<span class="attribute">text-align</span>:center;<span class="attribute">background-color</span>:<span class="number">#f9f9f9</span>&#125;<span class="selector-class">.show-toc-btn</span> <span class="selector-class">.btn-bg</span>&#123;<span class="attribute">margin-top</span>:<span class="number">2px</span>;<span class="attribute">display</span>:block;<span class="attribute">width</span>:<span class="number">16px</span>;<span class="attribute">height</span>:<span class="number">14px</span>;<span class="attribute">background</span>:<span class="built_in">url</span>(http://7xtawy.com1.z0.glb.clouddn.com/show.png) no-repeat;<span class="attribute">-webkit-background-size</span>:<span class="number">100%</span>;<span class="attribute">-moz-background-size</span>:<span class="number">100%</span>;<span class="attribute">background-size</span>:<span class="number">100%</span>&#125;<span class="selector-class">.show-toc-btn</span> <span class="selector-class">.btn-text</span>&#123;<span class="attribute">color</span>:<span class="number">#999</span>;<span class="attribute">font-size</span>:<span class="number">12px</span>&#125;<span class="selector-class">.show-toc-btn</span><span class="selector-pseudo">:hover</span>&#123;<span class="attribute">cursor</span>:pointer&#125;<span class="selector-class">.show-toc-btn</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.btn-bg</span>&#123;<span class="attribute">background-position</span>:<span class="number">0</span> -<span class="number">16px</span>&#125;<span class="selector-class">.show-toc-btn</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.btn-text</span>&#123;<span class="attribute">font-size</span>:<span class="number">12px</span>;<span class="attribute">color</span>:<span class="number">#ea8010</span>&#125;</div><div class="line"><span class="selector-class">.toc-article</span> <span class="selector-tag">li</span> <span class="selector-tag">ol</span>, <span class="selector-class">.toc-article</span> <span class="selector-tag">li</span> <span class="selector-tag">ul</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: <span class="number">30px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.toc-article</span> <span class="selector-tag">ol</span>, <span class="selector-class">.toc-article</span> <span class="selector-tag">ul</span> &#123;</div><div class="line">    <span class="attribute">margin</span>: <span class="number">10px</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="修改-article-ejs-文件"><a href="#修改-article-ejs-文件" class="headerlink" title="修改 article.ejs 文件"></a>修改 article.ejs 文件</h3><p>打开 <code>themes\yilia\layout\_partial</code> 文件夹下的 <code>article.ejs</code> 文件,  在 <code>&lt;/header&gt; &lt;% } %&gt;</code> 下面加入如下内容（注意位置）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 目录内容 --&gt;</div><div class="line">&lt;% if (!index &amp;&amp; post.toc)&#123; %&gt;</div><div class="line">    &lt;p class=&quot;show-toc-btn&quot; id=&quot;show-toc-btn&quot; onclick=&quot;showToc();&quot; style=&quot;display:none&quot;&gt;</div><div class="line">          &lt;span class=&quot;btn-bg&quot;&gt;&lt;/span&gt;</div><div class="line">          &lt;span class=&quot;btn-text&quot;&gt;文章导航&lt;/span&gt;</div><div class="line">          &lt;/p&gt;</div><div class="line">	&lt;div id=&quot;toc-article&quot; class=&quot;toc-article&quot;&gt;</div><div class="line">	    &lt;span id=&quot;toc-close&quot; class=&quot;toc-close&quot; title=&quot;隐藏导航&quot; onclick=&quot;showBtn();&quot;&gt;×&lt;/span&gt;</div><div class="line">		&lt;strong class=&quot;toc-title&quot;&gt;文章目录&lt;/strong&gt;</div><div class="line">           &lt;%- toc(post.content) %&gt;</div><div class="line">         &lt;/div&gt;</div><div class="line">   &lt;script type=&quot;text/javascript&quot;&gt;</div><div class="line">	function showToc()&#123;</div><div class="line">		var toc_article = document.getElementById(&quot;toc-article&quot;);</div><div class="line">		var show_toc_btn = document.getElementById(&quot;show-toc-btn&quot;);</div><div class="line">		toc_article.setAttribute(&quot;style&quot;,&quot;display:block&quot;);</div><div class="line">		show_toc_btn.setAttribute(&quot;style&quot;,&quot;display:none&quot;);</div><div class="line">		&#125;;</div><div class="line">	function showBtn()&#123;</div><div class="line">		var toc_article = document.getElementById(&quot;toc-article&quot;);</div><div class="line">		var show_toc_btn = document.getElementById(&quot;show-toc-btn&quot;);</div><div class="line">		toc_article.setAttribute(&quot;style&quot;,&quot;display:none&quot;);</div><div class="line">		show_toc_btn.setAttribute(&quot;style&quot;,&quot;display:block&quot;);</div><div class="line">		&#125;;</div><div class="line">   &lt;/script&gt;</div><div class="line">      &lt;% &#125; %&gt;</div><div class="line">&lt;!-- 目录内容结束 --&gt;</div></pre></td></tr></table></figure>
<p>然后若想要文章显示目录，在每篇文章开头加入：<code>toc: true</code>  即可。</p>
<p>参考文章：<a href="http://lawlite.me/2017/04/17/Hexo-yilia%E4%B8%BB%E9%A2%98%E5%AE%9E%E7%8E%B0%E6%96%87%E7%AB%A0%E7%9B%AE%E5%BD%95%E5%92%8C%E6%B7%BB%E5%8A%A0%E8%A7%86%E9%A2%91/" target="_blank" rel="external">Hexo+yilia主题实现文章目录和添加视频 </a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前提&quot;&gt;&lt;a href=&quot;#前提&quot; class=&quot;headerlink&quot; title=&quot;前提&quot;&gt;&lt;/a&gt;前提&lt;/h3&gt;&lt;p&gt;为了方便查看每篇文章的目录结构，可以定位到想看的地方，特地找了下如何实现这个功能。&lt;/p&gt;
&lt;h3 id=&quot;添加-CSS-样式&quot;&gt;&lt;a href=&quot;#添加-CSS-样式&quot; class=&quot;headerlink&quot; title=&quot;添加 CSS 样式&quot;&gt;&lt;/a&gt;添加 CSS 样式&lt;/h3&gt;&lt;p&gt;打开 &lt;code&gt;themes\yilia\source&lt;/code&gt; 下的 &lt;code&gt;main.234bc0.css&lt;/code&gt; 文件，直接在后面添加如下代码：&lt;br&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
  </entry>
  
  <entry>
    <title>HashMap、Hashtable、HashSet 和 ConcurrentHashMap 的比较</title>
    <link href="http://yoursite.com/2017/06/10/HashMap-Hashtable/"/>
    <id>http://yoursite.com/2017/06/10/HashMap-Hashtable/</id>
    <published>2017-06-10T14:09:09.072Z</published>
    <updated>2017-06-13T10:37:50.894Z</updated>
    
    <content type="html"><![CDATA[<p>HashMap 和 Hashtable 的比较是 Java 面试中的常见问题，用来考验程序员是否能够正确使用集合类以及是否可以随机应变使用多种思路解决问题。HashMap 的工作原理、ArrayList 与 Vector 的比较以及这个问题是有关 Java 集合框架的最经典的问题。Hashtable 是个过时的集合类，存在于 Java API 中很久了。在 Java 4 中被重写了，实现了 Map 接口，所以自此以后也成了 Java 集合框架中的一部分。Hashtable 和 HashMap 在 Java 面试中相当容易被问到，甚至成为了集合框架面试题中最常被考的问题，所以在参加任何 Java 面试之前，都不要忘了准备这一题。<br><a id="more"></a><br>这篇文章中，我们不仅将会看到 HashMap 和 Hashtable 的区别，还将看到它们之间的相似之处。</p>
<h3 id="HashMap-和-Hashtable-的区别"><a href="#HashMap-和-Hashtable-的区别" class="headerlink" title="HashMap 和 Hashtable 的区别"></a>HashMap 和 Hashtable 的区别</h3><p>HashMap 和 Hashtable 都实现了 Map 接口，但决定用哪一个之前先要弄清楚它们之间的分别。主要的区别有：线程安全性，同步 (synchronization)，以及速度。</p>
<ol>
<li>HashMap 几乎可以等价于 Hashtable，除了 HashMap 是非 synchronized 的，并可以接受 null(HashMap 可以接受为 null 的键值 (key) 和值 (value)，而 Hashtable 则不行)。</li>
<li>HashMap 是非 synchronized，而 Hashtable 是 synchronized，这意味着 Hashtable 是线程安全的，多个线程可以共享一个 Hashtable；而如果没有正确的同步的话，多个线程是不能共享 HashMap 的。Java 5 提供了 ConcurrentHashMap，它是 HashTable 的替代，比 HashTable 的扩展性更好。</li>
<li>另一个区别是 HashMap 的迭代器 (Iterator) 是 fail-fast 迭代器，而 Hashtable 的 enumerator 迭代器不是 fail-fast 的。所以当有其它线程改变了 HashMap 的结构（增加或者移除元素），将会抛出ConcurrentModificationException，但迭代器本身的 remove() 方法移除元素则不会抛出ConcurrentModificationException 异常。但这并不是一个一定发生的行为，要看 JVM。这条同样也是Enumeration 和 Iterato r的区别。</li>
<li>由于 Hashtable 是线程安全的也是 synchronized，所以在单线程环境下它比 HashMap 要慢。如果你不需要同步，只需要单一线程，那么使用 HashMap 性能要好过 Hashtable。</li>
<li>HashMap 不能保证随着时间的推移 Map 中的元素次序是不变的。</li>
</ol>
<h3 id="要注意的一些重要术语："><a href="#要注意的一些重要术语：" class="headerlink" title="要注意的一些重要术语："></a>要注意的一些重要术语：</h3><p>1) sychronized 意味着在一次仅有一个线程能够更改 Hashtable。就是说任何线程要更新 Hashtable 时要首先获得同步锁，其它线程要等到同步锁被释放之后才能再次获得同步锁更新 Hashtable。</p>
<p>2) Fail-safe 和 iterator 迭代器相关。如果某个集合对象创建了 Iterator 或者 ListIterator，然后其它的线程试图“结构上”更改集合对象，将会抛出 ConcurrentModificationException 异常。但其它线程可以通过 set() 方法更改集合对象是允许的，因为这并没有从“结构上”更改集合。但是假如已经从结构上进行了更改，再调用 set() 方法，将会抛出 IllegalArgumentException 异常。</p>
<p>3) 结构上的更改指的是删除或者插入一个元素，这样会影响到 map 的结构。</p>
<h3 id="我们能否让-HashMap-同步？"><a href="#我们能否让-HashMap-同步？" class="headerlink" title="我们能否让 HashMap 同步？"></a>我们能否让 HashMap 同步？</h3><p>HashMap 可以通过下面的语句进行同步：<br>Map m = Collections.synchronizeMap(hashMap);</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p>Hashtable 和 HashMap 有几个主要的不同：线程安全以及速度。仅在你需要完全的线程安全的时候使用Hashtable，而如果你使用 Java 5 或以上的话，请使用 ConcurrentHashMap 吧。</p>
<p>转载自：<a href="http://www.importnew.com/7010.html" target="_blank" rel="external">HashMap和Hashtable的区别</a></p>
<hr>
<p>关于 HashMap 线程不安全这一点，《Java并发编程的艺术》一书中是这样说的：</p>
<blockquote>
<p>HashMap 在并发执行 put 操作时会引起死循环，导致 CPU 利用率接近 100%。因为多线程会导致 HashMap 的 Node 链表形成环形数据结构，一旦形成环形数据结构，Node 的 next 节点永远不为空，就会在获取 Node 时产生死循环。</p>
</blockquote>
<p>原因：</p>
<ul>
<li><a href="http://coolshell.cn/articles/9606.html" target="_blank" rel="external">疫苗：JAVA HASHMAP的死循环 —— 酷壳</a></li>
<li><a href="http://firezhfox.iteye.com/blog/2241043" target="_blank" rel="external">HashMap在java并发中如何发生死循环</a></li>
<li><a href="http://coding-geek.com/how-does-a-hashmap-work-in-java/" target="_blank" rel="external">How does a HashMap work in JAVA</a></li>
</ul>
<hr>
<p>下面的是自己有道云笔记中记录的：</p>
<p><strong>HashMap ， HashTable 和 HashSet 区别</strong></p>
<ol>
<li>关于 HashMap 的一些说法：</li>
</ol>
<p>a)  HashMap 实际上是一个“链表散列”的数据结构，即数组和链表的结合体。HashMap 的底层结构是一个数组，数组中的每一项是一条链表。</p>
<p>b)  HashMap 的实例有俩个参数影响其性能： “初始容量” 和 装填因子。</p>
<p>c)  HashMap 实现不同步，线程不安全。  HashTable 线程安全</p>
<p>d)  HashMap 中的 key-value 都是存储在 Entry 中的。</p>
<p>e)  HashMap 可以存 null 键和 null 值，不保证元素的顺序恒久不变，它的底层使用的是数组和链表，通过hashCode() 方法和 equals 方法保证键的唯一性</p>
<p>f)  解决冲突主要有三种方法：定址法，拉链法，再散列法。HashMap 是采用拉链法解决哈希冲突的。</p>
<p>注： 链表法是将相同 hash 值的对象组成一个链表放在 hash 值对应的槽位；</p>
<p>用开放定址法解决冲突的做法是：当冲突发生时，使用某种探查(亦称探测)技术在散列表中形成一个探查(测)序列。 沿此序列逐个单元地查找，直到找到给定 的关键字，或者碰到一个开放的地址(即该地址单元为空)为止（若要插入，在探查到开放的地址，则可将待插入的新结点存人该地址单元）。</p>
<p>拉链法解决冲突的做法是： 将所有关键字为同义词的结点链接在同一个单链表中 。若选定的散列表长度为m，则可将散列表定义为一个由m个头指针组成的指针数 组T[0..m-1]。凡是散列地址为i的结点，均插入到以T[i]为头指针的单链表中。T中各分量的初值均应为空指针。在拉链法中，装填因子α可以大于1，但一般均取α≤1。拉链法适合未规定元素的大小。</p>
<ol>
<li>Hashtable 和 HashMap 的区别：</li>
</ol>
<p>a)   继承不同。</p>
<p> public class Hashtable extends Dictionary implements Map</p>
<p>public class HashMap extends  AbstractMap implements Map</p>
<p>b)  Hashtable 中的方法是同步的，而 HashMap 中的方法在缺省情况下是非同步的。在多线程并发的环境下，可以直接使用 Hashtable，但是要使用 HashMap 的话就要自己增加同步处理了。</p>
<p>c)  Hashtable 中， key 和 value 都不允许出现 null 值。 在 HashMap 中， null 可以作为键，这样的键只有一个；可以有一个或多个键所对应的值为 null 。当 get() 方法返回 null 值时，即可以表示 HashMap 中没有该键，也可以表示该键所对应的值为 null 。因此，在 HashMap 中不能由 get() 方法来判断 HashMap 中是否存在某个键， 而应该用 containsKey() 方法来判断。</p>
<p>d)  两个遍历方式的内部实现上不同。Hashtable、HashMap 都使用了Iterator。而由于历史原因，Hashtable还使用了 Enumeration 的方式 。</p>
<p>e)  哈希值的使用不同，HashTable 直接使用对象的 hashCode。而 HashMap 重新计算 hash 值。</p>
<p>f)  Hashtable 和 HashMap 它们两个内部实现方式的数组的初始大小和扩容的方式。HashTable 中 hash 数组默认大小是11，增加的方式是 old*2+1。HashMap 中 hash 数组的默认大小是 16，而且一定是2的指数。</p>
<p>注：  HashSet 子类依靠 hashCode() 和 equal() 方法来区分重复元素。</p>
<p>HashSet 内部使用 Map 保存数据，即将 HashSet 的数据作为 Map 的 key 值保存，这也是 HashSet 中元素不能重复的原因。而 Map 中保存 key 值的,会去判断当前 Map 中是否含有该 Key 对象，内部是先通过 key 的hashCode, 确定有相同的 hashCode 之后，再通过 equals 方法判断是否相同。</p>
<hr>
<p>《HashMap 的工作原理》</p>
<p>HashMap的工作原理是近年来常见的Java面试题。几乎每个Java程序员都知道HashMap，都知道哪里要用HashMap，知道 Hashtable和HashMap之间的区别，那么为何这道面试题如此特殊呢？是因为这道题考察的深度很深。这题经常出现在高级或中高级面试中。投资银行更喜欢问这个问题，甚至会要求你实现HashMap来考察你的编程能力。ConcurrentHashMap和其它同步集合的引入让这道题变得更加复杂。让我们开始探索的旅程吧！</p>
<h3 id="先来些简单的问题"><a href="#先来些简单的问题" class="headerlink" title="先来些简单的问题"></a>先来些简单的问题</h3><p><strong>“你用过HashMap吗？” “什么是HashMap？你为什么用到它？”</strong></p>
<p>几乎每个人都会回答“是的”，然后回答HashMap的一些特性，譬如HashMap可以接受null键值和值，而Hashtable则不能；HashMap是非synchronized;HashMap很快；以及HashMap储存的是键值对等等。这显示出你已经用过HashMap，而且对它相当的熟悉。但是面试官来个急转直下，从此刻开始问出一些刁钻的问题，关于HashMap的更多基础的细节。面试官可能会问出下面的问题：</p>
<p><strong>“你知道HashMap的工作原理吗？” “你知道HashMap的get()方法的工作原理吗？”</strong></p>
<p>你也许会回答“我没有详查标准的Java API，你可以看看Java源代码或者Open JDK。”“我可以用Google找到答案。”</p>
<p>但一些面试者可能可以给出答案，“HashMap是基于hashing的原理，我们使用put(key, value)存储对象到HashMap中，使用get(key)从HashMap中获取对象。当我们给put()方法传递键和值时，我们先对键调用hashCode()方法，返回的hashCode用于找到bucket位置来储存Entry对象。”这里关键点在于指出，HashMap是在bucket中储存键对象和值对象，作为Map.Entry。这一点有助于理解获取对象的逻辑。如果你没有意识到这一点，或者错误的认为仅仅只在bucket中存储值的话，你将不会回答如何从HashMap中获取对象的逻辑。这个答案相当的正确，也显示出面试者确实知道hashing以及HashMap的工作原理。但是这仅仅是故事的开始，当面试官加入一些Java程序员每天要碰到的实际场景的时候，错误的答案频现。下个问题可能是关于HashMap中的碰撞探测(collision detection)以及碰撞的解决方法：</p>
<p><strong>“当两个对象的hashcode相同会发生什么？”</strong> </p>
<p>从这里开始，真正的困惑开始了，一些面试者会回答因为hashcode相同，所以两个对象是相等的，HashMap将会抛出异常，或者不会存储它们。然后面试官可能会提醒他们有equals()和hashCode()两个方法，并告诉他们两个对象就算hashcode相同，但是它们可能并不相等。一些面试者可能就此放弃，而另外一些还能继续挺进，他们回答“因为hashcode相同，所以它们的bucket位置相同，‘碰撞’会发生。因为HashMap使用链表存储对象，这个Entry(包含有键值对的Map.Entry对象)会存储在链表中。”这个答案非常的合理，虽然有很多种处理碰撞的方法，这种方法是最简单的，也正是HashMap的处理方法。但故事还没有完结，面试官会继续问：</p>
<p><strong>“如果两个键的hashcode相同，你如何获取值对象？”</strong></p>
<p> 面试者会回答：当我们调用get()方法，HashMap会使用键对象的hashcode找到bucket位置，然后获取值对象。面试官提醒他如果有两个值对象储存在同一个bucket，他给出答案:将会遍历链表直到找到值对象。面试官会问因为你并没有值对象去比较，你是如何确定确定找到值对象的？除非面试者直到HashMap在链表中存储的是键值对，否则他们不可能回答出这一题。</p>
<p>其中一些记得这个重要知识点的面试者会说，找到bucket位置之后，会调用keys.equals()方法去找到链表中正确的节点，最终找到要找的值对象。完美的答案！</p>
<p>许多情况下，面试者会在这个环节中出错，因为他们混淆了hashCode()和equals()方法。因为在此之前hashCode()屡屡出现，而equals()方法仅仅在获取值对象的时候才出现。一些优秀的开发者会指出使用不可变的、声明作final的对象，并且采用合适的equals()和hashCode()方法的话，将会减少碰撞的发生，提高效率。不可变性使得能够缓存不同键的hashcode，这将提高整个获取对象的速度，使用String，Interger这样的wrapper类作为键是非常好的选择。</p>
<p>如果你认为到这里已经完结了，那么听到下面这个问题的时候，你会大吃一惊。</p>
<p><strong>“如果HashMap的大小超过了负载因子(load factor)定义的容量，怎么办？”</strong></p>
<p>除非你真正知道HashMap的工作原理，否则你将回答不出这道题。默认的负载因子大小为0.75，也就是说，当一个map填满了75%的bucket时候，和其它集合类(如ArrayList等)一样，将会创建原来HashMap大小的两倍的bucket数组，来重新调整map的大小，并将原来的对象放入新的bucket数组中。这个过程叫作rehashing，因为它调用hash方法找到新的bucket位置。</p>
<p>如果你能够回答这道问题，下面的问题来了：</p>
<p><strong>“你了解重新调整HashMap大小存在什么问题吗？”</strong></p>
<p>你可能回答不上来，这时面试官会提醒你当多线程的情况下，可能产生条件竞争(race condition)。</p>
<p>当重新调整HashMap大小的时候，确实存在条件竞争，因为如果两个线程都发现HashMap需要重新调整大小了，它们会同时试着调整大小。在调整大小的过程中，存储在链表中的元素的次序会反过来，因为移动到新的bucket位置的时候，HashMap并不会将元素放在链表的尾部，而是放在头部，这是为了避免尾部遍历(tail traversing)。如果条件竞争发生了，那么就死循环了。这个时候，你可以质问面试官，为什么这么奇怪，要在多线程的环境下使用HashMap呢？：）</p>
<p>热心的读者贡献了更多的关于HashMap的问题：</p>
<ol>
<li><p><strong>为什么String, Interger这样的wrapper类适合作为键？</strong> </p>
<p>String, Interger这样的wrapper类作为HashMap的键是再适合不过了，而且String最为常用。因为String是不可变的，也是final的，而且已经重写了equals()和hashCode()方法了。其他的wrapper类也有这个特点。不可变性是必要的，因为为了要计算hashCode()，就要防止键值改变，如果键值在放入时和获取时返回不同的hashcode的话，那么就不能从HashMap中找到你想要的对象。不可变性还有其他的优点如线程安全。如果你可以仅仅通过将某个field声明成final就能保证hashCode是不变的，那么请这么做吧。因为获取对象的时候要用到equals()和hashCode()方法，那么键对象正确的重写这两个方法是非常重要的。如果两个不相等的对象返回不同的hashcode的话，那么碰撞的几率就会小些，这样就能提高HashMap的性能。</p>
</li>
<li><p><strong>我们可以使用自定义的对象作为键吗？</strong> </p>
<p>这是前一个问题的延伸。当然你可能使用任何对象作为键，只要它遵守了equals()和hashCode()方法的定义规则，并且当对象插入到Map中之后将不会再改变了。如果这个自定义对象时不可变的，那么它已经满足了作为键的条件，因为当它创建之后就已经不能改变了。</p>
</li>
<li><p><strong>我们可以使用CocurrentHashMap来代替Hashtable吗？</strong></p>
<p>这是另外一个很热门的面试题，因为ConcurrentHashMap越来越多人用了。我们知道Hashtable是synchronized的，但是ConcurrentHashMap同步性能更好，因为它仅仅根据同步级别对map的一部分进行上锁。ConcurrentHashMap当然可以代替HashTable，但是HashTable提供更强的线程安全性。看看 <a href="http://javarevisited.blogspot.sg/2011/04/difference-between-concurrenthashmap.html" target="_blank" rel="external">这篇博客</a> 查看Hashtable和ConcurrentHashMap的区别。</p>
</li>
</ol>
<p>我个人很喜欢这个问题，因为这个问题的深度和广度，也不直接的涉及到不同的概念。让我们再来看看这些问题设计哪些知识点：</p>
<ul>
<li>hashing的概念</li>
<li>HashMap中解决碰撞的方法</li>
<li>equals()和hashCode()的应用，以及它们在HashMap中的重要性</li>
<li>不可变对象的好处</li>
<li>HashMap多线程的条件竞争</li>
<li>重新调整HashMap的大小</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="HashMap的工作原理"><a href="#HashMap的工作原理" class="headerlink" title="HashMap的工作原理"></a>HashMap的工作原理</h4><p>HashMap基于hashing原理，我们通过put()和get()方法储存和获取对象。当我们将键值对传递给put()方法时，它调用键对象的hashCode()方法来计算hashcode，让后找到bucket位置来储存值对象。当获取对象时，通过键对象的equals()方法找到正确的键值对，然后返回值对象。HashMap使用链表来解决碰撞问题，当发生碰撞了，对象将会储存在链表的下一个节点中。 HashMap在每个链表节点中储存键值对对象。</p>
<p>当两个不同的键对象的hashcode相同时会发生什么？ 它们会储存在同一个bucket位置的链表中。键对象的equals()方法用来找到键值对。</p>
<p>因为HashMap的好处非常多，我曾经在电子商务的应用中使用HashMap作为缓存。因为金融领域非常多的运用Java，也出于性能的考虑，我们会经常用到HashMap和ConcurrentHashMap。你可以查看更多的关于HashMap的文章:</p>
<ul>
<li><a href="http://www.importnew.com/7010.html" target="_blank" rel="external">HashMap和Hashtable的区别</a></li>
<li><a href="http://www.importnew.com/6931.html" target="_blank" rel="external">HashMap和HashSet的区别</a></li>
</ul>
<p>转载自：<a href="http://www.importnew.com/7099.html" target="_blank" rel="external">HashMap的工作原理</a></p>
<hr>
<p>其他的 HashMap 学习资料：</p>
<ul>
<li><a href="https://segmentfault.com/a/1190000003617333" target="_blank" rel="external">jdk7中HashMap知识点整理</a></li>
<li><a href="http://blog.csdn.net/q291611265/article/details/46797557" target="_blank" rel="external">HashMap源码分析（四）put-jdk8-红黑树的引入</a></li>
<li><a href="https://my.oschina.net/hosee/blog/618953" target="_blank" rel="external">JDK7与JDK8中HashMap的实现</a></li>
<li><a href="https://wenku.baidu.com/view/6e1035943968011ca30091cd.html" target="_blank" rel="external">JDK1.8HashMap原理和源码分析(java面试收藏)</a></li>
<li><a href="http://www.jianshu.com/p/e694f1e868ec" target="_blank" rel="external">谈谈ConcurrentHashMap1.7和1.8的不同实现</a></li>
<li><a href="https://my.oschina.net/pingpangkuangmo/blog/817973" target="_blank" rel="external">jdk1.8的HashMap和ConcurrentHashMap</a></li>
<li><a href="http://blog.csdn.net/u010723709/article/details/48007881" target="_blank" rel="external">ConcurrentHashMap源码分析（JDK8版本）</a></li>
</ul>
<hr>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>谢谢阅读，如果可以的话欢迎大家转发和点赞。如需转载注明<a href="www.54tianzhisheng.cn/2017/06/10/HashMap-Hashtable/">原地址</a>就行。</p>
<p>群 528776268 欢迎各位大牛进群一起讨论。</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/1473414112000.png" alt=""></p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;HashMap 和 Hashtable 的比较是 Java 面试中的常见问题，用来考验程序员是否能够正确使用集合类以及是否可以随机应变使用多种思路解决问题。HashMap 的工作原理、ArrayList 与 Vector 的比较以及这个问题是有关 Java 集合框架的最经典的问题。Hashtable 是个过时的集合类，存在于 Java API 中很久了。在 Java 4 中被重写了，实现了 Map 接口，所以自此以后也成了 Java 集合框架中的一部分。Hashtable 和 HashMap 在 Java 面试中相当容易被问到，甚至成为了集合框架面试题中最常被考的问题，所以在参加任何 Java 面试之前，都不要忘了准备这一题。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>《Java 多线程编程核心技术》学习笔记及总结</title>
    <link href="http://yoursite.com/2017/06/04/Java-Thread/"/>
    <id>http://yoursite.com/2017/06/04/Java-Thread/</id>
    <published>2017-06-04T13:04:18.921Z</published>
    <updated>2017-06-13T10:42:19.996Z</updated>
    
    <content type="html"><![CDATA[<h2 id="第一章-——-Java-多线程技能"><a href="#第一章-——-Java-多线程技能" class="headerlink" title="第一章 —— Java 多线程技能"></a>第一章 —— Java 多线程技能</h2><p>线程技术点：</p>
<ul>
<li>线程的启动</li>
<li>如何使线程暂停</li>
<li>如何使线程停止</li>
<li>线程的优先级</li>
<li>线程安全相关问题</li>
</ul>
<h3 id="进程和线程的概念及多线程的优点"><a href="#进程和线程的概念及多线程的优点" class="headerlink" title="进程和线程的概念及多线程的优点"></a>进程和线程的概念及多线程的优点</h3><p>进程：比如我们电脑运行的 QQ.exe 程序，是操作系统管理的基本运行单元</p>
<p>线程：在进程中独立运行的子任务，比如 QQ.exe 进程中就有很多线程在运行，下载文件线程、发送消息线程、语音线程、视频线程等。</p>
<p>多线程优点：我们电脑可以同时操作不同的软件，边听着歌，敲着代码，查看 pdf 文档，浏览网页等，CPU 在这些任务之间不停的切换，切换非常快，所以我们就觉得他们是在同时运行的。<br><a id="more"></a></p>
<h3 id="使用多线程"><a href="#使用多线程" class="headerlink" title="使用多线程"></a>使用多线程</h3><h4 id="继承-Thread-类"><a href="#继承-Thread-类" class="headerlink" title="继承 Thread 类"></a>继承 Thread 类</h4><p>JDK 源码注释（Thread.java）如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function">One is to declare a class to be a <span class="title">subclass</span><span class="params">(子类)</span> of &lt;code&gt;Thread&lt;/code&gt;. This subclass should override the &lt;code&gt;run&lt;/code&gt; method of class &lt;code&gt;Thread&lt;/code&gt;. An instance of the subclass can then be allocated and started. For example, a thread that computes primes</span></div><div class="line">larger than a stated value could be written as follows:</div><div class="line"><span class="comment">//继承 Thread 类</span></div><div class="line">class PrimeThread extends Thread &#123;</div><div class="line">         <span class="keyword">long</span> minPrime;</div><div class="line">         PrimeThread(<span class="keyword">long</span> minPrime) &#123;</div><div class="line">          <span class="keyword">this</span>.minPrime = minPrime;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">             <span class="comment">// compute primes larger than minPrime</span></div><div class="line">             重写 Thread 类的 run 方法</div><div class="line">          &#125;</div><div class="line">     &#125;</div><div class="line"></div><div class="line">The following code would then create a thread and start it running:</div><div class="line"><span class="comment">//开启线程</span></div><div class="line">    PrimeThread p = <span class="keyword">new</span> PrimeThread(<span class="number">143</span>);</div><div class="line">    p.start();</div></pre></td></tr></table></figure>
<h4 id="实现-Runnable-接口"><a href="#实现-Runnable-接口" class="headerlink" title="实现 Runnable 接口"></a>实现 Runnable 接口</h4><p>JDK 源码注释（Thread.java）如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">The other way to create a thread is to declare a class that implements the &lt;code&gt;Runnable&lt;/code&gt; interface. That class then implements the &lt;code&gt;run&lt;/code&gt; method. An instance of the class can then be allocated, passed as an argument when creating</div><div class="line">&lt;code&gt;Thread&lt;/code&gt;, and started. The same example in this other style looks like the following:</div><div class="line">//实现 Runnable 接口</div><div class="line">    class PrimeRun implements Runnable &#123;</div><div class="line">        long minPrime;</div><div class="line">        PrimeRun(long minPrime) &#123;</div><div class="line">            this.minPrime = minPrime;</div><div class="line">         &#125;</div><div class="line"></div><div class="line">         public void run() &#123;</div><div class="line">            // compute primes larger than minPrime</div><div class="line">            //重写 run 方法</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">The following code would then create a thread and start it running:</div><div class="line">//开启线程</div><div class="line">     PrimeRun p = new PrimeRun(143);</div><div class="line">     new Thread(p).start();</div></pre></td></tr></table></figure>
<h3 id="currentThread-方法"><a href="#currentThread-方法" class="headerlink" title="currentThread() 方法"></a>currentThread() 方法</h3><p>该方法返回代码段正在被哪个线程调用的信息。</p>
<h3 id="isAlive-方法"><a href="#isAlive-方法" class="headerlink" title="isAlive() 方法"></a>isAlive() 方法</h3><p>判断当前线程是否处于活动状态（已经启动但未终止）</p>
<h3 id="sleep-方法"><a href="#sleep-方法" class="headerlink" title="sleep() 方法"></a>sleep() 方法</h3><p>在指定的毫秒数内让当前“正在执行的线程（this.currentThread() 返回的线程）”休眠（暂停执行）。</p>
<h3 id="getId-方法"><a href="#getId-方法" class="headerlink" title="getId() 方法"></a>getId() 方法</h3><p>获取线程的唯一标识</p>
<h3 id="停止线程"><a href="#停止线程" class="headerlink" title="停止线程"></a>停止线程</h3><p>可以使用 <del>Thread.stop()</del> 方法，但最好不要用，因为这个方法是不安全的，已经弃用作废了。</p>
<p>大多数停止一个线程是使用 Thread.interrupt() 方法</p>
<h4 id="判断线程是否是停止状态"><a href="#判断线程是否是停止状态" class="headerlink" title="判断线程是否是停止状态"></a>判断线程是否是停止状态</h4><ul>
<li><p>interrupted()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//测试当前线程是否已经中断了，这个线程的中断状态会被这个方法清除。</span></div><div class="line"><span class="comment">//换句话说，如果连续两次调用了这个方法，第二次调用的时候将会返回 false ，</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">interrupted</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> currentThread().isInterrupted(<span class="keyword">true</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>isInterrupted()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">//测试线程是否已经中断了，线程的状态不会受这个方法的影响</span></div><div class="line">   <span class="comment">//线程中断被忽略，因为线程处于中断下不处于活动状态的线程由此返回false的方法反映出来</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isInterrupted</span><span class="params">()</span> </span>&#123;</div><div class="line">           <span class="keyword">return</span> isInterrupted(<span class="keyword">false</span>);</div><div class="line">   &#125;</div><div class="line">   <span class="comment">/**</span></div><div class="line">* Tests if some Thread has been interrupted.  The interrupted state</div><div class="line">* is reset or not based on the value of ClearInterrupted that is</div><div class="line">* passed.</div><div class="line">*/</div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">boolean</span> <span class="title">isInterrupted</span><span class="params">(<span class="keyword">boolean</span> ClearInterrupted)</span></span>;</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="在沉睡中停止"><a href="#在沉睡中停止" class="headerlink" title="在沉睡中停止"></a>在沉睡中停止</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread2</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            System.out.println(<span class="string">"run start"</span>);</div><div class="line">            Thread.sleep(<span class="number">20000</span>);</div><div class="line">            System.out.println(<span class="string">"run end"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            System.out.println(<span class="string">"run catch "</span>+<span class="keyword">this</span>.isInterrupted());</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            MyThread2 t2 = <span class="keyword">new</span> MyThread2();</div><div class="line">            t2.start();</div><div class="line">            Thread.sleep(<span class="number">200</span>);</div><div class="line">            t2.interrupt();</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            System.out.println(<span class="string">"main catch"</span>);</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        System.out.println(<span class="string">"main end"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">run start</div><div class="line">main end</div><div class="line">run <span class="keyword">catch</span> <span class="keyword">false</span></div><div class="line">java.lang.InterruptedException: sleep interrupted</div><div class="line">	at java.lang.Thread.sleep(Native Method)</div><div class="line">	at com.zhisheng.thread.thread1.MyThread2.run(MyThread2.java:<span class="number">12</span>)</div></pre></td></tr></table></figure>
<p>从运行结果来看，如果在 sleep 状态下停止某一线程，会进入 catch 语句，并清除停止状态值，使之变成 false。</p>
<h4 id="在停止中沉睡"><a href="#在停止中沉睡" class="headerlink" title="在停止中沉睡"></a>在停止中沉睡</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread3</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            System.out.println(<span class="string">"run start"</span>);</div><div class="line">            Thread.sleep(<span class="number">20000</span>);</div><div class="line">            System.out.println(<span class="string">"run end"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            System.out.println(<span class="string">"run catch "</span>+<span class="keyword">this</span>.isInterrupted());</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">            MyThread3 t3 = <span class="keyword">new</span> MyThread3();</div><div class="line">            t3.start();</div><div class="line">            t3.interrupt();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">run start</div><div class="line">run <span class="keyword">catch</span> <span class="keyword">false</span></div><div class="line">java.lang.InterruptedException: sleep interrupted</div><div class="line">	at java.lang.Thread.sleep(Native Method)</div><div class="line">	at com.zhisheng.thread.thread1.MyThread3.run(MyThread3.java:<span class="number">12</span>)</div></pre></td></tr></table></figure>
<h4 id="能停止的线程-——-暴力停止"><a href="#能停止的线程-——-暴力停止" class="headerlink" title="能停止的线程 —— 暴力停止"></a>能停止的线程 —— 暴力停止</h4><p>使用 stop() 方法停止线程</p>
<h3 id="暂停线程"><a href="#暂停线程" class="headerlink" title="暂停线程"></a>暂停线程</h3><p>可使用 suspend 方法暂停线程，使用 resume() 方法恢复线程的执行。</p>
<h4 id="suspend-和-resume-方法的使用"><a href="#suspend-和-resume-方法的使用" class="headerlink" title="suspend 和 resume 方法的使用"></a>suspend 和 resume 方法的使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread4</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> i;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getI</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setI</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.i = i;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            i++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        MyThread4 t4 = <span class="keyword">new</span> MyThread4();</div><div class="line">        t4.start();</div><div class="line">        System.out.println(<span class="string">"A----- "</span> + System.currentTimeMillis() + <span class="string">" ---- "</span> + t4.getI());</div><div class="line">        Thread.sleep(<span class="number">2000</span>);</div><div class="line">        System.out.println(<span class="string">"A----- "</span> + System.currentTimeMillis() + <span class="string">" ---- "</span> + t4.getI());</div><div class="line">        t4.suspend();</div><div class="line">        Thread.sleep(<span class="number">2000</span>);</div><div class="line">        t4.resume();</div><div class="line">        System.out.println(<span class="string">"B----- "</span> + System.currentTimeMillis() + <span class="string">" ---- "</span> + t4.getI());</div><div class="line">        Thread.sleep(<span class="number">2000</span>);</div><div class="line">        System.out.println(<span class="string">"B----- "</span> + System.currentTimeMillis() + <span class="string">" ---- "</span> + t4.getI());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从运行结果来看，线程的确能够暂停和恢复。</p>
<p>但是 suspend 和 resume 方法的缺点就是：<strong>不同步</strong>，因为线程的暂停导致数据的不同步。</p>
<h3 id="yield-方法"><a href="#yield-方法" class="headerlink" title="yield 方法"></a>yield 方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * A hint to the scheduler that the current thread is willing to yield</div><div class="line">     * its current use of a processor. The scheduler is free to ignore this</div><div class="line">     * hint.</div><div class="line">     *</div><div class="line">     * &lt;p&gt; Yield is a heuristic attempt to improve relative progression</div><div class="line">     * between threads that would otherwise over-utilise a CPU. Its use</div><div class="line">     * should be combined with detailed profiling and benchmarking to</div><div class="line">     * ensure that it actually has the desired effect.</div><div class="line">     *</div><div class="line">     * &lt;p&gt; It is rarely appropriate to use this method. It may be useful</div><div class="line">     * for debugging or testing purposes, where it may help to reproduce</div><div class="line">     * bugs due to race conditions. It may also be useful when designing</div><div class="line">     * concurrency control constructs such as the ones in the</div><div class="line">     * &#123;<span class="doctag">@link</span> java.util.concurrent.locks&#125; package.</div><div class="line">     */</div><div class="line">    <span class="comment">//暂停当前正在执行的线程对象，并执行其他线程。暂停的时间不确定。</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">yield</span><span class="params">()</span></span>;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread5</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">double</span> start = System.currentTimeMillis();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">200000</span>; i++) &#123;</div><div class="line">            <span class="comment">//yield();//暂停的时间不确定</span></div><div class="line">            i++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">double</span> end = System.currentTimeMillis();</div><div class="line">        System.out.println(<span class="string">"time is "</span>+(end - start));</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        MyThread5  t5 = <span class="keyword">new</span> MyThread5();</div><div class="line">        t5.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="线程的优先级"><a href="#线程的优先级" class="headerlink" title="线程的优先级"></a>线程的优先级</h3><p>设置优先级的方法：setPriority() 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setPriority</span><span class="params">(<span class="keyword">int</span> newPriority)</span> </span>&#123;</div><div class="line">        ThreadGroup g;</div><div class="line">        checkAccess();</div><div class="line">        <span class="keyword">if</span> (newPriority &gt; MAX_PRIORITY || newPriority &lt; MIN_PRIORITY) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span>((g = getThreadGroup()) != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">if</span> (newPriority &gt; g.getMaxPriority()) &#123;</div><div class="line">                newPriority = g.getMaxPriority();</div><div class="line">            &#125;</div><div class="line">            setPriority0(priority = newPriority);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>不一定优先级高的线程就先执行。</p>
<h3 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h3><p>当进程中不存在非守护线程了，则守护线程自动销毁。垃圾回收线程就是典型的守护线程，当进程中没有非守护线程了，则垃圾回收线程也就没有存在的必要了，自动销毁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * Marks this thread as either a &#123;<span class="doctag">@linkplain</span> #isDaemon daemon&#125; thread</div><div class="line">    * or a user thread. The Java Virtual Machine exits when the only</div><div class="line">    * threads running are all daemon threads.</div><div class="line">    *</div><div class="line">    * &lt;p&gt; This method must be invoked before the thread is started.</div><div class="line">    *</div><div class="line">    * <span class="doctag">@param</span>  on</div><div class="line">    *         if &#123;<span class="doctag">@code</span> true&#125;, marks this thread as a daemon thread</div><div class="line">    * <span class="doctag">@throws</span>  IllegalThreadStateException</div><div class="line">    *          if this thread is &#123;<span class="doctag">@linkplain</span> #isAlive alive&#125;</div><div class="line">    * <span class="doctag">@throws</span>  SecurityException</div><div class="line">    *          if &#123;<span class="doctag">@link</span> #checkAccess&#125; determines that the current</div><div class="line">    *          thread cannot modify this thread</div><div class="line">    */</div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">setDaemon</span><span class="params">(<span class="keyword">boolean</span> on)</span> </span>&#123;</div><div class="line">       checkAccess();</div><div class="line">       <span class="keyword">if</span> (isAlive()) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</div><div class="line">       &#125;</div><div class="line">       daemon = on;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<h2 id="第二章-——-对象及变量的并发访问"><a href="#第二章-——-对象及变量的并发访问" class="headerlink" title="第二章 —— 对象及变量的并发访问"></a>第二章 —— 对象及变量的并发访问</h2><p>技术点：</p>
<ul>
<li>synchronized 对象监视器为 Object 时的使用</li>
<li>synchronized 对象监视器为 Class 时的使用</li>
<li>非线程安全是如何出现的</li>
<li>关键字 volatile 的主要作用</li>
<li>关键字 volatile 与 synchronized 的区别及使用情况</li>
</ul>
<h3 id="synchronized-同步方法"><a href="#synchronized-同步方法" class="headerlink" title="synchronized 同步方法"></a>synchronized 同步方法</h3><h4 id="方法内的变量为线程安全"><a href="#方法内的变量为线程安全" class="headerlink" title="方法内的变量为线程安全"></a>方法内的变量为线程安全</h4><p>“非线程安全”问题存在于“实例变量”中，如果是方法内部的私有变量，则不存在“非线程安全”问题，所得结果也就是“线程安全”了。</p>
<h4 id="实例变量非线程安全"><a href="#实例变量非线程安全" class="headerlink" title="实例变量非线程安全"></a>实例变量非线程安全</h4><p>如果多线程共同访问一个对象中的实例变量，则有可能出现“非线程安全”问题。</p>
<p>在两个线程访问同一个对象中的同步方法时一定是线程安全的。</p>
<h4 id="脏读"><a href="#脏读" class="headerlink" title="脏读"></a>脏读</h4><p>发生脏读的情况是在读取实例变量时，此值已经被其他线程更改过了。</p>
<p>如下例子就可以说明，如果不加 synchronized 关键字在 setValue 和 getValue 方法上，就会出现数据脏读。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">VarName</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> String userName = <span class="string">"A"</span>;</div><div class="line">    <span class="keyword">private</span> String password = <span class="string">"AA"</span>;</div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">(String userName, String password)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="keyword">this</span>.userName = userName;</div><div class="line">            Thread.sleep(<span class="number">500</span>);</div><div class="line">            <span class="keyword">this</span>.password = password;</div><div class="line">            System.out.println(<span class="string">"setValue method Thread name is :  "</span> + Thread.currentThread().getName() + <span class="string">" userName = "</span> + userName + <span class="string">" password = "</span> + password);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//synchronized</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"getValue method Thread name is :  "</span> + Thread.currentThread().getName() + <span class="string">" userName = "</span> + userName + <span class="string">" password = "</span> + password);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> VarName varName;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Thread1</span><span class="params">(VarName varName)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.varName = varName;</div><div class="line">    &#125;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        varName.setValue(<span class="string">"B"</span>, <span class="string">"BB"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        VarName v = <span class="keyword">new</span> VarName();</div><div class="line">        Thread1 thread1 = <span class="keyword">new</span> Thread1(v);</div><div class="line">        thread1.start();</div><div class="line">        Thread.sleep(<span class="number">200</span>);<span class="comment">//打印结果受睡眠时间的影响</span></div><div class="line">        v.getValue();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="synchronized-锁重入"><a href="#synchronized-锁重入" class="headerlink" title="synchronized 锁重入"></a>synchronized 锁重入</h4><p>关键字 synchronized 拥有锁重入的功能，也就是在使用 synchronized 时，当一个线程得到一个对象锁后，再次请求此对象锁是可以再次得到该对象的锁的。这也证明了在一个 synchronized 方法/块的内部调用本类的其他 synchronized 方法/块时，是永远可以得到锁的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Service</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service1</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"service 1"</span>);</div><div class="line">        service2();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service2</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"service 2"</span>);</div><div class="line">        service3();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service3</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"service 3"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        Service s = <span class="keyword">new</span> Service();</div><div class="line">        s.service1();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test2</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Thread2 t2 = <span class="keyword">new</span> Thread2();</div><div class="line">        t2.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">service 1</div><div class="line">service 2</div><div class="line">service 3</div></pre></td></tr></table></figure>
<h4 id="同步不具有继承性"><a href="#同步不具有继承性" class="headerlink" title="同步不具有继承性"></a>同步不具有继承性</h4><p>同步不可以继承。</p>
<h3 id="synchronized-同步语句块"><a href="#synchronized-同步语句块" class="headerlink" title="synchronized 同步语句块"></a>synchronized 同步语句块</h3><h4 id="synchronized-代码块间的同步性"><a href="#synchronized-代码块间的同步性" class="headerlink" title="synchronized 代码块间的同步性"></a>synchronized 代码块间的同步性</h4><p>当一个线程访问 object 的一个 synchronized(this) 同步代码块时，其他线程对同一个 object 中所有其他 synchronized(this) 同步代码块的访问将被阻塞，这说明 synchronized 使用的 “对象监视器” 是一个。</p>
<h4 id="将任意对象作为对象监视器"><a href="#将任意对象作为对象监视器" class="headerlink" title="将任意对象作为对象监视器"></a>将任意对象作为对象监视器</h4><p>多个线程调用同一个对象中的不同名称的 synchronized 同步方法或者 synchronized(this) 同步代码块时，调用的效果就是按顺序执行，也就是同步的，阻塞的。</p>
<h4 id="静态同步-synchronized-方法与-synchronized-class-代码块"><a href="#静态同步-synchronized-方法与-synchronized-class-代码块" class="headerlink" title="静态同步 synchronized 方法与  synchronized(class) 代码块"></a>静态同步 synchronized 方法与  synchronized(class) 代码块</h4><p>关键字 synchronized 还可以应用在 static 静态方法上，如果这样写就是对当前的 *.java 文件对应的 Class 类进行加锁。而 synchronized 关键字加到非 static 静态方法上就是给对象加锁。</p>
<h4 id="多线程的死锁"><a href="#多线程的死锁" class="headerlink" title="多线程的死锁"></a>多线程的死锁</h4><h3 id="volatile-关键字"><a href="#volatile-关键字" class="headerlink" title="volatile 关键字"></a>volatile 关键字</h3><p>作用：使变量在多个线程间可见。</p>
<p>通过使用 volatile 关键字，强制的从公共内存中读取变量的值。使用 volatile 关键字增加了实例变量在多个线程之间的可见性，但 volatile 关键字最致命的缺点就是不支持原子性。</p>
<p>关键字 synchronized 和 volatile 比较：</p>
<ul>
<li><p>关键字 volatile 是线程同步的轻量实现，所以 volatile 性能肯定要比 synchronized 要好，并且 volatile 只能修饰于变量，而 synchronized 可以修饰方法，以及代码块。</p>
</li>
<li><p>多线程访问 volatile 不会发生阻塞，而 synchronized 会出现阻塞。</p>
</li>
<li><p>volatile 能保证数据的可见性，但不能保证原子性；而 synchronized 可以保证原子性，也可以间接保证可见性，因为它会将私有内存和公有内存中的数据做同步。</p>
</li>
<li><p>关键字 volatile 解决的是变量在多个线程之间的可见性；而 synchronized 关键字解决的是多个线程之间访问资源的同步性。</p>
<p>​</p>
</li>
</ul>
<h2 id="第三章-——-线程间通信"><a href="#第三章-——-线程间通信" class="headerlink" title="第三章 —— 线程间通信"></a>第三章 —— 线程间通信</h2><p>技术点：</p>
<ul>
<li>使用 wait/notify 实现线程间的通信</li>
<li>生产者/消费者模式的实现</li>
<li>方法 join 的使用</li>
<li>ThreadLocal 类的使用</li>
</ul>
<h3 id="等待-通知机制"><a href="#等待-通知机制" class="headerlink" title="等待/通知机制"></a>等待/通知机制</h3><p>wait 使线程停止运行，notify 使停止的线程继续运行。</p>
<p>关键字 synchronized 可以将任何一个 Object 对象作为同步对象看待，而 Java 为每个 Object 都实现了 wait() 和 notify() 方法，他们必须用在被 synchronized 同步的 Object 的临界区内。通过调用 wait 方法可以使处于临界区内的线程进入等待状态，同时释放被同步对象的锁。而 notify 操作可以唤醒一个因调用了 wait 方法而处于阻塞状态的线程，使其进入就绪状态。被重新唤醒的线程会试图重新获得临界区的控制权，继续执行临界区内 wait 之后的代码。</p>
<p>wait 方法可以使调用该方法的线程释放共享资源的锁，从运行状态退出，进入等待状态，直到再次被唤醒。</p>
<p>notify() 方法可以随机唤醒等待对列中等待同一共享资源的一个线程，并使该线程退出等待状态，进入可运行状态。</p>
<p>notifyAll() 方法可以随机唤醒等待对列中等待同一共享资源的所有线程，并使这些线程退出等待状态，进入可运行状态。</p>
<h4 id="线程状态示意图："><a href="#线程状态示意图：" class="headerlink" title="线程状态示意图："></a>线程状态示意图：</h4><p><img src="http://ohfk1r827.bkt.clouddn.com/thread-state.jpg" alt=""></p>
<ul>
<li><p>新创建一个线程对象后，在调用它的 start() 方法，系统会为此线程分配 CPU 资源，使其处于 Runnable（可运行）状态，如果线程抢占到 CPU 资源，此线程就会处于 Running （运行）状态</p>
</li>
<li><p>Runnable 和 Running 状态之间可以相互切换，因为线程有可能运行一段时间后，有其他优先级高的线程抢占了 CPU 资源，此时线程就从 Running 状态变成了 Runnable 状态。</p>
<p>线程进入 Runnable 状态有如下几种情况：</p>
<ul>
<li>调用 sleep() 方法后经过的时间超过了指定的休眠时间</li>
<li>线程调用的阻塞 IO 已经返回，阻塞方法执行完毕</li>
<li>线程成功的获得了试图同步的监视器</li>
<li>线程正在等待某个通知，其他线程发出了通知</li>
<li>处于挂状态的线程调用了 resume 恢复方法</li>
</ul>
</li>
<li><p>Blocked 是阻塞的意思，例如线程遇到一个 IO 操作，此时 CPU 处于空闲状态，可能会转而把 CPU 时间片分配给其他线程，这时也可以称为 “暂停”状态。Blocked 状态结束之后，进入 Runnable 状态，等待系统重新分配资源。</p>
<p>出现阻塞状态的有如下几种情况：</p>
<ul>
<li>线程调用 sleep 方法，主动放弃占用的处理器资源</li>
<li>线程调用了阻塞式 IO 方法，在该方法返回之前，该线程被阻塞</li>
<li>线程试图获得一个同步监视器，但该同步监视器正在被其他线程所持有</li>
<li>线程等待某个通知</li>
<li>程序调用了 suspend 方法将该线程挂起</li>
</ul>
</li>
<li><p>run 方法运行结束后进入销毁阶段，整个线程执行完毕。</p>
</li>
</ul>
<h4 id="生产者-消费者模式实现"><a href="#生产者-消费者模式实现" class="headerlink" title="生产者/消费者模式实现"></a>生产者/消费者模式实现</h4><p>一个生产者，一个消费者</p>
<p>存储值对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread5;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> * 存储值对象</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ValueObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String value = <span class="string">""</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>生产者：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread5;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> * 生产者</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> String lock;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Product</span><span class="params">(String lock)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.lock = lock;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (lock) &#123;</div><div class="line">            <span class="keyword">if</span> (!ValueObject.value.equals(<span class="string">""</span>)) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    lock.wait();</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            String value = System.currentTimeMillis() + <span class="string">"_"</span> + System.nanoTime();</div><div class="line">            System.out.println(<span class="string">"生产者 set 的值是："</span> + value);</div><div class="line">            ValueObject.value = value;</div><div class="line">            lock.notify();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>消费者：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread5;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> * 消费者</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Resume</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> String lock;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Resume</span><span class="params">(String lock)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.lock = lock;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (lock) &#123;</div><div class="line">            <span class="keyword">if</span> (ValueObject.value.equals(<span class="string">""</span>)) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    lock.wait();</div><div class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">            System.out.println(<span class="string">"消费者 get 的值："</span> + ValueObject.value);</div><div class="line">            ValueObject.value = <span class="string">""</span>;</div><div class="line">            lock.notify();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>生产者线程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread5;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> * 生产者线程</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> Product p;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ProductThread</span><span class="params">(Product p)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.p = p;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            p.setValue();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>消费者线程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread5;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> * 消费者线程</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResumeThread</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> Resume r;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResumeThread</span><span class="params">(Resume r)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.r = r;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</div><div class="line">            r.getValue();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>主函数：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread5;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> * 一个生产者一个消费者测试</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        String str = <span class="keyword">new</span> String(<span class="string">""</span>);</div><div class="line">        Product p = <span class="keyword">new</span> Product(str);</div><div class="line">        Resume r = <span class="keyword">new</span> Resume(str);;</div><div class="line">        ProductThread pt = <span class="keyword">new</span> ProductThread(p);</div><div class="line">        ResumeThread rt = <span class="keyword">new</span> ResumeThread(r);</div><div class="line">        pt.start();</div><div class="line">        rt.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>题目：创建20个线程，其中10个线程是将数据备份到数据库A，另外10个线程将数据备份到数据库B中去，并且备份数据库A和备份数据库B是交叉进行的。</p>
<p>工具类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread6;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> * 创建20个线程，其中10个线程是将数据备份到数据库A，另外10个线程将数据备份到数据库B中去，并且</div><div class="line"> * 备份数据库A和备份数据库B是交叉进行的</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DBTools</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">volatile</span> <span class="keyword">private</span> <span class="keyword">boolean</span> prevIsA = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">//确保A备份先进行</span></div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backA</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (prevIsA == <span class="keyword">true</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                wait();</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">            System.out.println(<span class="string">"AAAAA"</span>);</div><div class="line">        &#125;</div><div class="line">        prevIsA = <span class="keyword">true</span>;</div><div class="line">        notifyAll();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">synchronized</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title">backB</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">while</span> (prevIsA == <span class="keyword">false</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                wait();</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">            System.out.println(<span class="string">"BBBBB"</span>);</div><div class="line">        &#125;</div><div class="line">        prevIsA = <span class="keyword">false</span>;</div><div class="line">        notifyAll();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>备份A先线程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread6;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> DBTools dbTools;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(DBTools dbTools)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dbTools = dbTools;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        dbTools.backA();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>备份B线程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread6;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadB</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> DBTools dbTools;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadB</span><span class="params">(DBTools dbTools)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.dbTools = dbTools;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        dbTools.backB();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread6;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/3.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        DBTools dbTools = <span class="keyword">new</span> DBTools();</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</div><div class="line">            ThreadB tb = <span class="keyword">new</span> ThreadB(dbTools);</div><div class="line">            tb.start();</div><div class="line">            ThreadA ta = <span class="keyword">new</span> ThreadA(dbTools);</div><div class="line">            ta.start();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="Join-方法的使用"><a href="#Join-方法的使用" class="headerlink" title="Join 方法的使用"></a>Join 方法的使用</h3><p>作用：等待线程对象销毁</p>
<p>join 方法具有使线程排队运行的作用，有些类似同步的运行效果。join 与 synchronized 的区别是：join 在内部使用 wait() 方法进行等待，而 synchronized 关键字使用的是 “对象监视器” 原理做为同步。</p>
<p>在 join 过程中，如果当前线程对象被中断，则当前线程出现异常。</p>
<p>方法 join(long) 中的参数是设定等待的时间。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">     * 等待该线程终止的时间最长为 millis 毫秒。超时为 0 意味着要一直等下去。</div><div class="line">     * Waits at most &#123;<span class="doctag">@code</span> millis&#125; milliseconds for this thread to</div><div class="line">     * die. A timeout of &#123;<span class="doctag">@code</span> 0&#125; means to wait forever.</div><div class="line">     *</div><div class="line">     * &lt;p&gt; This implementation uses a loop of &#123;<span class="doctag">@code</span> this.wait&#125; calls</div><div class="line">     * conditioned on &#123;<span class="doctag">@code</span> this.isAlive&#125;. As a thread terminates the</div><div class="line">     * &#123;<span class="doctag">@code</span> this.notifyAll&#125; method is invoked. It is recommended that</div><div class="line">     * applications not use &#123;<span class="doctag">@code</span> wait&#125;, &#123;<span class="doctag">@code</span> notify&#125;, or</div><div class="line">     * &#123;<span class="doctag">@code</span> notifyAll&#125; on &#123;<span class="doctag">@code</span> Thread&#125; instances.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span>  millis</div><div class="line">     *         the time to wait in milliseconds</div><div class="line">     *</div><div class="line">     * <span class="doctag">@throws</span>  IllegalArgumentException</div><div class="line">     *          if the value of &#123;<span class="doctag">@code</span> millis&#125; is negative</div><div class="line">     *</div><div class="line">     * <span class="doctag">@throws</span>  InterruptedException</div><div class="line">     *          if any thread has interrupted the current thread. The</div><div class="line">     *          &lt;i&gt;interrupted status&lt;/i&gt; of the current thread is</div><div class="line">     *          cleared when this exception is thrown.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">join</span><span class="params">(<span class="keyword">long</span> millis)</span></span></div><div class="line">    <span class="keyword">throws</span> InterruptedException &#123;</div><div class="line">        <span class="keyword">long</span> base = System.currentTimeMillis();</div><div class="line">        <span class="keyword">long</span> now = <span class="number">0</span>;</div><div class="line">        <span class="keyword">if</span> (millis &lt; <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"timeout value is negative"</span>);</div><div class="line">        <span class="keyword">if</span> (millis == <span class="number">0</span>) &#123;</div><div class="line">            <span class="keyword">while</span> (isAlive()) &#123;</div><div class="line">                wait(<span class="number">0</span>);</div><div class="line">            &#125;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">while</span> (isAlive()) &#123;</div><div class="line">                <span class="keyword">long</span> delay = millis - now;</div><div class="line">                <span class="keyword">if</span> (delay &lt;= <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">break</span>;</div><div class="line">                &#125;</div><div class="line">                wait(delay);</div><div class="line">                now = System.currentTimeMillis() - base;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="类-ThreadLocal-的使用"><a href="#类-ThreadLocal-的使用" class="headerlink" title="类  ThreadLocal  的使用"></a>类  ThreadLocal  的使用</h3><p>该类提供了线程局部 (thread-local) 变量。这些变量不同于它们的普通对应物，因为访问某个变量（通过其 get 或<br>set 方法）的每个线程都有自己的局部变量，它独立于变量的初始化副本。ThreadLocal 实例通常是类中的<br>private static 字段，它们希望将状态与某一个线程（例如，用户 ID 或事务 ID）相关联。</p>
<h4 id="get-方法"><a href="#get-方法" class="headerlink" title="get() 方法"></a>get() 方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">        Thread t = Thread.currentThread();</div><div class="line">        ThreadLocalMap map = getMap(t);</div><div class="line">        <span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</div><div class="line">            ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</div><div class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">                T result = (T)e.value;</div><div class="line">                <span class="keyword">return</span> result;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> setInitialValue();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>返回此线程局部变量的当前线程副本中的值。如果变量没有用于当前线程的值，则先将其初始化为调用 initialValue() 方法返回的值。</p>
<h3 id="InheritableThreadLocal-类的使用"><a href="#InheritableThreadLocal-类的使用" class="headerlink" title="InheritableThreadLocal 类的使用"></a>InheritableThreadLocal 类的使用</h3><p>该类扩展了 ThreadLocal，为子线程提供从父线程那里继承的值：在创建子线程时，子线程会接收所有可继承的线程局部变量的初始值，以获得父线程所具有的值。通常，子线程的值与父线程的值是一致的；但是，通过重写这个类中的 childValue 方法，子线程的值可以作为父线程值的一个任意函数。</p>
<p>当必须将变量（如用户 ID 和 事务 ID）中维护的每线程属性（per-thread-attribute）自动传送给创建的所有子线程时，应尽可能地采用可继承的线程局部变量，而不是采用普通的线程局部变量。</p>
<h2 id="第四章-——-Lock-的使用"><a href="#第四章-——-Lock-的使用" class="headerlink" title="第四章 ——  Lock 的使用"></a>第四章 ——  Lock 的使用</h2><h3 id="使用-ReentrantLock-类"><a href="#使用-ReentrantLock-类" class="headerlink" title="使用 ReentrantLock 类"></a>使用 ReentrantLock 类</h3><p>一个可重入的互斥锁 Lock，它具有与使用 <code>synchronized</code> 方法和语句所访问的隐式监视器锁相同的一些基本行为和语义，但功能更强大。</p>
<p><code>ReentrantLock</code> 将由最近成功获得锁，并且还没有释放该锁的线程所<em>拥有</em>。当锁没有被另一个线程所拥有时，调用 <code>lock</code> 的线程将成功获取该锁并返回。如果当前线程已经拥有该锁，此方法将立即返回。可以使用 <code>isHeldByCurrentThread()</code>和 <code>getHoldCount()</code>方法来检查此情况是否发生。</p>
<p>此类的构造方法接受一个可选的<em>公平</em> 参数。当设置为 <code>true</code> 时，在多个线程的争用下，这些锁倾向于将访问权授予等待时间最长的线程。否则此锁将无法保证任何特定访问顺序。与采用默认设置（使用不公平锁）相比，使用公平锁的程序在许多线程访问时表现为很低的总体吞吐量（即速度很慢，常常极其慢），但是在获得锁和保证锁分配的均衡性时差异较小。不过要注意的是，公平锁不能保证线程调度的公平性。因此，使用公平锁的众多线程中的一员可能获得多倍的成功机会，这种情况发生在其他活动线程没有被处理并且目前并未持有锁时。还要注意的是，未定时的 <code>tryLock</code>方法并没有使用公平设置。因为即使其他线程正在等待，只要该锁是可用的，此方法就可以获得成功。</p>
<p>建议<em>总是</em> 立即实践，使用 <code>lock</code> 块来调用 <code>try</code>，在之前/之后的构造中，最典型的代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">X</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line">   <span class="comment">// ...</span></div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">m</span><span class="params">()</span> </span>&#123;</div><div class="line">     lock.lock();  <span class="comment">// block until condition holds</span></div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">       <span class="comment">// ... method body</span></div><div class="line">     &#125; <span class="keyword">finally</span> &#123;</div><div class="line">       lock.unlock()</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="Condition"><a href="#Condition" class="headerlink" title="Condition"></a>Condition</h3><p>Condition 将 Object 监视器方法（wait、notify 和 notifyAll）分解成截然不同的对象，以便通过将这些对象与任意 Lock 实现组合使用，为每个对象提供多个等待 set（wait-set）。其中，Lock 替代了 synchronized 方法和语句的使用，Condition 替代了 Object 监视器方法的使用。</p>
<p>假定有一个绑定的缓冲区，它支持 put 和 take 方法。如果试图在空的缓冲区上执行 take 操作，则在某一个项变得可用之前，线程将一直阻塞；如果试图在满的缓冲区上执行 put 操作，则在有空间变得可用之前，线程将一直阻塞。我们喜欢在单独的等待 set 中保存 put 线程和 take 线程，这样就可以在缓冲区中的项或空间变得可用时利用最佳规划，一次只通知一个线程。可以使用两个 Condition 实例来做到这一点。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BoundedBuffer</span> </span>&#123;</div><div class="line">   <span class="keyword">final</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line">   <span class="keyword">final</span> Condition notFull  = lock.newCondition();</div><div class="line">   <span class="keyword">final</span> Condition notEmpty = lock.newCondition();</div><div class="line"></div><div class="line">   <span class="keyword">final</span> Object[] items = <span class="keyword">new</span> Object[<span class="number">100</span>];</div><div class="line">   <span class="keyword">int</span> putptr, takeptr, count;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object x)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">     lock.lock();</div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">       <span class="keyword">while</span> (count == items.length)</div><div class="line">         notFull.await();</div><div class="line">       items[putptr] = x;</div><div class="line">       <span class="keyword">if</span> (++putptr == items.length) putptr = <span class="number">0</span>;</div><div class="line">       ++count;</div><div class="line">       notEmpty.signal();</div><div class="line">     &#125; <span class="keyword">finally</span> &#123;</div><div class="line">       lock.unlock();</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> Object <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">     lock.lock();</div><div class="line">     <span class="keyword">try</span> &#123;</div><div class="line">       <span class="keyword">while</span> (count == <span class="number">0</span>)</div><div class="line">         notEmpty.await();</div><div class="line">       Object x = items[takeptr];</div><div class="line">       <span class="keyword">if</span> (++takeptr == items.length) takeptr = <span class="number">0</span>;</div><div class="line">       --count;</div><div class="line">       notFull.signal();</div><div class="line">       <span class="keyword">return</span> x;</div><div class="line">     &#125; <span class="keyword">finally</span> &#123;</div><div class="line">       lock.unlock();</div><div class="line">     &#125;</div><div class="line">   &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="正确使用-Condition-实现等待-通知"><a href="#正确使用-Condition-实现等待-通知" class="headerlink" title="正确使用 Condition 实现等待/通知"></a>正确使用 Condition 实现等待/通知</h3><p>MyService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.Thread9;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line">    <span class="keyword">private</span> Condition condition = lock.newCondition();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">await</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.lock();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            System.out.println(<span class="string">"await A"</span>);</div><div class="line">            condition.await();<span class="comment">//使当前执行的线程处于等待状态 waiting</span></div><div class="line">            System.out.println(<span class="string">"await B"</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;<span class="keyword">finally</span> &#123;</div><div class="line">            lock.unlock();</div><div class="line">            System.out.println(<span class="string">"释放锁"</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">signal</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.lock();</div><div class="line">        System.out.println(<span class="string">"signal A"</span>);</div><div class="line">        condition.signal();</div><div class="line">        System.out.println(<span class="string">"signal B"</span>);</div><div class="line">        lock.unlock();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ThreadA.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.Thread9;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> MyService service;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(MyService service)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.service = service;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        service.await();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.Thread9;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        MyService service = <span class="keyword">new</span> MyService();</div><div class="line">        ThreadA ta = <span class="keyword">new</span> ThreadA(service);</div><div class="line">        ta.start();</div><div class="line">        Thread.sleep(<span class="number">5000</span>);</div><div class="line">        service.signal();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">await A</div><div class="line">signal A</div><div class="line">signal B</div><div class="line">await B</div><div class="line">释放锁</div></pre></td></tr></table></figure>
<p>Object 类中的 wait() 方法相当于 Condition 类中 await() 方法</p>
<p>Object 类中的 wait(long time) 方法相当于 Condition 类中 await(long time, TimeUnit unit) 方法</p>
<p>Object 类中的 notify() 方法相当于 Condition 类中 signal() 方法</p>
<p>Object 类中的 notifyAll() 方法相当于 Condition 类中 signalAll() 方法</p>
<p>题目：实现生产者与消费者  一对一交替打印</p>
<p>MyService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread10;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> * 实现生产者与消费者  一对一·交替打印</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> Lock lock = <span class="keyword">new</span> ReentrantLock();</div><div class="line">    <span class="keyword">private</span> Condition condition = lock.newCondition();</div><div class="line">    <span class="keyword">private</span>  <span class="keyword">boolean</span> flag = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.lock();</div><div class="line">        <span class="keyword">while</span> (flag == <span class="keyword">true</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                condition.await();</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.println(<span class="string">"SetValue  AAAAAA"</span>);</div><div class="line">        flag = <span class="keyword">true</span>;</div><div class="line">        condition.signal();</div><div class="line">        lock.unlock();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getValue</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.lock();</div><div class="line">        <span class="keyword">while</span> (flag == <span class="keyword">false</span>) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                condition.await();</div><div class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">                e.printStackTrace();</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        System.out.println(<span class="string">"GetValue BBBB"</span>);</div><div class="line">        flag = <span class="keyword">false</span>;</div><div class="line">        condition.signal();</div><div class="line">        lock.unlock();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ThreadA.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread10;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> MyService service;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(MyService service)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.service = service;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</div><div class="line">            service.setValue();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ThreadB.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread10;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadB</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> MyService service;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadB</span><span class="params">(MyService service)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.service = service;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Integer.MAX_VALUE; i++) &#123;</div><div class="line">            service.getValue();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread10;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        MyService service = <span class="keyword">new</span> MyService();</div><div class="line">        ThreadA ta = <span class="keyword">new</span> ThreadA(service);</div><div class="line">        ThreadB tb = <span class="keyword">new</span> ThreadB(service);</div><div class="line">        ta.start();</div><div class="line">        tb.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>getHoldCount() 查询当前线程保持此锁定的个数，也就是调用 lock() 的方法</p>
<p>getQueueLength() 返回正等待获取此锁定的线程估计数</p>
<p>getWaitQueueLength() 返回等待与此锁定相关的给定条件 Condition 的线程估计数</p>
<p>hasQueuedThread() 查询指定的线程是否正在等待获取此锁定</p>
<p>hasQueuedThreads() 查询是否有线程正在等待获取此锁定</p>
<p>hasWaiters() 查询是否有线程正在等待与此锁定有关的 condition 条件</p>
<p>isFair() 判断是否是公平锁（默认下 ReentrantLock类使用的是非公平锁）</p>
<p>isHeldByCurrentThread() 查询当前线程是否保持此锁定</p>
<p>isLocked() 查询此锁定是否由任意线程保持</p>
<p>lockInterruptibly() 如果当前线程未被中断，则获取锁定，如果已经被中断则出现异常</p>
<p>tryLock() 仅在调用时锁定未被另一个线程保持的情况下，才获取该锁定</p>
<p>tryLock(long time, TimeUtil util) 如果锁定在给定的等待时间内没有被另一个线程保持，且当前线程未被中断，则获取该锁定。</p>
<h3 id="使用-ReentrantReadWriteLock-类"><a href="#使用-ReentrantReadWriteLock-类" class="headerlink" title="使用 ReentrantReadWriteLock 类"></a>使用 ReentrantReadWriteLock 类</h3><p>读写互斥：</p>
<p>MyService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.Thread11;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyService</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> ReentrantReadWriteLock lock = <span class="keyword">new</span> ReentrantReadWriteLock();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.readLock().lock();</div><div class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" Read AAA  "</span> + System.currentTimeMillis());</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Thread.sleep(<span class="number">10000</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        lock.readLock().unlock();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> </span>&#123;</div><div class="line">        lock.writeLock().lock();</div><div class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">" write BBB "</span> + System.currentTimeMillis());</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Thread.sleep(<span class="number">10000</span>);</div><div class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">        lock.writeLock().unlock();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ThreadA.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.Thread11;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> MyService service;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadA</span><span class="params">(MyService service)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.service = service;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        service.read();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ThreadB.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.Thread11;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadB</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> MyService service;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ThreadB</span><span class="params">(MyService service)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.service = service;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        service.write();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.Thread11;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        MyService service = <span class="keyword">new</span> MyService();</div><div class="line">        ThreadA ta = <span class="keyword">new</span> ThreadA(service);</div><div class="line">        ta.setName(<span class="string">"A"</span>);</div><div class="line">        ta.start();</div><div class="line">        Thread.sleep(<span class="number">1000</span>);</div><div class="line">        ThreadB tb = <span class="keyword">new</span> ThreadB(service);</div><div class="line">        tb.setName(<span class="string">"B"</span>);</div><div class="line">        tb.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">A Read AAA  1496556770402</div><div class="line">B write BBB 1496556780402</div></pre></td></tr></table></figure>
<h2 id="第六章-——-单例模式与多线程"><a href="#第六章-——-单例模式与多线程" class="headerlink" title="第六章 —— 单例模式与多线程"></a>第六章 —— 单例模式与多线程</h2><p>推荐文章 <a href="http://blog.csdn.net/tzs_1041218129/article/details/51246419" target="_blank" rel="external">《深入浅出单实例Singleton设计模式》</a></p>
<h3 id="立即加载模式-“饿汉模式”"><a href="#立即加载模式-“饿汉模式”" class="headerlink" title="立即加载模式 / “饿汉模式”"></a>立即加载模式 / “饿汉模式”</h3><p>立即加载：使用类的时候已经将对象创建完毕，new 实例化</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyObject object = <span class="keyword">new</span> MyObject();</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyObject</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyObject <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> object;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="延迟加载-“-懒汉模式-”"><a href="#延迟加载-“-懒汉模式-”" class="headerlink" title="延迟加载 / “ 懒汉模式 ”"></a>延迟加载 / “ 懒汉模式 ”</h3><p>就是在调用 get 的时候实例才被创建。在 get() 方法中进行 new 实例化。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span>  <span class="keyword">static</span>  MyObject object;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyObject</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyObject <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (object != <span class="keyword">null</span>) &#123;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            object = <span class="keyword">new</span> MyObject();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> object;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>使用 DCL 双重检查锁，解决“懒汉模式”遇到的多线程问题</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span>  <span class="keyword">volatile</span> <span class="keyword">static</span>  MyObject object;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyObject</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//synchronized</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyObject <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (object != <span class="keyword">null</span>) &#123;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">synchronized</span> (MyObject.class) &#123;</div><div class="line">                <span class="keyword">if</span> (object == <span class="keyword">null</span>) &#123;</div><div class="line">                    object = <span class="keyword">new</span> MyObject();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> object;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用静态内部类实现单例模式"><a href="#使用静态内部类实现单例模式" class="headerlink" title="使用静态内部类实现单例模式"></a>使用静态内部类实现单例模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObjectHandler</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> MyObject object = <span class="keyword">new</span> MyObject();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyObject</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyObject <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> MyObjectHandler.object;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="序列化与反序列化的单例模式实现"><a href="#序列化与反序列化的单例模式实现" class="headerlink" title="序列化与反序列化的单例模式实现"></a>序列化与反序列化的单例模式实现</h3><p>MyObject.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread15;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.ObjectStreamException;</div><div class="line"><span class="keyword">import</span> java.io.Serializable;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID =  <span class="number">888L</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObjectHandler</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> MyObject object = <span class="keyword">new</span> MyObject();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyObject</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  MyObject <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> MyObjectHandler.object;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">protected</span> Object <span class="title">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException </span>&#123;</div><div class="line">        System.out.println(<span class="string">"调用了readResolve方法！"</span>);</div><div class="line">        <span class="keyword">return</span> MyObjectHandler.object;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>SaveAndRead.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread15;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SaveAndRead</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            MyObject object = MyObject.getInstance();</div><div class="line">            FileOutputStream fos = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">"fos.txt"</span>));</div><div class="line">            ObjectOutputStream oos = <span class="keyword">new</span> ObjectOutputStream(fos);</div><div class="line">            oos.writeObject(object);</div><div class="line">            oos.close();</div><div class="line">            fos.close();</div><div class="line">            System.out.println(object.hashCode());</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            FileInputStream fis = <span class="keyword">new</span> FileInputStream(<span class="keyword">new</span> File(<span class="string">"fos.txt"</span>));</div><div class="line">            ObjectInputStream ois = <span class="keyword">new</span> ObjectInputStream(fis);</div><div class="line">            MyObject o = (MyObject) ois.readObject();</div><div class="line">            ois.close();</div><div class="line">            fis.close();</div><div class="line">            System.out.println(o.hashCode());</div><div class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里主要要指出 MyObject.java 中 readResolve 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">protected</span> Object <span class="title">readResolve</span><span class="params">()</span> <span class="keyword">throws</span> ObjectStreamException </span>&#123;</div><div class="line">       System.out.println(<span class="string">"调用了readResolve方法！"</span>);</div><div class="line">       <span class="keyword">return</span> MyObjectHandler.object;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>方法 readResolve 允许 class 在反序列化返回对象前替换、解析在流中读出来的对象。实现 readResolve 方法，一个 class 可以直接控制反序化返回的类型和对象引用。</p>
<p>方法 readResolve 会在 ObjectInputStream 已经读取一个对象并在准备返回前调用。ObjectInputStream 会检查对象的 class 是否定义了 readResolve 方法。如果定义了，将由 readResolve 方法指定返回的对象。返回对象的类型一定要是兼容的，否则会抛出 ClassCastException 。</p>
<h3 id="使用-static-代码块实现单例模式"><a href="#使用-static-代码块实现单例模式" class="headerlink" title="使用 static 代码块实现单例模式"></a>使用 static 代码块实现单例模式</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread16;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> MyObject instance = <span class="keyword">null</span>;</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MyObject</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        instance = <span class="keyword">new</span> MyObject();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> MyObject <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ThreadA.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread16;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadA</span> <span class="keyword">extends</span> <span class="title">Thread</span></span></div><div class="line">&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">            System.out.println(MyObject.getInstance().hashCode());</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.thread.thread16;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/6/4.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ThreadA ta1 = <span class="keyword">new</span> ThreadA();</div><div class="line">        ThreadA ta2 = <span class="keyword">new</span> ThreadA();</div><div class="line">        ThreadA ta3 = <span class="keyword">new</span> ThreadA();</div><div class="line">        ta1.start();</div><div class="line">        ta2.start();</div><div class="line">        ta3.start();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="使用枚举数据类型实现单例模式"><a href="#使用枚举数据类型实现单例模式" class="headerlink" title="使用枚举数据类型实现单例模式"></a>使用枚举数据类型实现单例模式</h3><p>在使用枚举类时，构造方法会被自动调用，也可以应用这个特性实现单例模式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyObject</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">enum</span> MyEnumSingleton&#123;</div><div class="line">        INSTANCE;</div><div class="line">        <span class="keyword">private</span> Resource resource;</div><div class="line">        <span class="function"><span class="keyword">private</span> <span class="title">MyEnumSingleton</span><span class="params">()</span></span>&#123;</div><div class="line">            resource = <span class="keyword">new</span> Resource();</div><div class="line">        &#125;</div><div class="line">        <span class="function"><span class="keyword">public</span> Resource <span class="title">getResource</span><span class="params">()</span></span>&#123;</div><div class="line">            <span class="keyword">return</span> resource;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Resource <span class="title">getResource</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> MyEnumSingleton.INSTANCE.getResource();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> test.MyObject;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Run</span> </span>&#123;</div><div class="line">    <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</div><div class="line">        <span class="meta">@Override</span></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</div><div class="line">                System.out.println(MyObject.getResource().hashCode());</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Run.MyThread t1 = <span class="keyword">new</span> Run().new MyThread();</div><div class="line">        Run.MyThread t2 = <span class="keyword">new</span> Run().new MyThread();</div><div class="line">        Run.MyThread t3 = <span class="keyword">new</span> Run().new MyThread();</div><div class="line">        t1.start();</div><div class="line">        t2.start();</div><div class="line">        t3.start();</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这里再推荐一篇 stackoverflow 上的一个问题回答： <a href="https://stackoverflow.com/questions/70689/what-is-an-efficient-way-to-implement-a-singleton-pattern-in-java" target="_blank" rel="external">What is an efficient way to implement a singleton pattern in Java?</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本篇文章是我读 《Java多线程编程核心技术》 的笔记及自己的一些总结，觉得不错，欢迎点赞和转发。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;第一章-——-Java-多线程技能&quot;&gt;&lt;a href=&quot;#第一章-——-Java-多线程技能&quot; class=&quot;headerlink&quot; title=&quot;第一章 —— Java 多线程技能&quot;&gt;&lt;/a&gt;第一章 —— Java 多线程技能&lt;/h2&gt;&lt;p&gt;线程技术点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;线程的启动&lt;/li&gt;
&lt;li&gt;如何使线程暂停&lt;/li&gt;
&lt;li&gt;如何使线程停止&lt;/li&gt;
&lt;li&gt;线程的优先级&lt;/li&gt;
&lt;li&gt;线程安全相关问题&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;进程和线程的概念及多线程的优点&quot;&gt;&lt;a href=&quot;#进程和线程的概念及多线程的优点&quot; class=&quot;headerlink&quot; title=&quot;进程和线程的概念及多线程的优点&quot;&gt;&lt;/a&gt;进程和线程的概念及多线程的优点&lt;/h3&gt;&lt;p&gt;进程：比如我们电脑运行的 QQ.exe 程序，是操作系统管理的基本运行单元&lt;/p&gt;
&lt;p&gt;线程：在进程中独立运行的子任务，比如 QQ.exe 进程中就有很多线程在运行，下载文件线程、发送消息线程、语音线程、视频线程等。&lt;/p&gt;
&lt;p&gt;多线程优点：我们电脑可以同时操作不同的软件，边听着歌，敲着代码，查看 pdf 文档，浏览网页等，CPU 在这些任务之间不停的切换，切换非常快，所以我们就觉得他们是在同时运行的。&lt;br&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
      <category term="多线程" scheme="http://yoursite.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title> 六月 —— 愿你做最美好的自己！</title>
    <link href="http://yoursite.com/2017/06/02/poetry2/"/>
    <id>http://yoursite.com/2017/06/02/poetry2/</id>
    <published>2017-06-02T09:49:19.563Z</published>
    <updated>2017-06-02T11:29:42.165Z</updated>
    
    <content type="html"><![CDATA[<p>美妙的六月已经到来，送你八封信，愿时光轻缓，愿微风正好，愿你做最美好的自己。</p>
<p>第一封 —— 关于压力</p>
<p>鸡蛋，从外打破是食物，从内打破是生命。人生亦是，从外打破是压力，从内打破是成长。<br>如果你等待别人打破你，那么你注定成为别人的食物；如果能让自己从内打破，那么你会发现自己的成长相当于一种重生。</p>
<p>第二封 —— 关于读书</p>
<p> 读书是一种充实人生的艺术，没有书的人生就像空心的竹子一样，空洞无物。犹太人让孩子们亲吻涂有蜂蜜的书本，是为了让他们记住：书本是甜的，要让甜蜜充满人生就要读书。读书是一本人生最难得的存折，一点一滴地积累，最后你会发现：自己是世界上最富有的人。<br><a id="more"></a><br>第三封 —— 关于人际关系</p>
<p>你可以要求自己守信，但不能要求别人守信；你可以要求自己对人好，但不能期待别人对你好。你怎样对人，并不代表人家就会怎么对你。如果看不透这一点，你只会徒添不必要的烦恼。</p>
<p>第四封 —— 关于孤独</p>
<p>每个人都要经历一段孤独的日子，每段路都有一段独孤的时光。父母不可能一直帮着你，朋友也不可能一直围着你转。孤独不是孤僻，更不是寂寞。经历过孤独的人，内心更坚强，不管处于什么样的环境都能让自己安静，更好地调整状态，面对环境。</p>
<p>第五封 —— 关于修养</p>
<p>看别人不顺眼，是自己修养不够。人愤怒的那一瞬间，智商是零，过一分钟后恢复正常。人的优雅关键在于控制自己的惰绪，用嘴伤害人，是最愚蠢的一种行为。 </p>
<p>第六封 —— 关于现实</p>
<p>现实有太多的不如意，就算生活给你的是垃圾，你同样能把垃圾踩在脚底下登上世界之巅。你要把自己逼出最大的潜能，没有人会为你的未来买单，你要么努力向上爬，要么烂在社会最底层的泥里，这就是生活。  </p>
<p>第七封 —— 关于自己</p>
<p>一个人经过不同程度的鍛炼，就获得不同程度的修养。好比香料，捣得愈碎，磨得愈细，香得愈浓烈。<br>我们曾如此渴望命运的波澜，到最后才发现：人生最曼妙的风景，竟是内心的淡定与从容。我们曾如此期盼外界的认可，到最后才知道：世界是自己的，与他人毫无关系。</p>
<p>第八封 —— 关于幸福</p>
<p>常有人说，我现在不幸福，等我结了婚或买了房……就幸福了。事实是，幸福的人在哪儿都幸福，不幸福的人在哪儿都不幸福。所以要先培养自己的幸福力，不论发生什么，别人都动不了你的自在开心。这才是真正强大的气场和自信。</p>
<p>幸福的人生，需要三种姿态：对过去，要淡；对现在，要惜；对未来，要信。愿你拥有幸福的能力，做最美好的自己。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;美妙的六月已经到来，送你八封信，愿时光轻缓，愿微风正好，愿你做最美好的自己。&lt;/p&gt;
&lt;p&gt;第一封 —— 关于压力&lt;/p&gt;
&lt;p&gt;鸡蛋，从外打破是食物，从内打破是生命。人生亦是，从外打破是压力，从内打破是成长。&lt;br&gt;如果你等待别人打破你，那么你注定成为别人的食物；如果能让自己从内打破，那么你会发现自己的成长相当于一种重生。&lt;/p&gt;
&lt;p&gt;第二封 —— 关于读书&lt;/p&gt;
&lt;p&gt; 读书是一种充实人生的艺术，没有书的人生就像空心的竹子一样，空洞无物。犹太人让孩子们亲吻涂有蜂蜜的书本，是为了让他们记住：书本是甜的，要让甜蜜充满人生就要读书。读书是一本人生最难得的存折，一点一滴地积累，最后你会发现：自己是世界上最富有的人。&lt;br&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="http://yoursite.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>《疯狂 Java 突破程序员基本功的 16 课》读书笔记</title>
    <link href="http://yoursite.com/2017/05/31/Java-16-lession/"/>
    <id>http://yoursite.com/2017/05/31/Java-16-lession/</id>
    <published>2017-05-31T13:11:32.805Z</published>
    <updated>2017-06-13T10:42:01.568Z</updated>
    
    <content type="html"><![CDATA[<h2 id="第-1-课-——-数组与内存控制"><a href="#第-1-课-——-数组与内存控制" class="headerlink" title="第 1 课 —— 数组与内存控制"></a>第 1 课 —— 数组与内存控制</h2><h3 id="数组初始化"><a href="#数组初始化" class="headerlink" title="数组初始化"></a>数组初始化</h3><p>数组初始化之后，该数组的长度是不可变的（可通过数组的 length 属性访问数组的长度）。Java 中的数组必须经过初始化（为数组对象的元素分配内存空间，并为每个数组元素指定初始值）才可使用。</p>
<p>数组初始化的形式：</p>
<ul>
<li>静态初始化：初始化时由程序员显示的指定每个数组的初始值，系统决定数组长度。</li>
<li>动态初始化：初始化时程序员只指定数组的长度，系统为数组元素分配初始值。</li>
</ul>
<a id="more"></a>
<h3 id="使用数组"><a href="#使用数组" class="headerlink" title="使用数组"></a>使用数组</h3><p>数组元素就是变量：例如 int[] 数组元素相当于 int 类型的变量</p>
<p>当通过索引来使用数组元素时（访问数组元素的值、为数组元素赋值），将该数组元素当成普通变量使用即可。</p>
<h2 id="第-2-课-——-对象与内存的控制"><a href="#第-2-课-——-对象与内存的控制" class="headerlink" title="第 2 课 —— 对象与内存的控制"></a>第 2 课 —— 对象与内存的控制</h2><p>Java 内存管理分为：内存分配和内存回收。</p>
<blockquote>
<ul>
<li>内存分配：创建 Java 对象时 JVM 为该对象在堆内存中所分配的内存空间。</li>
<li>内存回收：当 Java 对象失去引用，变成垃圾，JVM 的垃圾回收机制自动清理该对象，并回收内存</li>
</ul>
</blockquote>
<h3 id="实例变量-和-类变量"><a href="#实例变量-和-类变量" class="headerlink" title="实例变量 和 类变量"></a>实例变量 和 类变量</h3><h4 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h4><p>特点：作用时间短，存储在方法的栈内存中</p>
<p>种类：</p>
<ul>
<li>形参：方法签名中定义的局部变量，由方法调用者负责为其赋值，随方法结束而消亡</li>
<li>方法内的局部变量：方法内定义的局部变量，必须在方法内对其进行显示初始化，从初始化后开始生效，随方法结束而消亡</li>
<li>代码块内的局部变量：在代码块中定义的局部变量，必须在代码块中进行显示初始化，从初始化后开始生效，随代码块结束而消亡</li>
</ul>
<h4 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h4><p>类体内定义的变量，如果该成员变量没有使用 static 修饰，那该成员变量又被称为非静态变量或实例变量，如果使用 static 修饰，则该成员变量又可被称为静态变量或类变量。</p>
<h4 id="实例变量和类变量的属性"><a href="#实例变量和类变量的属性" class="headerlink" title="实例变量和类变量的属性"></a>实例变量和类变量的属性</h4><p>使用 static 修饰的成员变量是类变量，属于该类本身，没有使用 static 修饰的成员变量是实例变量，属于该类的实例，在同一个类中，每一个类只对应一个 Class 对象，但每个类可以创建多个对象。</p>
<p>由于同一个 JVM 内的每个类只对应一个 CLass 对象，因此同一个 JVM 内的一个类的类变量只需要一块内存空间；但对于实例变量而言，该类每创建一次实例，就需要为该实例变量分配一块内存空间。也就是说，程序中创建了几个实例，实例变量就需要几块内存空间。</p>
<p>这里我想到一道面试题目：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span>&#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div></pre></td></tr></table></figure>
<p>静态代码块只执行一次，而代码块每创建一个实例，就会打印一次。</p>
<h4 id="实例变量的初始化时机"><a href="#实例变量的初始化时机" class="headerlink" title="实例变量的初始化时机"></a>实例变量的初始化时机</h4><p>程序可在3个地方对实例变量执行初始化：</p>
<ul>
<li>定义实例变量时指定初始值</li>
<li>非静态初始化块中对实例变量指定初始值</li>
<li>构造器中对实例变量指定初始值</li>
</ul>
<p>上面第一种和第二种方式比第三种方式更早执行，但第一、二种方式的执行顺序与他们在源程序中的排列顺序相同。</p>
<p>同样在上面那个代码上加上一个变量 weight 的成员变量，我们来验证下上面的初始化顺序：</p>
<p>1、<code>定义实例变量指定初始值</code> 在 <code>非静态初始化块对实例变量指定初始值</code> 之后:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.0</div></pre></td></tr></table></figure>
<p>2、<code>定义实例变量指定初始值</code> 在 <code>非静态初始化块对实例变量指定初始值</code> 之前:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">	<span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.1</div></pre></td></tr></table></figure>
<p>大家有没有觉得很奇怪？</p>
<p>我来好好说清楚下：</p>
<blockquote>
<p>定义实例变量时指定的初始值、初始代码块中为实例变量指定初始值的语句的地位是平等的，当经过编译器处理后，他们都将会被提取到构造器中。也就是说，这条语句 <code>double weight = 2.0;</code> 实际上会被分成如下 2 次执行：</p>
<ul>
<li><code>double weight;</code> : 创建 Java 对象时系统根据该语句为该对象分配内存。</li>
<li><code>weight = 2.1;</code> : 这条语句将会被提取到 Java 类的构造器中执行。</li>
</ul>
</blockquote>
<p>只说原理，大家肯定不怎么信，那么还有拿出源码来，这样才有信服能力的吗？是不？</p>
<p>这里我直接使用软件将代码的字节码文件反编译过来，看看里面是怎样的组成？</p>
<p>第一个代码的反编译源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二个代码反编译源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这下子满意了吧！</p>
<p>通过反编译的源码可以看到该类定义的 weight 实例变量时不再有初始值，为 weight 指定初始值的代码也被提到了构造器中去了，但是我们也可以发现之前规则也是满足的。</p>
<p>他们的赋值语句都被合并到构造器中，在合并过程中，定义的变量语句转换得到的赋值语句，初始代码块中的语句都转换得到的赋值语句，总是位于构造器的所有语句之前，合并后，两种赋值语句的顺序也保持了它们在 Java 源代码中的顺序。</p>
<p>大致过程应该了解了吧？如果还不怎么清楚的，建议还是自己将怎个过程在自己的电脑上操作一遍，毕竟光看不练假把式。</p>
<h4 id="类变量的初始化时机"><a href="#类变量的初始化时机" class="headerlink" title="类变量的初始化时机"></a>类变量的初始化时机</h4><p>JVM 对每一个 Java 类只初始化一次，因此 Java 程序每运行一次，系统只为类变量分配一次内存空间，执行一次初始化。程序可在两个地方对类变量执行初始化：</p>
<ul>
<li>定义类变量时指定初始值</li>
<li>静态初始化代码块中对类变量指定初始值</li>
</ul>
<p>这两种方式的执行顺序与它们在源代码中的排列顺序相同。</p>
<p>还是用上面那个示例，我们在其基础上加个被 static 修饰的变量 height：</p>
<p>1、<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    <span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        height = <span class="number">10.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">        System.out.println(height);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.1</div><div class="line">10.0</div></pre></td></tr></table></figure>
<p>2、<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之前：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>;</div><div class="line">    <span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        height = <span class="number">10.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">        System.out.println(height);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.1</div><div class="line">10.1</div></pre></td></tr></table></figure>
<p>其运行结果正如我们预料，但是我们还是看看反编译后的代码吧！</p>
<p>第一种情况下反编译的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>D;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">    System.out.println(height);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二种情况下反编译的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>D;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    height = <span class="number">10.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">    System.out.println(height);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过反编译源码，可以看到第一种情况下(<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之后):</p>
<p>我们在 <strong>静态初始化代码块中对类变量指定初始值</strong> 已经不存在了，只有一个类变量指定的初始值 <code>static double height = 10.0D;</code> , 而在第二种情况下（<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之前）和之前的源代码顺序是一样的，没啥区别。</p>
<p>上面的代码中充分的展示了类变量的两种初始化方式 ：每次运行该程序时，系统会为 A 类执行初始化，先为所有类变量分配内存空间，再按照源代码中的排列顺序执行静态初始代码块中所指定的初始值和定义类变量时所指定的初始值。</p>
<h3 id="父类构造器"><a href="#父类构造器" class="headerlink" title="父类构造器"></a>父类构造器</h3><p>当创建任何 Java 对象时，程序总会先依次调用每个父类非静态初始化代码块、父类构造器（总是从 Object 开始）执行初始化，最后才调用本类的非静态初始化代码块、构造器执行初始化。</p>
<h4 id="隐式调用和显示调用"><a href="#隐式调用和显示调用" class="headerlink" title="隐式调用和显示调用"></a>隐式调用和显示调用</h4><p>当调用某个类的构造器来创建 Java 对象时，系统总会先调用父类的非静态初始化代码块进行初始化。这个调用是隐式执行的，而且父类的静态初始化代码块总是会被执行。接着会调用父类的一个或多个构造器执行初始化，这个调用既可以是通过 super 进行显示调用，也可以是隐式调用。</p>
<p>当所有父类的非静态初始代码块、构造器依次调用完成后，系统调用本类的非静态代码块、构造器执行初始化，最后返回本类的实例。至于调用父类的哪个构造器执行初始化，分以下几种情况：</p>
<ul>
<li>子类构造器执行体的第一行代码使用 super 显式调用父类构造器，系统将根据 super 调用里传入的实参列表来确定调用父类的哪个构造器；</li>
<li>子类构造器执行体的第一行代码使用 this 显式调用本类中的重载构造器，系统将根据 this 调用里传入的实参列表来确定奔雷的另一个构造器（执行本类中另一个构造器时即进入第一种情况）；</li>
<li>子类构造器中既没有 super 调用，也没有 this 调用，系统将会在执行子类构造器之前，隐式调用父类无参构造器。</li>
</ul>
<p>注：super 和 this 必须在构造器的第一行，且不能同时存在。</p>
<p>推荐一篇博客：<a href="http://www.cnblogs.com/miniwiki/archive/2011/03/25/1995615.html" target="_blank" rel="external">Java初始化顺序</a> 文章从无继承和继承两种情况下分析了 Java 初始化的顺序。</p>
<p><strong>Java初始化顺序如图：</strong></p>
<p><img src="data:image/png;base64,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NriW1VDAwKvGcXAtrIAVGEaBTZs2zZo168Ybb1y5ciXA43v58uVXXHHFIYccwi7LZgXGroCBN3atnNIKWIHBKHDppZeCukK49tprB1Mbl1pbBQy82h46V9wKtEaBNWvWFGh34IEHpkudrVHCDZ2QAgbehORzZitgBcpR4LzzzkuZt3Tp0nLKdSlNUsDAa9LRdFusQGMVePjhhwN4M2fObGw73bCcChh4OdW1bStgBfqnAJwT84Bf/6zaUosUMPBadLDdVCtQawWWLVsG7c4444xat8KVH6ACBt4AxXfRVsAK7IQCXKXCtSpcwLITeZzUCiQKGHjuDlagvQpwHxu3tREOOuig7uv+HTMRBViAlbbt7V7Va7mBV71j4hpZgZwKADnWBlkYZDafMmXKoUNhwYIFv3DonwI333zzMcccI22lM7cS+tRjzn49JtsG3phkciIr0AAF1q1bB+f23nvv448/HsLd6lCWAtddd9255547ffr0vfbaC6r6DsJBjSYDb1DKu1wrUJ4CeHV4GFOnTjXnymJc73JuuOGGU0899Tvf+Q5OdnmH3yV9pICB575gBRquAKeRQB0exmDnepceCuDw4WRzRPzw65LHnoFXsuAuzgqUqgBPJOE00vXXX3+LQ8UUuPDCC4899ljWmUvtEO0uzMBr9/F36xutAMuYJ510UsXmeVfnYwWWLFly8MEHP/PMM43uhhVqnIFXoYPhqliBPirAWaLjjjvOeKm4AldddRXMe+WVV/p46G1qOAUMPPcNK9BABVavXs1KJu+Q4/p4h4orcMkll5xwwglvvfVWAztixZpk4FXsgLg6VmDCCnDV+7777nvNNddUfKJ39UKBOXPmXHbZZTt27JjwwbeBkRQw8Nw/rEDTFOBt4GeeeaZxUi8FeGraE0888f777zetO1apPQZelY6G62IFJqwAt9zh3nG/188daqXAvHnz8PPeeOONCXcBGxhWAQPPncMKNEoBrsw8++yzazXVu7IfKoCTt2LFCi9s5huQBl4+bW3ZCpStAGfveHIY9zWbIXVUgH8q3Jy3efPmsvtNa8oz8FpzqN3QFijw+OOPH3bYYTc51FMBblHgmTgvvvjitm3bWtBbB9BEA28AortIK5BJAa1n1nO2d607CkybNu2hhx7ymbxMA8TAyySszVqBAShwxBFHcHW70VFfBU4++eSrr756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" alt=""></p>
<h4 id="访问子类对象的实例变量"><a href="#访问子类对象的实例变量" class="headerlink" title="访问子类对象的实例变量"></a>访问子类对象的实例变量</h4><h4 id="调用被子类重写的方法"><a href="#调用被子类重写的方法" class="headerlink" title="调用被子类重写的方法"></a>调用被子类重写的方法</h4><h3 id="父子实例的内存控制"><a href="#父子实例的内存控制" class="headerlink" title="父子实例的内存控制"></a>父子实例的内存控制</h3><h4 id="继承成员变量和继承方法的区别"><a href="#继承成员变量和继承方法的区别" class="headerlink" title="继承成员变量和继承方法的区别"></a>继承成员变量和继承方法的区别</h4><p>方法的行为总是表现出它们实际类型的行为；实例变量的值总是表现出声明这些变量所用类型的行为。</p>
<h4 id="内存中的子类实例"><a href="#内存中的子类实例" class="headerlink" title="内存中的子类实例"></a>内存中的子类实例</h4><h4 id="父、子类的类变量"><a href="#父、子类的类变量" class="headerlink" title="父、子类的类变量"></a>父、子类的类变量</h4><h3 id="final-修饰符"><a href="#final-修饰符" class="headerlink" title="final 修饰符"></a>final 修饰符</h3><p>final 可以修饰变量、方法、类。</p>
<ul>
<li>修饰变量，变量被赋初始值之后，不能够对他在进行修改</li>
<li>修饰方法，不能够被重写</li>
<li>修饰类，不能够被继承</li>
</ul>
<p>final 修饰的实例变量只能在如下位置指定初始值：</p>
<ul>
<li>定义 final 实例变量时指定初始值</li>
<li>在非静态代码块中为 final 实例变量指定初始值</li>
<li>在构造器中为 final 实例变量指定初始值</li>
</ul>
<p>final 修饰的类变量只能在如下位置指定初始值：</p>
<ul>
<li>定义 final 类变量时指定初始值</li>
<li>在静态代码块中为 final 类变量指定初始值</li>
</ul>
<h2 id="第-3-课-——-常见-Java-集合的实现细节"><a href="#第-3-课-——-常见-Java-集合的实现细节" class="headerlink" title="第 3 课 —— 常见 Java 集合的实现细节"></a>第 3 课 —— 常见 Java 集合的实现细节</h2><p>Java 集合框架类图：</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/Java%E9%9B%86%E5%90%88%E6%A1%86%E6%9E%B6%E7%B1%BB%E5%9B%BE.jpg" alt=""></p>
<h3 id="Set-和-Map"><a href="#Set-和-Map" class="headerlink" title="Set 和 Map"></a>Set 和 Map</h3><p>Set 代表一种集合元素无序、集合元素不可重复的集合，Map 则代表一种由多个 key-value 对组合的集合，Map 集合类似于传统的关联数组。</p>
<h4 id="Set-和-Map-的关系"><a href="#Set-和-Map-的关系" class="headerlink" title="Set 和 Map 的关系"></a>Set 和 Map 的关系</h4><p>1、Map 集合中的 key 不能重复且没有顺序。将这些 key 组合起来就是一个 Set 集合。所以有一个 <code>Set&lt;k&gt; keySet()</code> 方法来返回所有 key 组成的 Set 集合。</p>
<p>2、Set 也可以转换成 Map。（在 Set 中将 每一对 key 和 value 存放在一起）</p>
<h4 id="HashMap-和-HashSet"><a href="#HashMap-和-HashSet" class="headerlink" title="HashMap 和 HashSet"></a>HashMap 和 HashSet</h4><p>HashSet：系统采用 Hash 算法决定集合元素的存储位置。（基于 HashMap 实现的）</p>
<p>HashMap：系统将 value 当成 key 的附属，系统根据 Hash 算法决定 key 的存储位置。</p>
<p>HashSet 的绝大部分方法都是通过调用 HashMap 的方法实现的，因此 HashSet 和 HashMap 两个集合在实现本质上是相同的。</p>
<h4 id="TreeMap-和-TreeSet"><a href="#TreeMap-和-TreeSet" class="headerlink" title="TreeMap 和 TreeSet"></a>TreeMap 和 TreeSet</h4><p>TreeSet 底层使用 TreeMap 来包含 Set 集合中的所有元素。</p>
<p>TreeMap 采用的是一种“红黑树”的排序二叉树来保存 Map 中每个 Entry —— 每个 Entry 都被当成 “红黑树” 的一个节点对待。</p>
<h3 id="Map-和-List"><a href="#Map-和-List" class="headerlink" title="Map 和 List"></a>Map 和 List</h3><h4 id="Map-的-values-方法"><a href="#Map-的-values-方法" class="headerlink" title="Map 的 values() 方法"></a>Map 的 values() 方法</h4><p>不管是 HashMap 还是 TreeMap ，它们的 values() 方法都可以返回其所有 value 组成的 Collection 集合，其实是一个不存储元素的 Collection 集合，当程序遍历 Collection 集合时，实际上就是遍历 Map 对象的 value。</p>
<p>HashMap 和 TreeMap 的 values() 方法并未把 Map 中的 values 重新组合成一个包含元素的集合对象，这样就可以降低系统内存开销。</p>
<h4 id="Map-和-List-的关系"><a href="#Map-和-List-的关系" class="headerlink" title="Map 和 List 的关系"></a>Map 和 List 的关系</h4><p>底层实现很相似；用法上很相似。</p>
<ul>
<li>Map 接口提供 get(K key) 方法允许 Map 对象根据 key 来取得 value；</li>
<li>List 接口提供了 get(int index) 方法允许 List 对象根据元素索引来取得 value；</li>
</ul>
<h3 id="ArrayList-和-LinkedList"><a href="#ArrayList-和-LinkedList" class="headerlink" title="ArrayList 和 LinkedList"></a>ArrayList 和 LinkedList</h3><p>List 集合的实现类，主要有 ArrayList 、Vector 和 LinkedList。</p>
<ul>
<li><strong>ArrayList </strong>是一个可改变大小的数组.当更多的元素加入到 ArrayList 中时, 其大小将会动态地增长.  内部的元素可以直接通过 get 与 set 方法进行访问, 因为 ArrayList 本质上就是一个数组.</li>
<li><strong>LinkedList </strong>是一个双链表, 在添加和删除元素时具有比 ArrayList 更好的性能. 但在 get 与 set 方面弱于ArrayList. 当然, 这些对比都是指数据量很大或者操作很频繁的情况下的对比, 如果数据和运算量很小,那么对比将失去意义.</li>
<li><strong>Vector </strong>和 ArrayList 类似, 但属于强同步类。如果你的程序本身是线程安全的(thread-safe,没有在多个线程之间共享同一个集合/对象),那么使用 ArrayList 是更好的选择。</li>
</ul>
<p>Vector 和 ArrayList 在更多元素添加进来时会请求更大的空间。Vector 每次请求其大小的双倍空间，而 ArrayList每次对 size 增长 50%.</p>
<p>而 LinkedList 还实现了 Queue 接口, 该接口比 List 提供了更多的方法,包括 offer(), peek(), poll()等.</p>
<p>注意: 默认情况下 ArrayList 的初始容量非常小, 所以如果可以预估数据量的话, 分配一个较大的初始值属于最佳实践, 这样可以减少调整大小的开销。</p>
<p>ArrayList与LinkedList性能对比</p>
<p>时间复杂度对比如下:</p>
<p><img src="http://www.programcreek.com/wp-content/uploads/2013/03/arraylist-vs-linkedlist-complexity.png" alt=""></p>
<p>LinkedList 更适用于:</p>
<ul>
<li>没有大规模的随机读取</li>
<li>大量的增加/删除操作</li>
</ul>
<h3 id="Iterator-迭代器"><a href="#Iterator-迭代器" class="headerlink" title="Iterator 迭代器"></a>Iterator 迭代器</h3><p>是一个迭代器接口，专门用于迭代各种 Collection 集合，包括 Set  集合和 List 集合。</p>
<h2 id="第-4-课-——-Java-的内存回收"><a href="#第-4-课-——-Java-的内存回收" class="headerlink" title="第 4 课 —— Java 的内存回收"></a>第 4 课 —— Java 的内存回收</h2><h3 id="Java-引用的种类"><a href="#Java-引用的种类" class="headerlink" title="Java 引用的种类"></a>Java 引用的种类</h3><h4 id="对象在内存中的状态"><a href="#对象在内存中的状态" class="headerlink" title="对象在内存中的状态"></a>对象在内存中的状态</h4><p>JVM 垃圾回收机制，是否回收一个对象的标准在于：是否还有引用变量引用该对象？只要有引用变量引用该对象，垃圾回收机制就不会回收它。</p>
<p>Java 语言对对象的引用有：</p>
<ul>
<li>强引用</li>
<li>软引用</li>
<li>弱引用</li>
<li>虚引用</li>
</ul>
<h4 id="强引用"><a href="#强引用" class="headerlink" title="强引用"></a>强引用</h4><p>程序创建一个对象，并把这个对象赋给一个引用变量，这个引用变量就是强引用。当一个对象被一个或者一个以上的强引用变量所引用时，它处于可达状态，它是不会被系统的垃圾回收机制回收。</p>
<h4 id="软引用"><a href="#软引用" class="headerlink" title="软引用"></a>软引用</h4><p>软引用需要通过 SoftReference 类来实现，当一个对象只具有软引用时，它有可能会被垃圾回收机制回收。对于只有软引用的对象而言，当系统内存空间足够时，它不会被系统回收，程序也可使用该对象；当系统内存空间不足时，系统将会回收它。</p>
<h4 id="弱引用"><a href="#弱引用" class="headerlink" title="弱引用"></a>弱引用</h4><p>弱引用和软引用有点相似，区别在于弱引用所引用对象的生存期更短。</p>
<h4 id="虚引用"><a href="#虚引用" class="headerlink" title="虚引用"></a>虚引用</h4><p>虚引用主要用于跟踪对象被垃圾回收的状态，虚引用不能单独使用，虚引用必须和引用队列联合使用。</p>
<h3 id="Java-的内存泄漏"><a href="#Java-的内存泄漏" class="headerlink" title="Java 的内存泄漏"></a>Java 的内存泄漏</h3><p>ArrayList.java 中的 remove 方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> E <span class="title">remove</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">        rangeCheck(index);</div><div class="line">        modCount++;</div><div class="line">        E oldValue = elementData(index);</div><div class="line">        <span class="keyword">int</span> numMoved = size - index - <span class="number">1</span>;</div><div class="line">        <span class="keyword">if</span> (numMoved &gt; <span class="number">0</span>)</div><div class="line">            System.arraycopy(elementData, index+<span class="number">1</span>, elementData, index,</div><div class="line">                             numMoved);</div><div class="line">        elementData[--size] = <span class="keyword">null</span>; <span class="comment">// clear to let GC do its work</span></div><div class="line">        <span class="keyword">return</span> oldValue;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>其中 <code>elementData[--size] = null; // clear to let GC do its work</code> 语句是清除数组元素的引用，避免内存的泄漏，如果没有这句的话，那么就是只有两个作用：</p>
<ul>
<li>修饰 Stack 的属性，也就是将值减 1；</li>
<li>返回索引为 size -1 的值。</li>
</ul>
<h3 id="垃圾回收机制"><a href="#垃圾回收机制" class="headerlink" title="垃圾回收机制"></a>垃圾回收机制</h3><ul>
<li>跟踪并监控每个 Java 对象，当某个对象处于不可达状态时，回收该对象所占用的内存。</li>
<li>清理内存分配，回收过程中产生的内存碎片。</li>
</ul>
<h4 id="垃圾回收的基本算法"><a href="#垃圾回收的基本算法" class="headerlink" title="垃圾回收的基本算法"></a>垃圾回收的基本算法</h4><p>对于一个垃圾回收器的设计算法来说，大概有如下几个设计：</p>
<ul>
<li><p>串行回收 和 并行回收</p>
<blockquote>
<p>串行回收：不管系统有多少个 CPU，始终使用一个 CPU 来执行垃圾回收操作</p>
<p>并行回收：把整个回收工作拆分成多部分，每个部分由一个 CPU 负责，从而让多个 CPU 并行回收</p>
</blockquote>
</li>
<li><p>并发执行 和 应用程序停止</p>
</li>
<li><p>压缩 和 不压缩 和 复制</p>
<blockquote>
<ul>
<li>复制：将堆内分成两个相同的空间，从根开始访问每一个关联的可达对象，将空间A的可达对象全部复制到空间B，然后一次性回收整个空间A。</li>
<li>标记清除：也就是 不压缩 的回收方式。垃圾回收器先从根开始访问所有可达对象，将它们标记为可达状态，然后再遍历一次整个内存区域，把所有没有标记为可达的对象进行回收处理。</li>
<li>标记压缩：这是压缩方式，这种方式充分利用上述两种算法的优点，垃圾回收器先从根开始访问所有可达对象，将他们标记为可达状态，接下来垃圾回收器会将这些活动对象搬迁在一起，这个过程叫做内存压缩，然后垃圾回收机制再次回收那些不可达对象所占用的内存空间，这样就避免了回收产生的内存碎片。</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="堆内存的分代回收"><a href="#堆内存的分代回收" class="headerlink" title="堆内存的分代回收"></a>堆内存的分代回收</h4><p>1、Young 代</p>
<p>2、Old 代</p>
<p>3、Permanent 代</p>
<h3 id="内存管理小技巧"><a href="#内存管理小技巧" class="headerlink" title="内存管理小技巧"></a>内存管理小技巧</h3><ul>
<li>尽量使用直接量</li>
<li>使用 StringBuilder 和 StringBuffer 进行字符串拼接</li>
<li>尽早释放无用对象的引用</li>
<li>尽量少用静态变量</li>
<li>避免在经常调用的方法、循环中创建 Java 对象</li>
<li>缓存经常使用的对象</li>
<li>尽量不要使用 finalize 方法</li>
<li>考虑使用 SoftReference</li>
</ul>
<h2 id="第-5-课-——-表达式中的陷阱"><a href="#第-5-课-——-表达式中的陷阱" class="headerlink" title="第 5 课 —— 表达式中的陷阱"></a>第 5 课 —— 表达式中的陷阱</h2><h3 id="关于字符串的陷阱"><a href="#关于字符串的陷阱" class="headerlink" title="关于字符串的陷阱"></a>关于字符串的陷阱</h3><h4 id="JVM-对字符串的处理"><a href="#JVM-对字符串的处理" class="headerlink" title="JVM 对字符串的处理"></a>JVM 对字符串的处理</h4><p><code>String java = new String(&quot;Java&quot;)</code> 这句创建了两个字符串对象，一个是 “Java” 这个直接量对应的字符串对象，另外一个是 new String() 构造器返回的字符串对象。</p>
<p>Java 程序中创建对象的方法：</p>
<ul>
<li>通过 new 调用构造器创建 Java 对象</li>
<li>通过 Class 对象的 newInstance() 方法调用构造器创建 Java 对象</li>
<li>通过 Java 的反序列化机制从 IO 流中恢复 Java 对象</li>
<li>通过 Java 对象提供的 clone() 方法复制一个新的 Java 对象</li>
<li>对于字符串以及 Byte、Short、Int、Long、Character、Float、Double 和 Boolean 这些基本类型的包装类</li>
<li>直接量的方式来创建 Java 对象  Integer in = 5；</li>
<li>通过简单的算法表达式，连接运算来创建 Java 对象 String str = “a” + “b”; （如果这个字符串表达式的值在编译时确定下来，那么 JVM 会在编译时计算该字符串变量的值，并让它指向字符串池中对应的字符串。如果这些算法表达式都是字符串直接量、整数直接量，没有变量和方法参与，那么就可以在编译期就可以确定字符串的值；如果使用了变量、调用了方法，那么只有等到运行时才能确定字符串表达式的值；如果字符串连接运算所有的变量都可执行 “宏替换”（使用 final 修饰的变量），那在编译时期也能确定字符串连接表达式的值）</li>
</ul>
<p>对于 Java 程序的字符直接量，JVM 会使用一个字符串池来保护它们；当第一次使用某个字符串直接量时，JVM 会将它放入字符串池进行缓存。在一般的情况下，字符串池中的字符串对象不会被垃圾回收器回收，当程序再次需要使用该字符串时，无需重新创建一个新的字符串，而是直接让引用变量指向字符串池中已有的字符串。</p>
<h4 id="不可变的字符串"><a href="#不可变的字符串" class="headerlink" title="不可变的字符串"></a>不可变的字符串</h4><p>String 类是一个不可变类，当一个 String 对象创建完成后，该 String 类里包含的字符序列就被固定下来，以后永远不能修改。</p>
<p>如果程序需要一个字符序列会发生改变的字符串，那么建议使用 StringBuilder （效率比 StringBuffer 高）</p>
<h4 id="字符串比较"><a href="#字符串比较" class="headerlink" title="字符串比较"></a>字符串比较</h4><p>如果要比较两个字符串是否相同，用 == 进行判断就行，但如果要判断两个字符串所包含的字符序列是否相同，则应该用 String 重写过的 equals() 方法进行比较。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object anObject)</span> </span>&#123;</div><div class="line">        <span class="comment">//如果两个字符串相同</span></div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == anObject) &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//如果anObject是String类型</span></div><div class="line">        <span class="keyword">if</span> (anObject <span class="keyword">instanceof</span> String) &#123;</div><div class="line">            String anotherString = (String)anObject;</div><div class="line">            <span class="comment">//n代表字符串的长度</span></div><div class="line">            <span class="keyword">int</span> n = value.length;</div><div class="line">            <span class="comment">//如果两个字符串长度相等</span></div><div class="line">            <span class="keyword">if</span> (n == anotherString.value.length) &#123;</div><div class="line">                <span class="comment">//获取当前字符串、anotherString底层封装的字符数组</span></div><div class="line">                <span class="keyword">char</span> v1[] = value;</div><div class="line">                <span class="keyword">char</span> v2[] = anotherString.value;</div><div class="line">                <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">                <span class="comment">//逐一比较v1 和 v2数组中的每个字符</span></div><div class="line">                <span class="keyword">while</span> (n-- != <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">if</span> (v1[i] != v2[i])</div><div class="line">                        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                    i++;</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>还可以使用 String 提供的 compareTo() 方法返回两个字符串的大小</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(String anotherString)</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> len1 = value.length;</div><div class="line">        <span class="keyword">int</span> len2 = anotherString.value.length;</div><div class="line">        <span class="keyword">int</span> lim = Math.min(len1, len2);</div><div class="line">        <span class="keyword">char</span> v1[] = value;</div><div class="line">        <span class="keyword">char</span> v2[] = anotherString.value;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> k = <span class="number">0</span>;</div><div class="line">        <span class="keyword">while</span> (k &lt; lim) &#123;</div><div class="line">            <span class="keyword">char</span> c1 = v1[k];</div><div class="line">            <span class="keyword">char</span> c2 = v2[k];</div><div class="line">            <span class="keyword">if</span> (c1 != c2) &#123;</div><div class="line">                <span class="keyword">return</span> c1 - c2;</div><div class="line">            &#125;</div><div class="line">            k++;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> len1 - len2;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<h3 id="表达式类型的陷阱"><a href="#表达式类型的陷阱" class="headerlink" title="表达式类型的陷阱"></a>表达式类型的陷阱</h3><h4 id="表达式类型的自动提升"><a href="#表达式类型的自动提升" class="headerlink" title="表达式类型的自动提升"></a>表达式类型的自动提升</h4><ul>
<li><p>所有 byte、short、char类型将被提升到 int 类型参与运算</p>
</li>
<li><p>整个算术表达式的数据类型自动提升到与表达式中最高等级操作数同样的类型，操作数的等级排列如下：char -&gt; int -&gt; long -&gt;float -&gt; double</p>
<p>byte -&gt; short -&gt; int -&gt; long -&gt;float -&gt; double</p>
</li>
</ul>
<h4 id="复合赋值运算符的陷阱"><a href="#复合赋值运算符的陷阱" class="headerlink" title="复合赋值运算符的陷阱"></a>复合赋值运算符的陷阱</h4><p>Java 语言允许所有的双目运算符和 = 一起结合组成复合赋值运算符，如 +=、-=、*=、/=、%= 、&amp;= 等，复合赋值运算符包含了一个隐式的类型转换。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//下面这两条语句不等价</span></div><div class="line">a = a + <span class="number">5</span>;		<span class="comment">//</span></div><div class="line">a += <span class="number">5</span>;			<span class="comment">//实际上等价于 a = (a的类型) (a + 5);</span></div></pre></td></tr></table></figure>
<p>复合赋值运算符会自动的将它计算的结果值强制转换为其左侧变量的类型。</p>
<h3 id="输入法导致的陷阱"><a href="#输入法导致的陷阱" class="headerlink" title="输入法导致的陷阱"></a>输入法导致的陷阱</h3><h3 id="注释的字符必须合法"><a href="#注释的字符必须合法" class="headerlink" title="注释的字符必须合法"></a>注释的字符必须合法</h3><h3 id="转义字符的陷阱"><a href="#转义字符的陷阱" class="headerlink" title="转义字符的陷阱"></a>转义字符的陷阱</h3><ul>
<li>慎用字符的 Unicode 转义形式</li>
<li>中止行注释的转义字符</li>
</ul>
<h3 id="泛型可能引起的错误"><a href="#泛型可能引起的错误" class="headerlink" title="泛型可能引起的错误"></a>泛型可能引起的错误</h3><h4 id="原始类型变量的赋值"><a href="#原始类型变量的赋值" class="headerlink" title="原始类型变量的赋值"></a>原始类型变量的赋值</h4><ul>
<li>当程序把一个原始类型的变量赋给一个带有泛型信息的变量时，总是可以通过编译（只是会提示警告信息）</li>
<li>当程序试图访问带泛型声明的集合的集合元素时，编译器总是把集合元素当成泛型类型处理（它并不关心集合里集合元素的实际类型）</li>
<li>当程序试图访问带泛型声明的集合的集合元素时，JVM会遍历每个集合元素自动执行强制转型，如果集合元素的实际类型与集合所带的泛型信息不匹配，运行时将引发 ClassCastException</li>
</ul>
<h4 id="原始类型带来的擦除"><a href="#原始类型带来的擦除" class="headerlink" title="原始类型带来的擦除"></a>原始类型带来的擦除</h4><p>当把一个具有泛型信息的对象赋给另一个没有泛型信息的变量时，所有在尖括号之间的类型信息都会丢弃。</p>
<h4 id="创建泛型数组的陷阱"><a href="#创建泛型数组的陷阱" class="headerlink" title="创建泛型数组的陷阱"></a>创建泛型数组的陷阱</h4><p>Java 中不允许创建泛型数组</p>
<h3 id="正则表达式的陷阱"><a href="#正则表达式的陷阱" class="headerlink" title="正则表达式的陷阱"></a>正则表达式的陷阱</h3><p>有些符号本身就是正则表达式，我们需要对符号做转义运算。</p>
<h3 id="多线程的陷阱"><a href="#多线程的陷阱" class="headerlink" title="多线程的陷阱"></a>多线程的陷阱</h3><h4 id="不要调用-run-方法"><a href="#不要调用-run-方法" class="headerlink" title="不要调用 run 方法"></a>不要调用 run 方法</h4><p>开启线程是用 start() 方法，而不是 run() 方法。</p>
<h4 id="静态的同步方法"><a href="#静态的同步方法" class="headerlink" title="静态的同步方法"></a>静态的同步方法</h4><p>对于同步代码块而言，程序必须显式为它指定同步监视器；对于同步非静态方法而言，该方法的同步监视器是 this —— 即调用该方法的 Java 对象；对于静态的同步方法而言，该方法的同步监视器不是 this，而是该类本身。</p>
<h2 id="第-6-课-——-流程控制的陷阱"><a href="#第-6-课-——-流程控制的陷阱" class="headerlink" title="第 6 课 —— 流程控制的陷阱"></a>第 6 课 —— 流程控制的陷阱</h2><h3 id="switch-语句陷阱"><a href="#switch-语句陷阱" class="headerlink" title="switch 语句陷阱"></a>switch 语句陷阱</h3><p>break 语句不要忘记写</p>
<p>switch 的表达式类型：</p>
<ul>
<li>byte</li>
<li>short</li>
<li>int</li>
<li>char</li>
<li>enum</li>
<li>String （Jdk 1.7 以后有 String）</li>
</ul>
<h3 id="标签引起的陷阱"><a href="#标签引起的陷阱" class="headerlink" title="标签引起的陷阱"></a>标签引起的陷阱</h3><p>Java 中的标签通常是和循环中的 break 和 continue 结合使用，让 break 直接终止标签所标识的循环，让 continue 语句忽略标签所标识的循环的剩下语句。</p>
<p>。。</p>
<h2 id="第-7-课-——-面向对象的陷阱"><a href="#第-7-课-——-面向对象的陷阱" class="headerlink" title="第 7 课 —— 面向对象的陷阱"></a>第 7 课 —— 面向对象的陷阱</h2><h3 id="instanceof-运算符的陷阱"><a href="#instanceof-运算符的陷阱" class="headerlink" title="instanceof  运算符的陷阱"></a>instanceof  运算符的陷阱</h3><p>instanceof 它用于判断前面的对象是否是后面的类或其子类、实现类的实例。如果是返回 true，否则返回 false。</p>
<p>instanceof 运算符前面操作数的编译时类型必须是：</p>
<ul>
<li>要么与后面的类相同</li>
<li>要么是后面类的父类</li>
<li>要么是后面类型的子类</li>
</ul>
<h3 id="构造器陷阱"><a href="#构造器陷阱" class="headerlink" title="构造器陷阱"></a>构造器陷阱</h3><p>构造器是 Java 中每个类都会提供的一个“特殊方法”。构造器负责对 Java 对象执行初始化操作，不管是定义实例变量时指定的初始值，还是在非静态初始化代码块中所做的操作，实际上都会被提取到构造器中执行。</p>
<p>构造器不能声明返回值类型，也不能使用void声明构造器没有返回值。</p>
<h4 id="构造器创建对象吗"><a href="#构造器创建对象吗" class="headerlink" title="构造器创建对象吗"></a>构造器创建对象吗</h4><p>构造器并不会创建 Java 对象，构造器只是负责执行初始化，在构造器执行之前，Java 对象所需要的内存空间，是由 new 关键字申请出来的。绝大部分时候，程序使用 new 关键字为一个 Java 对象申请空间之后，都需要使用构造器为这个对象执行初始化，但在某些时候，程序创建 Java 对象无需调用构造器，如下：</p>
<ul>
<li>使用反序列化的方式恢复 Java 对象</li>
<li>使用 clone 方法复制 Java 对象</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.zhisheng.test;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.*;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by 10412 on 2017/5/31.</div><div class="line"> */</div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wolf</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Wolf</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"调用了有参构造方法"</span>);</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        Wolf wolf = (Wolf) o;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> name != <span class="keyword">null</span> ? name.equals(wolf.name) : wolf.name == <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name != <span class="keyword">null</span> ? name.hashCode() : <span class="number">0</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializableTest</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Wolf w = <span class="keyword">new</span> Wolf(<span class="string">"灰太狼"</span>);</div><div class="line">        System.out.println(<span class="string">"对象创建完成"</span>);</div><div class="line">        Wolf w2 = <span class="keyword">null</span>;</div><div class="line">        ObjectInputStream ois = <span class="keyword">null</span>;</div><div class="line">        ObjectOutputStream oos = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">//创建输出对象流</span></div><div class="line">            oos = <span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">"a.bin"</span>));</div><div class="line">            <span class="comment">//创建输入对象流</span></div><div class="line">            ois = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">"a.bin"</span>));</div><div class="line">            <span class="comment">//序列输出java 对象</span></div><div class="line">            oos.writeObject(w);</div><div class="line">            oos.flush();</div><div class="line">            <span class="comment">//反序列化恢复java对象</span></div><div class="line">            w2 = (Wolf) ois.readObject();</div><div class="line">            System.out.println(w);</div><div class="line">            System.out.println(w2);</div><div class="line">            <span class="comment">//两个对象的实例变量值完全相等，输出true</span></div><div class="line">            System.out.println(w.equals(w2));</div><div class="line">            <span class="comment">//两个对象不同，输出false</span></div><div class="line">            System.out.println(w == w2);</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;<span class="keyword">finally</span> &#123;</div><div class="line">            <span class="keyword">if</span> (ois!=<span class="keyword">null</span>)</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    ois.close();</div><div class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            <span class="keyword">if</span> (oos!=<span class="keyword">null</span>)</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    oos.close();</div><div class="line">                &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>程序运行结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">调用了有参构造方法</div><div class="line">对象创建完成</div><div class="line">com.zhisheng.test.Wolf@<span class="number">1</span>b15382</div><div class="line">com.zhisheng.test.Wolf@<span class="number">1</span>b15382</div><div class="line"><span class="keyword">true</span></div><div class="line"><span class="keyword">false</span></div></pre></td></tr></table></figure>
<p>正如结果所示：创建 Wolf 对象时，程序调用了相应的构造器来对该对象执行初始化；当程序通过反序列化机制恢复 Java 对象时，系统无需在调用构造器来进行初始化。通过反序列化恢复出来的 Wolf 对象和原来的 Wolf 对象具有完全相同的实例变量值，但系统会产生两个对象。</p>
<h4 id="无限递归构造器"><a href="#无限递归构造器" class="headerlink" title="无限递归构造器"></a>无限递归构造器</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConstrutionTest</span></span></div><div class="line">&#123;</div><div class="line">    ConstrutionTest ct;</div><div class="line">    &#123;</div><div class="line">        ct = <span class="keyword">new</span> ConstrutionTest();</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ConstrutionTest</span><span class="params">()</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"无参构造器"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        ConstrutionTest ct = <span class="keyword">new</span> ConstrutionTest();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果抛出异常 <code>java.lang.StackOverflowError</code></p>
<p>因为不管定义实例变量时指定的初始值，还是在非静态初始化代码块中执行的初始化操作，最终都将提取到构造器中执行，因为代码中递归调用了类的构造器，最终导致出现 <code>java.lang.StackOverflowError</code> 异常。</p>
<h3 id="到底调用哪个重载方法"><a href="#到底调用哪个重载方法" class="headerlink" title="到底调用哪个重载方法"></a>到底调用哪个重载方法</h3><p>1、第一阶段 JVM 将会选取所有可获得并匹配调用的方法或者构造器</p>
<p>2、第二个阶段决定到底要调用哪个方法，此时 JVM 会在第一阶段所选取的方法或者构造器中再次选取最精确匹配的那一个。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OverrideTest</span></span></div><div class="line">&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">(Object obj, <span class="keyword">int</span> a)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"obj 参数"</span> + obj);</div><div class="line">        System.out.println(<span class="string">"整型参数 "</span> + a);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">info</span><span class="params">(Object[] obj, <span class="keyword">double</span> a)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"obj 参数"</span> + obj);</div><div class="line">        System.out.println(<span class="string">"整型参数 "</span> + a);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        OverrideTest o = <span class="keyword">new</span> OverrideTest();</div><div class="line">        o.info(<span class="keyword">null</span>, <span class="number">5</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>报错如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Error:(20, 10) java: 对info的引用不明确</div><div class="line">  com.zhisheng.test.OverrideTest 中的方法 info(java.lang.Object,int) 和 com.zhisheng.test.OverrideTest 中的方法 info(java.lang.Object[],double) 都匹配</div></pre></td></tr></table></figure>
<p>在这种复杂的条件下，JVM 无法判断哪个方法更匹配实际调用，将会导致程序编译错误。</p>
<h3 id="方法重写的陷阱"><a href="#方法重写的陷阱" class="headerlink" title="方法重写的陷阱"></a>方法重写的陷阱</h3><p>无法重写父类 private 方法。如果子类有一个与父类 private 方法具有相同方法名、相同形参列表、相同返回值类型的方法，依然不是重写，只是子类定义了一个与父类相同的方法。</p>
<h3 id="static-关键字"><a href="#static-关键字" class="headerlink" title="static 关键字"></a>static 关键字</h3><p>static 可以修饰类中定义的成员：field、方法、内部类、初始化代码块、内部枚举类</p>
<h4 id="静态方法属于类"><a href="#静态方法属于类" class="headerlink" title="静态方法属于类"></a>静态方法属于类</h4><p>被 static 修饰的成员（field、方法、内部类、初始化块、内部枚举类）属于类本身，而不是单个的 Java 对象。静态方法也是属于类。</p>
<h2 id="第-8-课-——-异常捕捉的陷阱"><a href="#第-8-课-——-异常捕捉的陷阱" class="headerlink" title="第 8 课 —— 异常捕捉的陷阱"></a>第 8 课 —— 异常捕捉的陷阱</h2><h3 id="正确关闭资源的方式"><a href="#正确关闭资源的方式" class="headerlink" title="正确关闭资源的方式"></a>正确关闭资源的方式</h3><ul>
<li>使用 finally 块来保证回收，保证关闭操作总是会被执行</li>
<li>关闭每个资源之前首先保证引用该资源的引用变量不为 null</li>
<li>为每个物理资源单独使用 try .. catch 块关闭资源，保证关闭资源时引发的异常不会影响其他资源的关闭。</li>
</ul>
<h3 id="finally-块陷阱"><a href="#finally-块陷阱" class="headerlink" title="finally 块陷阱"></a>finally 块陷阱</h3><p>finally 执行顺序，看我以前写的一篇文章<a href="http://www.54tianzhisheng.cn/2017/03/28/%E6%B7%B1%E5%BA%A6%E6%8E%A2%E7%A9%B6Java%20%E4%B8%AD%20finally%20%E8%AF%AD%E5%8F%A5%E5%9D%97/" target="_blank" rel="external">《深度探究Java 中 finally 语句块》</a>。</p>
<h3 id="catch-块用法"><a href="#catch-块用法" class="headerlink" title="catch 块用法"></a>catch 块用法</h3><p>在 try 块后使用 catch 块来捕获多个异常时，程序应该小心多个 catch 块之间的顺序：捕获父类异常的 catch 块都应该排在捕获子类异常的 catch 块之后（先处理小异常，再处理大异常），否则出现编译错误。</p>
<h3 id="继承得到的异常"><a href="#继承得到的异常" class="headerlink" title="继承得到的异常"></a>继承得到的异常</h3><p>子类重写父类方法时，不能声明抛出比父类方法类型更多、范围更大的异常。</p>
<p>二叉树性质：</p>
<ul>
<li><p>二叉树第 i 层上的节点数目至多为 2 ^(i - 1)   (i &gt;= 1)</p>
</li>
<li><p>深度为 k 的二叉树至多有 2 ^ k - 1 个节点</p>
</li>
<li><p>在任何一颗二叉树中，如果其叶子结点的数量为 n0，度为 2 的子节点数量为 n2，则 n0 = n2 + 1</p>
</li>
<li><p>具有 n 个节点的完全二叉树的深度为 log n   +  1   (log 的底为 2)</p>
</li>
<li><p>对于一棵有 n 个节点的完全二叉树的节点按层自左向右编号，则对任一编号为 i 的节点有如下性质：</p>
<p>当 i == 1 时，节点 i 是二叉树的根；若 i &gt; 1 时，则节点的父节点是 i/2</p>
<p>当 2i &lt;= n，则节点 i 有左孩子，左孩子的编号是 2i，否则，节点无左孩子，并且是叶子结点</p>
<p>若 2i + 1 &lt;= n ，则节点 i 有右孩子，右孩子的编号是 2i + 1；否则，节点无右孩子。</p>
</li>
<li><p>对于一颗 n 个节点的完全二叉树的节点按层自左向右编号，1 ~ n/2 范围的节点都是有孩子节点的非叶子结点，其余的节点全部都是叶子结点。编号为 n/2 的节点有可能只有左节点，也可能既有左节点，又有右节点。</p>
</li>
</ul>
<h3 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h3><h4 id="直接选择排序"><a href="#直接选择排序" class="headerlink" title="直接选择排序"></a>直接选择排序</h4><p>需要经过 n - 1 趟比较</p>
<p>第一趟比较：程序将记录定位在第一个数据上，拿第一个数据依次和它后面的每个数据进行比较，如果第一个数据大于后面某个数据，交换它们。。依此类推，经过第一趟比较，这组数据中最小的数据被选出来，它被排在第一位。</p>
<p>第二趟比较：程序将记录定位在第二个数据上，拿第二个数据依次和它后面每个数据进行比较，如果第二个数据大于后面某个数据，交换它们。。依次类推，经过第二趟比较，这组数据中第二小的数据被选出，它排在第二位</p>
<p>。。</p>
<p>按此规则一共进行 n-1 趟比较，这组数据中第 n - 1小（第二大）的数据被选出，被排在第 n -1 位（倒数第一位）；剩下的就是最大的数据，它排在最后。</p>
<p>直接选择排序的优点就是算法简单，容易实现，缺点就是每趟只能确定一个元素，n个数组需要进行 n-1 趟比较。</p>
<h4 id="堆排序"><a href="#堆排序" class="headerlink" title="堆排序"></a>堆排序</h4><ul>
<li>建堆</li>
<li>拿堆的根节点和最后一个节点交换</li>
</ul>
<h3 id="交换排序"><a href="#交换排序" class="headerlink" title="交换排序"></a>交换排序</h3><h4 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h4><p>第一趟：依次比较0和1，1和2，2和3 … n-2 和 n - 1 索引的元素，如果发现第一个数据大于后一个数据，交换它们，经过第一趟，最大的元素排到了最后。</p>
<p>第二趟：依次比较0和1，1和2，2和3 … n-3 和 n - 2 索引的元素，如果发现第一个数据大于后一个数据，交换它们，经过第二趟，第二大的元素排到了倒数第二位</p>
<p>。。</p>
<p>第 n -1 趟：依次比较0和1元素，如果发现第一个数据大于后一个数据，交换它们，经过第 n - 1 趟，第二小的元素排到了第二位。</p>
<h4 id="快速排序"><a href="#快速排序" class="headerlink" title="快速排序"></a>快速排序</h4><p>从待排的数据序列中任取一个数据作为分界值，所有比它小的数据元素一律放在左边，所有比他大的元素一律放在右边，这样一趟下来，该序列就分成了两个子序列，接下来对两个子序列进行递归，直到每个子序列只剩一个，排序完成。</p>
<h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><h4 id="直接插入排序"><a href="#直接插入排序" class="headerlink" title="直接插入排序"></a>直接插入排序</h4><p>依次将待排序的数据元素按其关键字值的大小插入前面的有序序列。</p>
<h4 id="折半插入排序"><a href="#折半插入排序" class="headerlink" title="折半插入排序"></a>折半插入排序</h4><p>当第 i - 1 趟需要将第 i 个元素插入前面的 0 ~ i -1 个元素序列中时：</p>
<ul>
<li>计算 0 ~ i - 1 索引的中间点，也就是用 i 索引处的元素和 （0 + i - 1）/2 索引处的元素进行比较，如果 i 索引处的元素大，就直接在 （（0 + i - 1）/2 ） ~ （i - 1）后半个范围内进行搜索，反之在前半个范围搜索。</li>
<li>重复上面步骤</li>
<li>确定第 i 个元素的插入位置，就将该位置的后面所有元素整体后移一位，然后将第 i 个元素放入该位置。</li>
</ul>
]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;第-1-课-——-数组与内存控制&quot;&gt;&lt;a href=&quot;#第-1-课-——-数组与内存控制&quot; class=&quot;headerlink&quot; title=&quot;第 1 课 —— 数组与内存控制&quot;&gt;&lt;/a&gt;第 1 课 —— 数组与内存控制&lt;/h2&gt;&lt;h3 id=&quot;数组初始化&quot;&gt;&lt;a href=&quot;#数组初始化&quot; class=&quot;headerlink&quot; title=&quot;数组初始化&quot;&gt;&lt;/a&gt;数组初始化&lt;/h3&gt;&lt;p&gt;数组初始化之后，该数组的长度是不可变的（可通过数组的 length 属性访问数组的长度）。Java 中的数组必须经过初始化（为数组对象的元素分配内存空间，并为每个数组元素指定初始值）才可使用。&lt;/p&gt;
&lt;p&gt;数组初始化的形式：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;静态初始化：初始化时由程序员显示的指定每个数组的初始值，系统决定数组长度。&lt;/li&gt;
&lt;li&gt;动态初始化：初始化时程序员只指定数组的长度，系统为数组元素分配初始值。&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>源码大招：不服来战！撸这些完整项目，你不牛逼都难！</title>
    <link href="http://yoursite.com/2017/05/13/android-projects/"/>
    <id>http://yoursite.com/2017/05/13/android-projects/</id>
    <published>2017-05-13T10:04:51.795Z</published>
    <updated>2017-06-13T10:41:04.937Z</updated>
    
    <content type="html"><![CDATA[<p>经常有人问我有没有什么项目代码，我回复说去 Github 找，但是还是好多人不知道如何找到那些比较好的项目。</p>
<p>今天花了点时间找了些安卓的项目，觉得还是不错的，几乎就是自己生活常用的一些 app ，如果你是一个 Android 开发者，我觉得撸完这些项目，你想不牛逼都难。</p>
<h3 id="菜鸟新闻"><a href="#菜鸟新闻" class="headerlink" title="菜鸟新闻"></a>菜鸟新闻</h3><p><a href="http://www.cniao5.com/" target="_blank" rel="external">菜鸟新闻</a> 客户端是一个仿照36Kr官方,实 时抓取36Kr官网数据的资讯类新闻客户端。</p>
<p>包括首页新闻,详情,发现,活动,实时数据抓取,侧滑效果,第三方登录以及分享,消息推送等相关功能客户端。<br><a id="more"></a></p>
<p>课程地址： <a href="http://www.cniao5.com/clazz/view/10076.html" target="_blank" rel="external">http://www.cniao5.com/clazz/view/10076.html</a><br>视频下载链接： <a href="http://pan.baidu.com/s/1eQLyQxc" target="_blank" rel="external">http://pan.baidu.com/s/1eQLyQxc</a> 密码：3ts1 </p>
<p>项目源码下载地址：<a href="https://github.com/yxs666/cniao5-news" target="_blank" rel="external">https://github.com/yxs666/cniao5-news</a></p>
<p><strong>运行截图:</strong></p>
<p><img src="https://github.com/yxs666/cniao5-news/raw/master/screenshot/cniaonews.gif" alt=""></p>
<p><img src="https://github.com/yxs666/cniao5-news/raw/master/screenshot/pull_4%20(2" alt="">.gif)</p>
<p><img src="https://github.com/yxs666/cniao5-news/raw/master/screenshot/Screenshot_2015-12-07-12-36-11.png" alt=""></p>
<p><img src="https://github.com/yxs666/cniao5-news/raw/master/screenshot/Screenshot_2015-12-07-12-35-53.png" alt=""></p>
<p><img src="https://github.com/yxs666/cniao5-news/raw/master/screenshot/Screenshot_2015-12-07-12-38-19.png" alt=""></p>
<h3 id="KuaiChuan"><a href="#KuaiChuan" class="headerlink" title="KuaiChuan"></a>KuaiChuan</h3><p>仿茄子快传的一款文件传输应用， 涉及到Socket通信，包括TCP，UDP通信</p>
<p>项目源码：<a href="https://github.com/mayubao/KuaiChuan" target="_blank" rel="external">https://github.com/mayubao/KuaiChuan</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/mayubao/KuaiChuan/raw/master/ScreenShot/home.gif" alt=""></p>
<p><img src="https://github.com/mayubao/KuaiChuan/raw/master/ScreenShot/fs_1.gif" alt=""></p>
<p><img src="https://github.com/mayubao/KuaiChuan/raw/master/ScreenShot/fs_3.gif" alt=""></p>
<p><img src="https://github.com/mayubao/KuaiChuan/raw/master/ScreenShot/fr_1.gif" alt=""></p>
<h3 id="CoolShopping"><a href="#CoolShopping" class="headerlink" title="CoolShopping"></a>CoolShopping</h3><p>一个仿拉手团购的购物App，采用Bmob后台实现短信验证码注册、登录、收藏、订单管理、自动更新等功能，数据抓取自拉手团购</p>
<p>项目地址：<a href="https://github.com/myxh/CoolShopping" target="_blank" rel="external">https://github.com/myxh/CoolShopping</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/myxh/CoolShopping/raw/master/ScreenCapture/0.png" alt=""></p>
<p><img src="https://github.com/myxh/CoolShopping/raw/master/ScreenCapture/6.png" alt=""></p>
<p><img src="https://github.com/myxh/CoolShopping/raw/master/ScreenCapture/22.png" alt=""></p>
<h3 id="RNPolymerPo"><a href="#RNPolymerPo" class="headerlink" title="RNPolymerPo"></a>RNPolymerPo</h3><p>RNPolymerPo 是一个基于 <a href="https://github.com/facebook/react-native" target="_blank" rel="external">React Native</a> 的生活类聚合实战项目，目前由于没有 MAC 设备，所以没有适配 iOS，感兴趣的可以自行适配 app 目录下相关 JS 代码即可。</p>
<p>项目地址：<a href="https://github.com/yanbober/RNPolymerPo" target="_blank" rel="external">https://github.com/yanbober/RNPolymerPo</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/yanbober/RNPolymerPo/raw/master/doc/home_page.png" alt=""></p>
<p><img src="https://github.com/yanbober/RNPolymerPo/raw/master/doc/weixin_page.png" alt=""></p>
<p><img src="https://github.com/yanbober/RNPolymerPo/raw/master/doc/online_news_page.png" alt=""></p>
<p><img src="https://github.com/yanbober/RNPolymerPo/raw/master/doc/chart_page.png" alt=""></p>
<h3 id="bilibili"><a href="#bilibili" class="headerlink" title="bilibili"></a>bilibili</h3><p>仿 bilibili 的客户端</p>
<p>项目地址：<a href="https://github.com/HotBitmapGG/bilibili-android-client" target="_blank" rel="external">https://github.com/HotBitmapGG/bilibili-android-client</a></p>
<p>运行截图：</p>
<p> <img src="https://github.com/HotBitmapGG/bilibili-android-client/raw/master-x/art/01.png" alt=""></p>
<p><img src="https://github.com/HotBitmapGG/bilibili-android-client/raw/master-x/art/07.png" alt=""></p>
<p><img src="https://github.com/HotBitmapGG/bilibili-android-client/raw/master-x/art/004.png" alt=""></p>
<h3 id="StockChart"><a href="#StockChart" class="headerlink" title="StockChart"></a>StockChart</h3><p>采用主流<code>rxjava</code>+<code>retrofit</code>+<code>dagger2</code>框架，StockChart看股票的分时图，k线图。</p>
<p>项目地址：<a href="https://github.com/AndroidJiang/StockChart" target="_blank" rel="external">https://github.com/AndroidJiang/StockChart</a></p>
<h3 id="Android精准计步器"><a href="#Android精准计步器" class="headerlink" title="Android精准计步器"></a>Android精准计步器</h3><p>项目地址：<a href="https://github.com/linglongxin24/DylanStepCount" target="_blank" rel="external">https://github.com/linglongxin24/DylanStepCount</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/linglongxin24/DylanStepCount/raw/master/screenshots/%E4%B8%BB%E9%A1%B5.jpg" alt=""></p>
<p><img src="https://github.com/linglongxin24/DylanStepCount/raw/master/screenshots/%E9%94%BB%E7%82%BC%E8%AE%A1%E5%88%92.jpg" alt=""></p>
<p><img src="https://github.com/linglongxin24/DylanStepCount/raw/master/screenshots/%E5%8E%86%E5%8F%B2%E8%AE%B0%E5%BD%95.jpg" alt=""></p>
<h3 id="菜鸟微博"><a href="#菜鸟微博" class="headerlink" title="菜鸟微博"></a>菜鸟微博</h3><p><a href="http://www.cniao5.com/" target="_blank" rel="external"><strong>菜鸟微博</strong></a>《通过对新浪微博开发案例的详细解析，讲解了一个完整的 Android 实际项目的开发过程。</p>
<p>有新浪微博的主要功能，有Toolbar,RecyclerView等最新控件的用法；各种快速开发框架的使用，比如 Glide,PhotoView ，EventBus ，OKHttp，pullToRefresh等。 学习视频+源码 视频中还会讲到MVP设计模式以及一些架构师的入门知识。</p>
<p>课程地址： <a href="http://www.cniao5.com/clazz/view/10075.html" target="_blank" rel="external">http://www.cniao5.com/clazz/view/10075.html</a><br>视频下载链接： <a href="http://pan.baidu.com/s/1gexq3VP" target="_blank" rel="external">http://pan.baidu.com/s/1gexq3VP</a> 密码：f0t9</p>
<p>项目地址：<a href="https://github.com/yxs666/cniao5-weibo" target="_blank" rel="external">https://github.com/yxs666/cniao5-weibo</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/yxs666/cniao5-weibo/raw/master/screenshot/10.jpg" alt=""></p>
<p><img src="https://github.com/yxs666/cniao5-weibo/raw/master/screenshot/5.jpg" alt=""></p>
<p><img src="https://github.com/yxs666/cniao5-weibo/raw/master/screenshot/6.jpg" alt=""></p>
<h3 id="在线云打印平台"><a href="#在线云打印平台" class="headerlink" title="在线云打印平台"></a>在线云打印平台</h3><p>一个在线云打印平台（android部分）含订单管理、百度地图、二维码等等</p>
<p>项目地址：<a href="https://github.com/LehmanHe/A4print" target="_blank" rel="external">https://github.com/LehmanHe/A4print</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/LehmanHe/A4print/raw/master/picture/1.png" alt=""></p>
<p><img src="https://github.com/LehmanHe/A4print/raw/master/picture/a1.png" alt=""></p>
<p><img src="https://github.com/LehmanHe/A4print/raw/master/picture/a2.png" alt=""></p>
<p><img src="https://github.com/LehmanHe/A4print/raw/master/picture/a4.png" alt=""></p>
<p><img src="https://github.com/LehmanHe/A4print/raw/master/picture/a5.png" alt=""></p>
<p><img src="https://github.com/LehmanHe/A4print/raw/master/picture/6.png" alt=""></p>
<h3 id="铜板街"><a href="#铜板街" class="headerlink" title="铜板街"></a>铜板街</h3><p>项目地址：<a href="https://github.com/robotlife/TongBanJie" target="_blank" rel="external">https://github.com/robotlife/TongBanJie</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/robotlife/tongbanjie_picture/raw/master/%E5%BC%95%E5%AF%BC%E9%A1%B5.png" alt=""></p>
<p><img src="https://github.com/robotlife/tongbanjie_picture/raw/master/%E9%A6%96%E9%A1%B5.png" alt=""></p>
<p><img src="https://github.com/robotlife/tongbanjie_picture/raw/master/%E6%8A%95%E8%B5%84.png" alt=""></p>
<p><img src="https://github.com/robotlife/tongbanjie_picture/raw/master/%E8%B4%A2%E5%AF%8C2.png" alt=""></p>
<p><img src="https://github.com/robotlife/tongbanjie_picture/raw/master/%E4%BF%AE%E6%94%B9%E4%BA%A4%E6%98%93%E5%AF%86%E7%A0%81.png" alt=""></p>
<p><img src="https://github.com/robotlife/tongbanjie_picture/raw/master/%E6%96%B0%E6%89%8B%E6%A0%87.png" alt=""></p>
<h3 id="礼物说"><a href="#礼物说" class="headerlink" title="礼物说"></a>礼物说</h3><p>项目地址：<a href="https://github.com/Orangelittle/Liwusuo" target="_blank" rel="external">https://github.com/Orangelittle/Liwusuo</a></p>
<h3 id="IotXmpp"><a href="#IotXmpp" class="headerlink" title="IotXmpp"></a>IotXmpp</h3><p>本项目是基于XMPP的物联网客户端软件的实现，其实现的主要功能是一款能和物联网节点交互的即时通讯软件。目前支持九类传感器节点交互，主要有：温湿度、风扇、直流电机、LED灯、步进电机、门磁、光电接近、烟雾和光照。<br>本软件不仅能和这些传感器节点交互，还实现了类似微信的订阅和取消订阅功能。当订阅一个节点后节点就会按照设定好的周期向客户端汇报数据，客户端也能设置周期、设置报警上下限等。这些功能的实现极大的方便了我们和物联网节点的交互。</p>
<p>项目地址：<a href="https://github.com/tiandawu/IotXmpp" target="_blank" rel="external">https://github.com/tiandawu/IotXmpp</a></p>
<p>项目截图：</p>
<p><img src="https://camo.githubusercontent.com/6b26b624ce2cd266f826a7ddcbefbd555c9a737a/687474703a2f2f692e696d6775722e636f6d2f71414a676a62552e706e67" alt=""></p>
<p><img src="https://camo.githubusercontent.com/7c5da3833d49c5a6be574e705413e7eb99775578/687474703a2f2f692e696d6775722e636f6d2f6a5457757751582e706e67" alt=""></p>
<p><img src="https://camo.githubusercontent.com/8d865718d786c481b8ac962a97b88ed615a58ee9/687474703a2f2f692e696d6775722e636f6d2f575a6f373471472e706e67" alt=""></p>
<h3 id="Lives"><a href="#Lives" class="headerlink" title="Lives"></a>Lives</h3><p>生活娱乐结合的APP, 现有主要功能： 图书 翻译 音乐 视频</p>
<p>项目地址：<a href="https://github.com/Allyns/Lives" target="_blank" rel="external">https://github.com/Allyns/Lives</a></p>
<p>项目截图：</p>
<p><img src="https://github.com/Allyns/Lives/raw/master/img/54F171BC28ED5C6A4AEC296B3FCF19E1.png" alt=""></p>
<p><img src="https://github.com/Allyns/Lives/raw/master/img/7505C39DFA9E3C54B6272A749CDA5125.png" alt=""></p>
<p><img src="https://github.com/Allyns/Lives/raw/master/img/C7075614E4A7DD3AD34F62426A557E9B.png" alt=""></p>
<h3 id="CoCoin"><a href="#CoCoin" class="headerlink" title="CoCoin"></a>CoCoin</h3><p>一款多视图记账APP</p>
<p>项目地址：<a href="https://github.com/Nightonke/CoCoin" target="_blank" rel="external">https://github.com/Nightonke/CoCoin</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/Nightonke/CoCoin/raw/master/PNG/CoCoin_Basic.png" alt=""></p>
<p><img src="https://github.com/Nightonke/CoCoin/raw/master/PNG/CoCoin_Today.png" alt=""></p>
<p><img src="https://github.com/Nightonke/CoCoin/raw/master/PNG/CoCoin_Custom.png" alt=""></p>
<p><img src="https://github.com/Nightonke/CoCoin/raw/master/PNG/CoCoin_Tag.png" alt=""></p>
<p><img src="https://github.com/Nightonke/CoCoin/raw/master/PNG/CoCoin_Month.png" alt=""></p>
<p><img src="https://github.com/Nightonke/CoCoin/raw/master/PNG/CoCoin_List.png" alt=""></p>
<p><img src="https://github.com/Nightonke/CoCoin/raw/master/PNG/CoCoin_Report.png" alt=""></p>
<h3 id="AppLock"><a href="#AppLock" class="headerlink" title="AppLock"></a>AppLock</h3><p>AppLock应用锁，保护你的隐私</p>
<p>项目地址：<a href="https://github.com/lizixian18/AppLock" target="_blank" rel="external">https://github.com/lizixian18/AppLock</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/lizixian18/AppLock/raw/master/art/1.png" alt=""></p>
<p><img src="https://github.com/lizixian18/AppLock/raw/master/art/2.png" alt=""></p>
<p><img src="https://github.com/lizixian18/AppLock/raw/master/art/4.png" alt=""></p>
<p><img src="https://github.com/lizixian18/AppLock/raw/master/art/10.png" alt=""></p>
<h3 id="jianshi-简诗"><a href="#jianshi-简诗" class="headerlink" title="jianshi 简诗"></a>jianshi 简诗</h3><p>一款优雅的中国风Android App，包括Android端和Server端，支持登录注册，数据云端同步，离线数据存储和截屏分享等功能。</p>
<p>项目地址：</p>
<p>运行截图：</p>
<p><img src="https://github.com/wingjay/jianshi/raw/master/material/screenshots/with_phone/1.PNG" alt=""></p>
<p><img src="https://github.com/wingjay/jianshi/raw/master/material/screenshots/with_phone/2.PNG" alt=""></p>
<p><img src="https://github.com/wingjay/jianshi/raw/master/material/screenshots/with_phone/7.PNG" alt=""></p>
<h3 id="storage-chooser"><a href="#storage-chooser" class="headerlink" title="storage-chooser"></a>storage-chooser</h3><p>一款文件管理器app</p>
<p>项目地址：<a href="https://github.com/codekidX/storage-chooser" target="_blank" rel="external">https://github.com/codekidX/storage-chooser</a></p>
<p>运行截图：</p>
<p><img src="https://camo.githubusercontent.com/6f690f12cf8f8cbf9a1e400fe73a4a3fbc075872/687474703a2f2f692e696d6775722e636f6d2f6e6d71504a6f6b2e676966" alt=""></p>
<h3 id="LQRWeChat"><a href="#LQRWeChat" class="headerlink" title="LQRWeChat"></a><strong>LQRWeChat</strong></h3><p>仿最新版微信6.5.7（除图片选择器外）。本项目基于融云SDK，使用目前较火的 Rxjava+Retrofit+MVP+Glide 技术开发。相比上个版本，加入发送位置消息，红包消息等功能。</p>
<p>项目地址：<a href="https://github.com/GitLqr/LQRWeChat" target="_blank" rel="external">https://github.com/GitLqr/LQRWeChat</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/1.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/3.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/4.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/5.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/6.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/7.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/8.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/9.gif" alt=""></p>
<p><img src="https://github.com/GitLqr/LQRWeChat/raw/master/screenshots/13.gif" alt=""></p>
<h3 id="PonyExpress-小马快递"><a href="#PonyExpress-小马快递" class="headerlink" title="PonyExpress  小马快递"></a>PonyExpress  小马快递</h3><p>小马快递，您的好帮手。查询并跟踪快递，快递信息及时掌握。支持全国100多家快递公司，支持扫码查询，智能识别快递公司。附带生成二维码小工具，方便实用。体积小巧，无广告，无多余权限。</p>
<p>项目地址：<a href="https://github.com/wangchenyan/PonyExpress" target="_blank" rel="external">https://github.com/wangchenyan/PonyExpress</a></p>
<p>运行截图：</p>
<p><img src="https://raw.githubusercontent.com/wangchenyan/PonyExpress/master/art/screenshot_01.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wangchenyan/PonyExpress/master/art/screenshot_02.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wangchenyan/PonyExpress/master/art/screenshot_04.jpg" alt=""></p>
<p><img src="https://raw.githubusercontent.com/wangchenyan/PonyExpress/master/art/screenshot_05.jpg" alt=""></p>
<h3 id="CloudReader-云阅"><a href="#CloudReader-云阅" class="headerlink" title="CloudReader  云阅"></a><strong>CloudReader</strong>  云阅</h3><p>一款基于网易云音乐UI，使用Gank.Io及豆瓣api开发的符合Google Material Design的Android客户端。项目采取的是MVVM-DataBinding架构开发，现主要包括：干货区、电影区和书籍区三个子模块。DIY网易云音乐原来是如此Cool</p>
<p>项目地址：<a href="https://github.com/youlookwhat/CloudReader" target="_blank" rel="external">https://github.com/youlookwhat/CloudReader</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/youlookwhat/CloudReader/raw/master/file/cloudreader.gif" alt=""></p>
<p><img src="https://github.com/youlookwhat/CloudReader/raw/master/file/page_gank_00.png" alt=""></p>
<p><img src="https://github.com/youlookwhat/CloudReader/raw/master/file/page_movie_01.png" alt=""></p>
<p><img src="https://github.com/youlookwhat/CloudReader/raw/master/file/page_movie_03.png" alt=""></p>
<p><img src="https://github.com/youlookwhat/CloudReader/raw/master/file/page_menu_01.png" alt=""></p>
<h3 id="硅谷商城"><a href="#硅谷商城" class="headerlink" title="硅谷商城"></a>硅谷商城</h3><p>是一款按照企业级标准研发的项目。本套代码是目前国内市场第一套详细讲解商城类项目的免费代码。该代码中的内容包括但不仅限于，框架的搭建 、主页模块、分类模块、发现模块、购物车模块和个人中心模块。项目中讲解的主流技术包括且不限于RadioGroup + Fragment、OKHttp、FastJson、RecyclerView、 ScrollViewContainer、Banner、倒计时秒杀、自定义购物车、支付宝等技术。该项目中讲解的技术可应用在电商、新闻、旅游、医疗、在线教育等领域。</p>
<p>项目地址：<a href="https://github.com/atguigu01/Shopping" target="_blank" rel="external">https://github.com/atguigu01/Shopping</a></p>
<p>运行截图：</p>
<p><img src="https://github.com/atguigu01/Shopping/raw/master/gif/%E7%A1%85%E8%B0%B7%E5%95%86%E5%9F%8E%E6%95%88%E6%9E%9C%E6%BC%94%E7%A4%BA.gif" alt=""></p>
<hr>
<p>觉得棒的，欢迎点赞和转发分享，谢谢大家！转载的话注明来源地址为 <a href="www.54tianzhisheng.cn/2017/05/13/android-projects/">www.54tianzhisheng.cn/2017/05/13/android-projects/</a> 即可。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;经常有人问我有没有什么项目代码，我回复说去 Github 找，但是还是好多人不知道如何找到那些比较好的项目。&lt;/p&gt;
&lt;p&gt;今天花了点时间找了些安卓的项目，觉得还是不错的，几乎就是自己生活常用的一些 app ，如果你是一个 Android 开发者，我觉得撸完这些项目，你想不牛逼都难。&lt;/p&gt;
&lt;h3 id=&quot;菜鸟新闻&quot;&gt;&lt;a href=&quot;#菜鸟新闻&quot; class=&quot;headerlink&quot; title=&quot;菜鸟新闻&quot;&gt;&lt;/a&gt;菜鸟新闻&lt;/h3&gt;&lt;p&gt;&lt;a href=&quot;http://www.cniao5.com/&quot;&gt;菜鸟新闻&lt;/a&gt; 客户端是一个仿照36Kr官方,实 时抓取36Kr官网数据的资讯类新闻客户端。&lt;/p&gt;
&lt;p&gt;包括首页新闻,详情,发现,活动,实时数据抓取,侧滑效果,第三方登录以及分享,消息推送等相关功能客户端。&lt;br&gt;
    
    </summary>
    
    
      <category term="Android" scheme="http://yoursite.com/tags/Android/"/>
    
  </entry>
  
  <entry>
    <title>最近很火的鸡汤，分享给大家</title>
    <link href="http://yoursite.com/2017/05/11/poetry/"/>
    <id>http://yoursite.com/2017/05/11/poetry/</id>
    <published>2017-05-11T12:33:20.123Z</published>
    <updated>2017-05-12T11:37:20.409Z</updated>
    
    <content type="html"><![CDATA[<h4 id="lt-最近很火的一首小诗，分享给大家-gt"><a href="#lt-最近很火的一首小诗，分享给大家-gt" class="headerlink" title="&lt;最近很火的一首小诗，分享给大家&gt;"></a>&lt;最近很火的一首小诗，分享给大家&gt;</h4><p><img src="http://ohfk1r827.bkt.clouddn.com/owl-2287017_960_720.jpg" alt=""><br><a id="more"></a></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=415792881&auto=1&height=66"></iframe>

<p>纽约时间比加州时间早三个小时，</p>
<p> New York is 3 hours ahead of California,</p>
<p> 但加州时间并没有变慢。</p>
<p> but it does not make California slow.</p>
<p> 有人22岁就毕业了，</p>
<p> Someone graduated at the age of 22,</p>
<p> 但等了五年才找到好的工作！</p>
<p> but waited 5 years before securing a good job!</p>
<p> 有人25岁就当上CEO，</p>
<p> Someone became a CEO at 25,</p>
<p> 却在50岁去世。</p>
<p> and died at 50.</p>
<p> 也有人迟到50岁才当上CEO，</p>
<p> While another became a CEO at 50,</p>
<p> 然后活到90岁。</p>
<p> and lived to 90 years.</p>
<p> 有人依然单身，</p>
<p> Someone is still single,</p>
<p> 同时也有人已婚。</p>
<p> while someone else got married.</p>
<p> 奥巴马55岁就退休，</p>
<p> Obama retires at 55,</p>
<p> 川普70岁才开始当总统。</p>
<p> but Trump starts at 70.</p>
<p> 世上每个人本来就有自己的发展时区。</p>
<p> Absolutely everyone in this world works based on their Time Zone.</p>
<p> 身边有些人看似走在你前面，</p>
<p> People around you might seem to go ahead of you,</p>
<p> 也有人看似走在你后面。</p>
<p> some might seem to be behind you.</p>
<p> 但其实每个人在自己的时区有自己的步程。</p>
<p> But everyone is running their own RACE, in their own TIME.</p>
<p> 不用嫉妒或嘲笑他们。</p>
<p> Don’t envy them or mock them.</p>
<p> 他们都在自己的时区里，你也是！</p>
<p> They are in their TIME ZONE, and you are in yours!</p>
<p> 生命就是等待正确的行动时机。</p>
<p> Life is about waiting for the right moment to act.</p>
<p> 所以，放轻松。</p>
<p> So, RELAX.</p>
<p> 你没有落后。</p>
<p> You’re not LATE.</p>
<p> 你没有领先。</p>
<p> You’re not EARLY.</p>
<p> 在命运为你安排的属于自己的时区里，一切都准时。</p>
<p> You are very much ON TIME, and in your TIME ZONE Destiny set up for you.</p>
]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;lt-最近很火的一首小诗，分享给大家-gt&quot;&gt;&lt;a href=&quot;#lt-最近很火的一首小诗，分享给大家-gt&quot; class=&quot;headerlink&quot; title=&quot;&amp;lt;最近很火的一首小诗，分享给大家&amp;gt;&quot;&gt;&lt;/a&gt;&amp;lt;最近很火的一首小诗，分享给大家&amp;gt;&lt;/h4&gt;&lt;p&gt;&lt;img src=&quot;http://ohfk1r827.bkt.clouddn.com/owl-2287017_960_720.jpg&quot; alt=&quot;&quot;&gt;&lt;br&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="http://yoursite.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>从对象深入分析 Java 中实例变量和类变量的区别</title>
    <link href="http://yoursite.com/2017/05/06/java-var/"/>
    <id>http://yoursite.com/2017/05/06/java-var/</id>
    <published>2017-05-06T06:24:51.333Z</published>
    <updated>2017-06-13T10:42:32.638Z</updated>
    
    <content type="html"><![CDATA[<h3 id="实例变量-和-类变量"><a href="#实例变量-和-类变量" class="headerlink" title="实例变量 和 类变量"></a>实例变量 和 类变量</h3><h4 id="局部变量"><a href="#局部变量" class="headerlink" title="局部变量"></a>局部变量</h4><p>特点：作用时间短，存储在方法的栈内存中</p>
<p>种类：</p>
<ul>
<li>形参：方法签名中定义的局部变量，由方法调用者负责为其赋值，随方法结束而消亡</li>
<li>方法内的局部变量：方法内定义的局部变量，必须在方法内对其进行显示初始化，从初始化后开始生效，随方法结束而消亡</li>
<li>代码块内的局部变量：在代码块中定义的局部变量，必须在代码块中进行显示初始化，从初始化后开始生效，随代码块结束而消亡</li>
</ul>
<a id="more"></a>
<h4 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h4><p>类体内定义的变量，如果该成员变量没有使用 static 修饰，那该成员变量又被称为非静态变量或实例变量，如果使用 static 修饰，则该成员变量又可被称为静态变量或类变量。</p>
<h4 id="实例变量和类变量的属性"><a href="#实例变量和类变量的属性" class="headerlink" title="实例变量和类变量的属性"></a>实例变量和类变量的属性</h4><p>使用 static 修饰的成员变量是类变量，属于该类本身，没有使用 static 修饰的成员变量是实例变量，属于该类的实例，在同一个类中，每一个类只对应一个 Class 对象，但每个类可以创建多个对象。</p>
<p>由于同一个 JVM 内的每个类只对应一个 CLass 对象，因此同一个 JVM 内的一个类的类变量只需要一块内存空间；但对于实例变量而言，该类每创建一次实例，就需要为该实例变量分配一块内存空间。也就是说，程序中创建了几个实例，实例变量就需要几块内存空间。</p>
<p>这里我想到一道面试题目：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span>&#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div></pre></td></tr></table></figure>
<p>静态代码块只执行一次，而代码块每创建一个实例，就会打印一次。</p>
<h4 id="实例变量的初始化时机"><a href="#实例变量的初始化时机" class="headerlink" title="实例变量的初始化时机"></a>实例变量的初始化时机</h4><p>程序可在3个地方对实例变量执行初始化：</p>
<ul>
<li>定义实例变量时指定初始值</li>
<li>非静态初始化块中对实例变量指定初始值</li>
<li>构造器中对实例变量指定初始值</li>
</ul>
<p>上面第一种和第二种方式比第三种方式更早执行，但第一、二种方式的执行顺序与他们在源程序中的排列顺序相同。</p>
<p>同样在上面那个代码上加上一个变量 weight 的成员变量，我们来验证下上面的初始化顺序：</p>
<p>1、<code>定义实例变量指定初始值</code> 在 <code>非静态初始化块对实例变量指定初始值</code> 之后:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.0</div></pre></td></tr></table></figure>
<p>2、<code>定义实例变量指定初始值</code> 在 <code>非静态初始化块对实例变量指定初始值</code> 之前:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">	<span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.1</div></pre></td></tr></table></figure>
<p>大家有没有觉得很奇怪？</p>
<p>我来好好说清楚下：</p>
<blockquote>
<p>定义实例变量时指定的初始值、初始代码块中为实例变量指定初始值的语句的地位是平等的，当经过编译器处理后，他们都将会被提取到构造器中。也就是说，这条语句 <code>double weight = 2.0;</code> 实际上会被分成如下 2 次执行：</p>
<ul>
<li><code>double weight;</code> : 创建 Java 对象时系统根据该语句为该对象分配内存。</li>
<li><code>weight = 2.1;</code> : 这条语句将会被提取到 Java 类的构造器中执行。</li>
</ul>
</blockquote>
<p>只说原理，大家肯定不怎么信，那么还有拿出源码来，这样才有信服能力的吗？是不？</p>
<p>这里我直接使用软件将代码的字节码文件反编译过来，看看里面是怎样的组成？</p>
<p>第一个代码的反编译源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二个代码反编译源码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这下子满意了吧！</p>
<p>通过反编译的源码可以看到该类定义的 weight 实例变量时不再有初始值，为 weight 指定初始值的代码也被提到了构造器中去了，但是我们也可以发现之前规则也是满足的。</p>
<p>他们的赋值语句都被合并到构造器中，在合并过程中，定义的变量语句转换得到的赋值语句，初始代码块中的语句都转换得到的赋值语句，总是位于构造器的所有语句之前，合并后，两种赋值语句的顺序也保持了它们在 Java 源代码中的顺序。</p>
<p>大致过程应该了解了吧？如果还不怎么清楚的，建议还是自己将怎个过程在自己的电脑上操作一遍，毕竟光看不练假把式。</p>
<h4 id="类变量的初始化时机"><a href="#类变量的初始化时机" class="headerlink" title="类变量的初始化时机"></a>类变量的初始化时机</h4><p>JVM 对每一个 Java 类只初始化一次，因此 Java 程序每运行一次，系统只为类变量分配一次内存空间，执行一次初始化。程序可在两个地方对类变量执行初始化：</p>
<ul>
<li>定义类变量时指定初始值</li>
<li>静态初始化代码块中对类变量指定初始值</li>
</ul>
<p>这两种方式的执行顺序与它们在源代码中的排列顺序相同。</p>
<p>还是用上面那个示例，我们在其基础上加个被 static 修饰的变量 height：</p>
<p>1、<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之后：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    <span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        height = <span class="number">10.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">        System.out.println(height);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.1</div><div class="line">10.0</div></pre></td></tr></table></figure>
<p>2、<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之前：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</div><div class="line">    <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>;</div><div class="line">    <span class="keyword">double</span> weight = <span class="number">2.0</span>;</div><div class="line">    &#123;</div><div class="line">        weight = <span class="number">2.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">static</span>&#123;</div><div class="line">        height = <span class="number">10.1</span>;</div><div class="line">        System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        A a = <span class="keyword">new</span> A();</div><div class="line">        A a1 = <span class="keyword">new</span> A();</div><div class="line">        System.out.println(a.weight);</div><div class="line">        System.out.println(height);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">我是静态代码块</div><div class="line">我是代码块</div><div class="line">我是代码块</div><div class="line">2.1</div><div class="line">10.1</div></pre></td></tr></table></figure>
<p>其运行结果正如我们预料，但是我们还是看看反编译后的代码吧！</p>
<p>第一种情况下反编译的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>D;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">    System.out.println(height);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>第二种情况下反编译的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">double</span> height = <span class="number">10.0</span>D;</div><div class="line">  <span class="keyword">double</span> weight;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span></span></div><div class="line">  &#123;</div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.0</span>D;</div><div class="line"></div><div class="line">    <span class="keyword">this</span>.weight = <span class="number">2.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">static</span></div><div class="line">  &#123;</div><div class="line">    height = <span class="number">10.1</span>D;</div><div class="line">    System.out.println(<span class="string">"我是静态代码块"</span>);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">  &#123;</div><div class="line">    A a = <span class="keyword">new</span> A();</div><div class="line">    A a1 = <span class="keyword">new</span> A();</div><div class="line">    System.out.println(a.weight);</div><div class="line">    System.out.println(height);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过反编译源码，可以看到第一种情况下(<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之后):</p>
<p>我们在 <strong>静态初始化代码块中对类变量指定初始值</strong> 已经不存在了，只有一个类变量指定的初始值 <code>static double height = 10.0D;</code> , 而在第二种情况下（<code>定义类变量时指定初始值</code> 在 <code>静态初始化代码块中对类变量指定初始值</code> 之前）和之前的源代码顺序是一样的，没啥区别。</p>
<p>上面的代码中充分的展示了类变量的两种初始化方式 ：每次运行该程序时，系统会为 A 类执行初始化，先为所有类变量分配内存空间，再按照源代码中的排列顺序执行静态初始代码块中所指定的初始值和定义类变量时所指定的初始值。</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;实例变量-和-类变量&quot;&gt;&lt;a href=&quot;#实例变量-和-类变量&quot; class=&quot;headerlink&quot; title=&quot;实例变量 和 类变量&quot;&gt;&lt;/a&gt;实例变量 和 类变量&lt;/h3&gt;&lt;h4 id=&quot;局部变量&quot;&gt;&lt;a href=&quot;#局部变量&quot; class=&quot;headerlink&quot; title=&quot;局部变量&quot;&gt;&lt;/a&gt;局部变量&lt;/h4&gt;&lt;p&gt;特点：作用时间短，存储在方法的栈内存中&lt;/p&gt;
&lt;p&gt;种类：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;形参：方法签名中定义的局部变量，由方法调用者负责为其赋值，随方法结束而消亡&lt;/li&gt;
&lt;li&gt;方法内的局部变量：方法内定义的局部变量，必须在方法内对其进行显示初始化，从初始化后开始生效，随方法结束而消亡&lt;/li&gt;
&lt;li&gt;代码块内的局部变量：在代码块中定义的局部变量，必须在代码块中进行显示初始化，从初始化后开始生效，随代码块结束而消亡&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>Java 性能调优需要格外注意的细节</title>
    <link href="http://yoursite.com/2017/04/30/Java-performance-tuning/"/>
    <id>http://yoursite.com/2017/04/30/Java-performance-tuning/</id>
    <published>2017-04-30T05:20:06.291Z</published>
    <updated>2017-06-13T10:42:10.439Z</updated>
    
    <content type="html"><![CDATA[<p>昨天写了篇文章 <a href="http://www.54tianzhisheng.cn/2017/04/29/MySQL-select-good/" target="_blank" rel="external">《MySQL 处理海量数据时的一些优化查询速度方法》</a> ，其实开发中不止数据库要优化，还有我们本身的开发代码也需要优化，这样我们开发的产品才能够得到极致的体验。也许有些人认为这些细小的地方没有啥好修改的，改与不改对运行效率没啥大的影响？首先在我们本地一个人测试下效率是不怎么明显，但是如果到发布上线后，你的用户有几百万，甚至上千万，这些用户同时访问你的网站，那么你的网站是否经得住考验呢，效率那高不高呢，如果效率不高，那么需要多出很多买服务器的经费呢，所以想想还是很有必要注意这些小的细节。今天就讲讲一些 Java 性能调优需要格外注意的一些细节。</p>
<p>代码优化的目标：</p>
<ul>
<li>减少代码的体积</li>
<li>提高代码的运行效率</li>
</ul>
<a id="more"></a>
<h3 id="代码优化细节"><a href="#代码优化细节" class="headerlink" title="代码优化细节"></a>代码优化细节</h3><p>1、尽量指定类、方法的final修饰符</p>
<p>带有final修饰符的类是不可派生的。在Java核心API中，有许多应用final的例子，例如java.lang.String，整个类都是final的。为类指定final修饰符可以让类不可以被继承，为方法指定final修饰符可以让方法不可以被重写。如果指定了一个类为final，则该类所有的方法都是final的。Java编译器会寻找机会内联所有的final方法，内联对于提升Java运行效率作用重大，具体参见Java运行期优化。 此举能够使性能平均提高50% 。</p>
<p>2、尽量重用对象</p>
<p>特别是String对象的使用，出现字符串连接时应该使用StringBuilder/StringBuffer代替。由于Java虚拟机不仅要花时间生成对象，以后可能还需要花时间对这些对象进行垃圾回收和处理，因此，生成过多的对象将会给程序的性能带来很大的影响。</p>
<p>3、尽可能使用局部变量</p>
<p>调用方法时传递的参数以及在调用中创建的临时变量都保存在栈中速度较快，其他变量，如静态变量、实例变量等，都在堆中创建，速度较慢。另外，栈中创建的变量，随着方法的运行结束，这些内容就没了，不需要额外的垃圾回收。</p>
<p>4、及时关闭流</p>
<p>Java编程过程中，进行数据库连接、I/O流操作时务必小心，在使用完毕后，及时关闭以释放资源。因为对这些大对象的操作会造成系统大的开销，稍有不慎，将会导致严重的后果。</p>
<p>5、尽量减少对变量的重复计算</p>
<p>明确一个概念，对方法的调用，即使方法中只有一句语句，也是有消耗的，包括创建栈帧、调用方法时保护现场、调用方法完毕时恢复现场等。所以例如下面的操作：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++)</div><div class="line">&#123;...&#125;</div></pre></td></tr></table></figure>
<p>建议替换为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, <span class="keyword">int</span> length = list.size(); i &lt; length; i++)</div><div class="line">&#123;...&#125;</div></pre></td></tr></table></figure>
<p>这样，在list.size()很大的时候，就减少了很多的消耗</p>
<p>6、尽量采用懒加载的策略，即在需要的时候才创建</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">String str = <span class="string">"aaa"</span>;<span class="keyword">if</span> (i == <span class="number">1</span>)</div><div class="line">&#123;</div><div class="line">   list.add(str);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>建议替换为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (i == <span class="number">1</span>)</div><div class="line">&#123;</div><div class="line">	String str = <span class="string">"aaa"</span>;</div><div class="line">	list.add(str);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>7、慎用异常</p>
<p>异常对性能不利。抛出异常首先要创建一个新的对象，Throwable接口的构造函数调用名为 fillInStackTrace() 的本地同步方法，fillInStackTrace() 方法检查堆栈，收集调用跟踪信息。只要有异常被抛出，Java虚拟机就必须调整调用堆栈，因为在处理过程中创建了一个新的对象。异常只能用于错误处理，不应该用来控制程序流程。</p>
<p>8、不要在循环中使用 try…catch…，应该把其放在最外层</p>
<p>除非不得已。如果毫无理由地这么写了，只要你的领导资深一点、有强迫症一点，八成就要骂你为什么写出这种垃圾代码来了。</p>
<p>9、如果能估计到待添加的内容长度，为底层以数组方式实现的集合、工具类指定初始长度</p>
<p>比如 ArrayList、LinkedLlist、StringBuilder、StringBuffer、HashMap、HashSet 等等，以 StringBuilder 为例：</p>
<p>（1）StringBuilder() // 默认分配16个字符的空间</p>
<p>（2）StringBuilder(int size) // 默认分配size个字符的空间</p>
<p>（3）StringBuilder(String str) // 默认分配16个字符+str.length()个字符空间</p>
<p>可以通过类（这里指的不仅仅是上面的 StringBuilder ）的来设定它的初始化容量，这样可以明显地提升性能。比如 StringBuilder 吧，length 表示当前的 StringBuilder 能保持的字符数量。因为当 StringBuilder 达到最大容量的时候，它会将自身容量增加到当前的2倍再加2，无论何时只要 StringBuilder 达到它的最大容量，它就不得不创建一个新的字符数组然后将旧的字符数组内容拷贝到新字符数组中—-这是十分耗费性能的一个操作。试想，如果能预估到字符数组中大概要存放5000个字符而不指定长度，最接近5000的2次幂是4096，每次扩容加的2不管，那么：</p>
<p>（1）在4096 的基础上，再申请8194个大小的字符数组，加起来相当于一次申请了12290个大小的字符数组，如果一开始能指定5000个大小的字符数组，就节省了一倍以上的空间；</p>
<p>（2）把原来的4096个字符拷贝到新的的字符数组中去。</p>
<p>这样，既浪费内存空间又降低代码运行效率。所以，给底层以数组实现的集合、工具类设置一个合理的初始化容量是错不了的，这会带来立竿见影的效果。但是，注意，像HashMap这种是以数组+链表实现的集合，别把初始大小和你估计的大小设置得一样，因为一个table上只连接一个对象的可能性几乎为0。初始大小建议设置为2的N次幂，如果能估计到有2000个元素，设置成 new HashMap(128)、new HashMap(256) 都可以。</p>
<p>10、当复制大量数据时，使用 System.arraycopy() 命令</p>
<p>11、乘法和除法使用移位操作</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (val = <span class="number">0</span>; val &lt; <span class="number">100000</span>; val += <span class="number">5</span>)</div><div class="line">&#123;</div><div class="line">	a = val * <span class="number">8</span>;</div><div class="line">	b = val / <span class="number">2</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>用移位操作可以极大地提高性能，因为在计算机底层，对位的操作是最方便、最快的，因此建议修改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (val = <span class="number">0</span>; val &lt; <span class="number">100000</span>; val += <span class="number">5</span>)</div><div class="line">&#123;</div><div class="line">	a = val &lt;&lt; <span class="number">3</span>;</div><div class="line">	b = val &gt;&gt; <span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>移位操作虽然快，但是可能会使代码不太好理解，因此最好加上相应的注释。</p>
<p>12、循环内不要不断创建对象引用</p>
<p>例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= count; i++)</div><div class="line">&#123;</div><div class="line">  Object obj = <span class="keyword">new</span> Object();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这种做法会导致内存中有count份Object对象引用存在，count很大的话，就耗费内存了，建议为改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Object obj = <span class="keyword">null</span>;</div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= count; i++) </div><div class="line">&#123; </div><div class="line">	obj = <span class="keyword">new</span> Object(); </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样的话，内存中只有一份 Object 对象引用，每次 new Object() 的时候，Object 对象引用指向不同的Object罢了，但是内存中只有一份，这样就大大节省了内存空间了。</p>
<p>13、基于效率和类型检查的考虑，应该尽可能使用array，无法确定数组大小时才使用 ArrayList</p>
<p>14、尽量使用 HashMap、ArrayList、StringBuilder，除非线程安全需要，否则不推荐使用 Hashtable、Vector、StringBuffer，后三者由于使用同步机制而导致了性能开销</p>
<p>15、不要将数组声明为 public static final</p>
<p>因为这毫无意义，这样只是定义了引用为 static final，数组的内容还是可以随意改变的，将数组声明为 public 更是一个安全漏洞，这意味着这个数组可以被外部类所改变。</p>
<p>16、尽量在合适的场合使用单例</p>
<p>使用单例可以减轻加载的负担、缩短加载的时间、提高加载的效率，但并不是所有地方都适用于单例，简单来说，单例主要适用于以下三个方面：</p>
<p>（1）控制资源的使用，通过线程同步来控制资源的并发访问</p>
<p>（2）控制实例的产生，以达到节约资源的目的</p>
<p>（3）控制数据的共享，在不建立直接关联的条件下，让多个不相关的进程或线程之间实现通信</p>
<p>17、尽量避免随意使用静态变量</p>
<p>要知道，当某个对象被定义为static的变量所引用，那么gc通常是不会回收这个对象所占有的堆内存的，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span></div><div class="line">&#123; </div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> B b = <span class="keyword">new</span> B();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>此时静态变量b的生命周期与A类相同，如果A类不被卸载，那么引用B指向的B对象会常驻内存，直到程序终止</p>
<p>18、及时清除不再需要的会话</p>
<p>为了清除不再活动的会话，许多应用服务器都有默认的会话超时时间，一般为30分钟。当应用服务器需要保存更多的会话时，如果内存不足，那么操作系统会把部分数据转移到磁盘，应用服务器也可能根据MRU（最近最频繁使用）算法把部分不活跃的会话转储到磁盘，甚至可能抛出内存不足的异常。如果会话要被转储到磁盘，那么必须要先被序列化，在大规模集群中，对对象进行序列化的代价是很昂贵的。因此，当会话不再需要时，应当及时调用 HttpSession 的 invalidate() 方法清除会话。</p>
<p>19、实现 RandomAccess 接口的集合比如 ArrayList，应当使用最普通的 for 循环而不是 foreach 循环来遍历</p>
<p>这是JDK推荐给用户的。JDK API对于 RandomAccess 接口的解释是：实现 RandomAccess 接口用来表明其支持快速随机访问，此接口的主要目的是允许一般的算法更改其行为，从而将其应用到随机或连续访问列表时能提供良好的性能。实际经验表明，实现 RandomAccess 接口的类实例，假如是随机访问的，使用普通 for 循环效率将高于使用 foreach 循环；反过来，如果是顺序访问的，则使用 Iterator 会效率更高。可以使用类似如下的代码作判断：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (list <span class="keyword">instanceof</span> RandomAccess)</div><div class="line">&#123; </div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++)&#123;&#125;</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">	Iterator&lt;?&gt; iterator = list.iterable(); </div><div class="line">	<span class="keyword">while</span> (iterator.hasNext())</div><div class="line">	&#123;</div><div class="line">		iterator.next();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>foreach 循环的底层实现原理就是迭代器 Iterator，参见Java语法糖1：可变长度参数以及 foreach 循环原理。所以后半句”反过来，如果是顺序访问的，则使用 Iterator 会效率更高”的意思就是顺序访问的那些类实例，使用 foreach 循环去遍历。</p>
<p>20、使用同步代码块替代同步方法</p>
<p>这点在多线程模块中的 synchronized 锁方法块一文中已经讲得很清楚了，除非能确定一整个方法都是需要进行同步的，否则尽量使用同步代码块，避免对那些不需要进行同步的代码也进行了同步，影响了代码执行效率。</p>
<p>21、将常量声明为 static final，并以大写命名</p>
<p>这样在编译期间就可以把这些内容放入常量池中，避免运行期间计算生成常量的值。另外，将常量的名字以大写命名也可以方便区分出常量与变量</p>
<p>22、不要创建一些不使用的对象，不要导入一些不使用的类</p>
<p>这毫无意义，如果代码中出现”The value of the local variable i is not used”、”The import java.util is never used”，那么请删除这些无用的内容</p>
<p>23、程序运行过程中避免使用反射</p>
<p>关于，请参见反射。反射是Java提供给用户一个很强大的功能，功能强大往往意味着效率不高。不建议在程序运行过程中使用尤其是频繁使用反射机制，特别是Method的invoke方法，如果确实有必要，一种建议性的做法是将那些需要通过反射加载的类在项目启动的时候通过反射实例化出一个对象并放入内存—-用户只关心和对端交互的时候获取最快的响应速度，并不关心对端的项目启动花多久时间。</p>
<p>24、使用数据库连接池和线程池</p>
<p>这两个池都是用于重用对象的，前者可以避免频繁地打开和关闭连接，后者可以避免频繁地创建和销毁线程</p>
<p>25、使用带缓冲的输入输出流进行IO操作</p>
<p>带缓冲的输入输出流，即BufferedReader、BufferedWriter、BufferedInputStream、BufferedOutputStream，这可以极大地提升IO效率</p>
<p>26、顺序插入和随机访问比较多的场景使用ArrayList，元素删除和中间插入比较多的场景使用LinkedList这个，理解ArrayList和LinkedList的原理就知道了</p>
<p>27、不要让public方法中有太多的形参</p>
<p>public方法即对外提供的方法，如果给这些方法太多形参的话主要有两点坏处：</p>
<p>1、违反了面向对象的编程思想，Java讲求一切都是对象，太多的形参，和面向对象的编程思想并不契合</p>
<p>2、参数太多势必导致方法调用的出错概率增加</p>
<p>至于这个”太多”指的是多少个，3、4个吧。比如我们用JDBC写一个insertStudentInfo方法，有10个学生信息字段要插如Student表中，可以把这10个参数封装在一个实体类中，作为insert方法的形参。</p>
<p>28、字符串变量和字符串常量equals的时候将字符串常量写在前面</p>
<p>这是一个比较常见的小技巧了，如果有以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">String str = <span class="string">"123"</span>;</div><div class="line"><span class="keyword">if</span> (str.equals(<span class="string">"123"</span>)) &#123;...&#125;</div></pre></td></tr></table></figure>
<p>建议修改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String str = <span class="string">"123"</span>;</div><div class="line"><span class="keyword">if</span> (<span class="string">"123"</span>.equals(str))</div><div class="line">&#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这么做主要是可以避免空指针异常</p>
<p>29、请知道，在java中if (i == 1)和if (1 == i)是没有区别的，但从阅读习惯上讲，建议使用前者</p>
<p>平时有人问，”if (i == 1)”和”if (1== i)”有没有区别，这就要从C/C++讲起。</p>
<p>在C/C++中，”if (i == 1)”判断条件成立，是以0与非0为基准的，0表示false，非0表示true，如果有这么一段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> i = <span class="number">2</span>;<span class="keyword">if</span> (i == <span class="number">1</span>)</div><div class="line">&#123;</div><div class="line">...</div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>C/C++判断”i==1″不成立，所以以0表示，即false。但是如果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> i = <span class="number">2</span>;</div><div class="line"><span class="keyword">if</span> (i = <span class="number">1</span>)</div><div class="line">&#123; </div><div class="line">	... </div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">... </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>万一程序员一个不小心，把”if (i == 1)”写成”if (i = 1)”，这样就有问题了。在if之内将i赋值为1，if判断里面的内容非0，返回的就是true了，但是明明i为2，比较的值是1，应该返回的false。这种情况在C/C++的开发中是很可能发生的并且会导致一些难以理解的错误产生，所以，为了避免开发者在if语句中不正确的赋值操作，建议将if语句写为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> i = <span class="number">2</span>;</div><div class="line"><span class="keyword">if</span> (<span class="number">1</span> == i) &#123;</div><div class="line">... </div><div class="line">&#125;<span class="keyword">else</span>&#123;</div><div class="line">... </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这样，即使开发者不小心写成了”1 = i”，C/C++编译器也可以第一时间检查出来，因为我们可以对一个变量赋值i为1，但是不能对一个常量赋值1为i。</p>
<p>但是，在Java中，C/C++这种”if (i = 1)”的语法是不可能出现的，因为一旦写了这种语法，Java就会编译报错”Type mismatch: cannot convert from int to boolean”。但是，尽管Java的”if (i == 1)”和”if (1 == i)”在语义上没有任何区别，但是从阅读习惯上讲，建议使用前者会更好些。</p>
<p>30、不要对数组使用toString()方法</p>
<p>看一下对数组使用toString()打印出来的是什么：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">&#123; </div><div class="line">	<span class="keyword">int</span>[] is = <span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</div><div class="line">	System.out.println(is.toString());</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[I@18a992f</div></pre></td></tr></table></figure>
<p>本意是想打印出数组内容，却有可能因为数组引用is为空而导致空指针异常。不过虽然对数组toString()没有意义，但是对集合toString()是可以打印出集合里面的内容的，因为集合的父类AbstractCollections重写了Object的toString()方法。</p>
<p>31、不要对超出范围的基本数据类型做向下强制转型</p>
<p>这绝不会得到想要的结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">&#123; </div><div class="line">	<span class="keyword">long</span> l = <span class="number">12345678901234L</span>;<span class="keyword">int</span> i = (<span class="keyword">int</span>)l;</div><div class="line">	System.out.println(i);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们可能期望得到其中的某几位，但是结果却是：</p>
<p><code>1942892530</code></p>
<p>解释一下。Java中long是8个字节64位的，所以12345678901234在计算机中的表示应该是：</p>
<p>0000 0000 0000 0000 0000 1011 0011 1010 0111 0011 1100 1110 0010 1111 1111 0010</p>
<p>一个int型数据是4个字节32位的，从低位取出上面这串二进制数据的前32位是：</p>
<p>0111 0011 1100 1110 0010 1111 1111 0010</p>
<p>这串二进制表示为十进制1942892530，所以就是我们上面的控制台上输出的内容。从这个例子上还能顺便得到两个结论：</p>
<p>1、整型默认的数据类型是int，long l = 12345678901234L，这个数字已经超出了int的范围了，所以最后有一个L，表示这是一个long型数。顺便，浮点型的默认类型是double，所以定义float的时候要写成””float f = 3.5f”</p>
<p>2、接下来再写一句”int ii = l + i;”会报错，因为long + int是一个long，不能赋值给int</p>
<p>32、公用的集合类中不使用的数据一定要及时remove掉</p>
<p>如果一个集合类是公用的（也就是说不是方法里面的属性），那么这个集合里面的元素是不会自动释放的，因为始终有引用指向它们。所以，如果公用集合里面的某些数据不使用而不去remove掉它们，那么将会造成这个公用集合不断增大，使得系统有内存泄露的隐患。</p>
<p>33、把一个基本数据类型转为字符串，基本数据类型.toString()是最快的方式、String.valueOf(数据)次之、数据+””最慢</p>
<p>把一个基本数据类型转为一般有三种方式，我有一个Integer型数据i，可以使用i.toString()、String.valueOf(i)、i+””三种方式，三种方式的效率如何，看一个测试：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">&#123; </div><div class="line">	<span class="keyword">int</span> loopTime = <span class="number">50000</span>;</div><div class="line">	Integer i = <span class="number">0</span>; </div><div class="line">	<span class="keyword">long</span> startTime = System.currentTimeMillis(); </div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; loopTime; j++)</div><div class="line">	&#123;</div><div class="line">		String str = String.valueOf(i);</div><div class="line">	&#125;</div><div class="line">System.out.println(<span class="string">"String.valueOf()："</span> + (System.currentTimeMillis() - startTime) + <span class="string">"ms"</span>);</div><div class="line">	startTime = System.currentTimeMillis(); </div><div class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; loopTime; j++)</div><div class="line">	&#123;</div><div class="line">		String str = i.toString();</div><div class="line">	&#125;</div><div class="line">System.out.println(<span class="string">"Integer.toString()："</span> + (System.currentTimeMillis() - startTime) + <span class="string">"ms"</span>);</div><div class="line">startTime = System.currentTimeMillis(); </div><div class="line"><span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; loopTime; j++)</div><div class="line">&#123;</div><div class="line">	String str = i + <span class="string">""</span>;</div><div class="line">&#125;</div><div class="line">System.out.println(<span class="string">"i + \"\"："</span> + (System.currentTimeMillis() - startTime) + <span class="string">"ms"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">String.valueOf()：11ms Integer.toString()：5ms i + &quot;&quot;：25ms</div></pre></td></tr></table></figure>
<p>所以以后遇到把一个基本数据类型转为String的时候，优先考虑使用toString()方法。至于为什么，很简单：</p>
<p>1、String.valueOf()方法底层调用了Integer.toString()方法，但是会在调用前做空判断</p>
<p>2、Integer.toString()方法就不说了，直接调用了</p>
<p>3、i + “”底层使用了StringBuilder实现，先用append方法拼接，再用toString()方法获取字符串</p>
<p>三者对比下来，明显是2最快、1次之、3最慢</p>
<p>34、使用最有效率的方式去遍历Map</p>
<p>遍历Map的方式有很多，通常场景下我们需要的是遍历Map中的Key和Value，那么推荐使用的、效率最高的方式是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></div><div class="line">&#123;</div><div class="line">HashMap&lt;String, String&gt; hm = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</div><div class="line">hm.put(<span class="string">"111"</span>, <span class="string">"222"</span>);</div><div class="line">Set&lt;Map.Entry&lt;String, String&gt;&gt; entrySet = hm.entrySet();</div><div class="line">Iterator&lt;Map.Entry&lt;String, String&gt;&gt; iter = entrySet.iterator(); </div><div class="line"><span class="keyword">while</span> (iter.hasNext())</div><div class="line">&#123;</div><div class="line">Map.Entry&lt;String, String&gt; entry = iter.next();</div><div class="line">System.out.println(entry.getKey() + <span class="string">"\t"</span> + entry.getValue());</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果你只是想遍历一下这个Map的key值，那用”Set keySet = hm.keySet();”会比较合适一些</p>
<p>35、对资源的close()建议分开操作</p>
<p>意思是，比如我有这么一段代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>&#123;</div><div class="line">XXX.close();</div><div class="line">YYY.close();</div><div class="line">&#125;<span class="keyword">catch</span> (Exception e)</div><div class="line">&#123;...&#125;</div></pre></td></tr></table></figure>
<p>建议修改为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">try</span>&#123; </div><div class="line">  XXX.close(); </div><div class="line">&#125;<span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">  ... </div><div class="line">&#125;<span class="keyword">try</span>&#123; </div><div class="line">  YYY.close(); </div><div class="line">&#125;<span class="keyword">catch</span> (Exception e) &#123; </div><div class="line">  ... </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>虽然有些麻烦，却能避免资源泄露。我想，如果没有修改过的代码，万一XXX.close()抛异常了，那么就进入了cath块中了，YYY.close()不会执行，YYY这块资源就不会回收了，一直占用着，这样的代码一多，是可能引起资源句柄泄露的。而改为上面的写法之后，就保证了无论如何XXX和YYY都会被close掉。</p>
<p>以上就是 Java 开发编程注意细节的全部内容了，感谢大家的阅读！</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;昨天写了篇文章 &lt;a href=&quot;http://www.54tianzhisheng.cn/2017/04/29/MySQL-select-good/&quot;&gt;《MySQL 处理海量数据时的一些优化查询速度方法》&lt;/a&gt; ，其实开发中不止数据库要优化，还有我们本身的开发代码也需要优化，这样我们开发的产品才能够得到极致的体验。也许有些人认为这些细小的地方没有啥好修改的，改与不改对运行效率没啥大的影响？首先在我们本地一个人测试下效率是不怎么明显，但是如果到发布上线后，你的用户有几百万，甚至上千万，这些用户同时访问你的网站，那么你的网站是否经得住考验呢，效率那高不高呢，如果效率不高，那么需要多出很多买服务器的经费呢，所以想想还是很有必要注意这些小的细节。今天就讲讲一些 Java 性能调优需要格外注意的一些细节。&lt;/p&gt;
&lt;p&gt;代码优化的目标：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;减少代码的体积&lt;/li&gt;
&lt;li&gt;提高代码的运行效率&lt;/li&gt;
&lt;/ul&gt;
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/tags/Java/"/>
    
  </entry>
  
  <entry>
    <title>MySQL 处理海量数据时的一些优化查询速度方法</title>
    <link href="http://yoursite.com/2017/04/29/MySQL-select-good/"/>
    <id>http://yoursite.com/2017/04/29/MySQL-select-good/</id>
    <published>2017-04-29T10:05:54.287Z</published>
    <updated>2017-06-13T10:43:18.759Z</updated>
    
    <content type="html"><![CDATA[<p>在参与实际项目中，当 MySQL 表的数据量达到百万级时，普通的 SQL 查询效率呈直线下降，而且如果 where 中的查询条件较多时，其查询速度无法容忍。想想可知，假如我们查询淘宝的一个订单详情，如果查询时间高达几十秒，这么高的查询延时，任何用户都会抓狂。因此如何提高 SQL 语句查询效率，显得十分重要。<br><a id="more"></a></p>
<h3 id="查询速度慢的原因"><a href="#查询速度慢的原因" class="headerlink" title="查询速度慢的原因"></a>查询速度慢的原因</h3><p>1、没有索引或者没有用到索引（这是查询慢最常见的问题，是程序设计的缺陷）</p>
<p>2、I/O 吞吐量小，形成了瓶颈效应。</p>
<p>3、没有创建计算列导致查询不优化。</p>
<p>4、内存不足</p>
<p>5、网络速度慢</p>
<p>6、查询出的数据量过大（可采用多次查询，其他的方法降低数据量）</p>
<p>7、锁或者死锁（这是查询慢最常见的问题，是程序设计的缺陷）</p>
<p>8、sp_lock,sp_who,活动的用户查看,原因是读写竞争资源。</p>
<p>9、返回了不必要的行和列  </p>
<p>10、查询语句不好，没有优化  </p>
<hr>
<h3 id="30-种-SQL-查询语句的优化方法："><a href="#30-种-SQL-查询语句的优化方法：" class="headerlink" title="30 种 SQL 查询语句的优化方法："></a>30 种 SQL 查询语句的优化方法：</h3><p>1、应尽量避免在 where 子句中使用 != 或者 &lt;&gt; 操作符，否则将引擎放弃使用索引而进行全表扫描。</p>
<p>2、应尽量避免在 where 子句中对字段进行 null 值判断，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">is</span> <span class="literal">null</span>;</div></pre></td></tr></table></figure>
<p>可以在 num 上设置默认值 0 ，确保表中 num 列没有 null 值，然后这样查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> = <span class="number">0</span>;</div></pre></td></tr></table></figure>
<p>3、对查询进行优化，应尽量避免全表扫描，首先应考虑在 where 及 order by 涉及的列上建立索引。</p>
<p>4、尽量避免在 where 子句中使用 or 来连接条件，否则将导致引擎放弃使用索引而进行全表扫描，如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> = <span class="number">10</span> <span class="keyword">or</span> <span class="keyword">num</span> = <span class="number">20</span>;</div></pre></td></tr></table></figure>
<p>可以这样查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> = <span class="number">10</span></div><div class="line"><span class="keyword">union</span> all</div><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> = <span class="number">20</span>;</div></pre></td></tr></table></figure>
<p>5、下面的查询也将导致全表扫描：（不能前置百分号）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> <span class="string">'%abc%'</span>;</div></pre></td></tr></table></figure>
<p>若要提高效率，可以考虑全文检索。</p>
<p>6、in 和 not in 也要慎用，否则会导致全表扫描，如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">in</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</div></pre></td></tr></table></figure>
<p>对于连续的数值，能用 between 就不要用 in 了：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">between</span> <span class="number">1</span> <span class="keyword">and</span> <span class="number">3</span>;</div></pre></td></tr></table></figure>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> xx,phone <span class="keyword">FROM</span> send  a <span class="keyword">JOIN</span> (</div><div class="line"> <span class="keyword">select</span> <span class="string">'13891030091'</span> phone  <span class="keyword">union</span> <span class="keyword">select</span> <span class="string">'13992085916'</span> …………  <span class="keyword">UNION</span>  <span class="keyword">SELECT</span> <span class="string">'13619100234'</span> ) b</div><div class="line">  <span class="keyword">on</span>  a.Phone=b.phone</div><div class="line"><span class="comment">--替代下面  很多数据隔开的时候</span></div><div class="line"><span class="keyword">in</span>(<span class="string">'13891030091'</span>,<span class="string">'13992085916'</span>,<span class="string">'13619100234'</span>…………)</div></pre></td></tr></table></figure>
<p>7、如果在 where 子句中使用参数，也会导致全表扫描。因为 SQL 只有在运行时才会解析局部变量，但优化程序不能将访问计划的选择到运行时；它必须在编译时进行选择。然而，如果在编译时简历访问计划，变量的值还是未知的，因而无法作为索引选择的输入项。如下面语句将进行全表扫描：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> = @<span class="keyword">num</span>;</div></pre></td></tr></table></figure>
<p>可以改为强制查询使用索引：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">with</span>(<span class="keyword">index</span>(索引名)) <span class="keyword">where</span> <span class="keyword">num</span> = @<span class="keyword">num</span>;</div></pre></td></tr></table></figure>
<p>8、应尽量避免在 where 子句中对字段进行表达式操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span>/<span class="number">2</span> = <span class="number">100</span>;</div></pre></td></tr></table></figure>
<p>应改为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">num</span> = <span class="number">100</span> * <span class="number">2</span>;</div></pre></td></tr></table></figure>
<p>9、应尽量避免在 where 子句中对字段进行函数操作，这将导致引擎放弃使用索引而进行全表扫描。如：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">substring</span>(<span class="keyword">name</span>, <span class="number">1</span>, <span class="number">3</span>) = ’abc’–<span class="keyword">name</span>;  //以abc开头的id</div><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">datediff</span>(<span class="keyword">day</span>,createdate,’<span class="number">2005</span><span class="number">-11</span><span class="number">-30</span>′) = <span class="number">0</span>–’<span class="number">2005</span><span class="number">-11</span><span class="number">-30</span>′;  //生成的id</div></pre></td></tr></table></figure>
<p>应改为:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="keyword">name</span> <span class="keyword">like</span> ‘abc%’</div><div class="line"><span class="keyword">select</span> <span class="keyword">id</span> <span class="keyword">from</span> t <span class="keyword">where</span> createdate &gt;= ’<span class="number">2005</span><span class="number">-11</span><span class="number">-30</span>′ <span class="keyword">and</span> createdate &lt; ’<span class="number">2005</span><span class="number">-12</span><span class="number">-1</span>′;</div></pre></td></tr></table></figure>
<p>10、不要在 where 子句中的 “=” 左边进行函数，算术运算或者其他表达式运算，否则系统将可能无法正确使用索引。</p>
<p>11、在使用索引字段作为条件时，如果该索引是复合索引，那么必须使用到该索引的第一个字段作为条件时才能保证系统使用该索引，否则该索引将不会被使用，并且应尽可能的让字段顺序与索引顺序相一致。</p>
<p>12、不要些一些没有意义的查询，如需要生成一个空表结构：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> col1,col2 <span class="keyword">into</span> #t <span class="keyword">from</span> t <span class="keyword">where</span> <span class="number">1</span>=<span class="number">0</span>;</div></pre></td></tr></table></figure>
<p>这类代码不会返回任何结果集，但是会消耗系统资源的，应改成这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">create</span> <span class="keyword">table</span> #t(…)</div></pre></td></tr></table></figure>
<p>13、很多时候用 exists 代替 in 是一个好的选择：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">num</span> <span class="keyword">from</span> a <span class="keyword">where</span> <span class="keyword">num</span> <span class="keyword">in</span>(<span class="keyword">select</span> <span class="keyword">num</span> <span class="keyword">from</span> b);</div></pre></td></tr></table></figure>
<p>用下面的语句替换：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">select</span> <span class="keyword">num</span> <span class="keyword">from</span> a <span class="keyword">where</span> <span class="keyword">exists</span>(<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> b <span class="keyword">where</span> <span class="keyword">num</span>=a.num);</div></pre></td></tr></table></figure>
<p>14、并不是所有索引对查询都有效，SQL是根据表中数据来进行查询优化的，当索引列有大量数据重复时，SQL查询可能不会去利用索引，如一表中有字段 sex，male、female几乎各一半，那么即使在sex上建了索引也对查询效率起不了作用。</p>
<p>15、索引并不是越多越好，索引固然可以提高相应的 select 的效率，但同时也降低了 insert 及 update 的效率，因为 insert 或 update 时有可能会重建索引，所以怎样建索引需要慎重考虑，视具体情况而定。一个表的索引数最好不要超过6个，若太多则应考虑一些不常使用到的列上建的索引是否有必要。</p>
<p>16、应尽可能的避免更新 clustered 索引数据列，因为 clustered 索引数据列的顺序就是表记录的物理存储顺序，一旦该列值改变将导致整个表记录的顺序的调整，会耗费相当大的资源。若应用系统需要频繁更新 clustered 索引数据列，那么需要考虑是否应将该索引建为 clustered 索引。</p>
<p>17、尽量使用数字型字段，若只含数值信息的字段尽量不要设计为字符型，这会降低查询和连接的性能，并会增加存储开销。这是因为引擎在处理查询和连接时会 逐个比较字符串中每一个字符，而对于数字型而言只需要比较一次就够了。</p>
<p>18、尽可能的使用 varchar/nvarchar 代替 char/nchar ，因为首先变长字段存储空间小，可以节省存储空间，其次对于查询来说，在一个相对较小的字段内搜索效率显然要高些。</p>
<p>19、任何地方都不要使用 <code>select * from t</code> ，用具体的字段列表代替 <code>*</code>，不要返回用不到的任何字段。</p>
<p>20、尽量使用表变量来代替临时表。如果表变量包含大量数据，请注意索引非常有限（只有主键索引）。</p>
<p>21、避免频繁创建和删除临时表，以减少系统表资源的消耗。</p>
<p>22、临时表并不是不可使用，适当地使用它们可以使某些例程更有效，例如，当需要重复引用大型表或常用表中的某个数据集时。但是，对于一次性事件，最好使用导出表。</p>
<p>23、在新建临时表时，如果一次性插入数据量很大，那么可以使用 select into 代替 create table，避免造成大量 log ，以提高速度；如果数据量不大，为了缓和系统表的资源，应先 create table，然后 insert。</p>
<p>24、如果使用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先 truncate table ，然后 drop table ，这样可以避免系统表的较长时间锁定。</p>
<p>25、尽量避免使用游标，因为游标的效率较差，如果游标操作的数据超过1万行，那么就应该考虑改写。</p>
<p>26、使用基于游标的方法或临时表方法之前，应先寻找基于集的解决方案来解决问题，基于集的方法通常更有效。</p>
<p>27、与临时表一样，游标并不是不可使用。对小型数据集使用 FAST_FORWARD 游标通常要优于其他逐行处理方法，尤其是在必须引用几个表才能获得所需的数据时。在结果集中包括“合计”的例程通常要比使用游标执行的速度快。如果开发时 间允许，基于游标的方法和基于集的方法都可以尝试一下，看哪一种方法的效果更好。</p>
<p>28、在所有的存储过程和触发器的开始处设置 SET NOCOUNT ON ，在结束时设置 SET NOCOUNT OFF 。无需在执行存储过程和触发器的每个语句后向客户端发送 DONE_IN_PROC 消息。</p>
<p>29、尽量避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。</p>
<p>30、尽量避免大事务操作，提高系统并发能力。</p>
]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在参与实际项目中，当 MySQL 表的数据量达到百万级时，普通的 SQL 查询效率呈直线下降，而且如果 where 中的查询条件较多时，其查询速度无法容忍。想想可知，假如我们查询淘宝的一个订单详情，如果查询时间高达几十秒，这么高的查询延时，任何用户都会抓狂。因此如何提高 SQL 语句查询效率，显得十分重要。&lt;br&gt;
    
    </summary>
    
    
      <category term="MySQL" scheme="http://yoursite.com/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>记录下自己第一次坐飞机的感受</title>
    <link href="http://yoursite.com/2017/04/23/feiji/"/>
    <id>http://yoursite.com/2017/04/23/feiji/</id>
    <published>2017-04-23T02:20:42.665Z</published>
    <updated>2017-06-13T10:41:34.449Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p>因为学校的原因，需要在大三的时候出去实训几个月，然后选择的是在昆山，公司规定要在 2017 年 4 月 19 号之前赶到，所以我提前订的机票是 17 号，之所以会订机票，其实很大一部分原因是由于自己之前没有坐过飞机，所以想体验一下坐飞机的感脚（嘿嘿），再加上这是机票的淡季，所以坐飞机的价钱比做高铁还便宜。整个行程：学校 ——&gt;  南昌机场 ——&gt;  上海虹桥机场 ——&gt;  公司</p>
<h3 id="学校出发"><a href="#学校出发" class="headerlink" title="学校出发"></a>学校出发</h3><p>10 点左右去食堂吃了个早餐，然后打包好自己的行李，由于第一次坐飞机，所以打算提前时间去机场，然后在机场熟悉熟悉环境，不然的话错过飞机，那就 gg 了。大概 11：30 了，就拖着行李出门，在学校门口叫了辆 滴滴车 去机场（因为公交车要坐好久并且去机场的路好烂），叫的滴滴车他走的是高速，很快。<br><a id="more"></a></p>
<h3 id="南昌机场"><a href="#南昌机场" class="headerlink" title="南昌机场"></a>南昌机场</h3><p>不到半小时就到了机场，首先干的事就是取票。</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/sp20170423_101429.jpg" alt=""></p>
<p>然后将行李箱免费托运（小于20公斤可免费托运，超过的话那就准备好 Money 吧），一个同行的同学就超重了。干完了这些事就没啥事了，然后就坐在凳子上看起了最近很火的电视剧《人民的名义》，的确很好看的，没看过的话，可以去看看。</p>
<p>大概 13：40 时，准备进站了，这里要说的就比较有趣了。我就具体的说下：</p>
<ul>
<li><p>一开始排队（人不多），轮到我，把机票和身份证给她，然后对着摄像头拍了个照就进去检查随身携带的物品了。</p>
</li>
<li><p>这里之前我就听说了：说是飞机上不能携带液体，不知道我书包带的洗发液能不能过关？同学和我之前还在一起开玩笑说：1、如果不能带，我就当场一口闷了它。（这也行，下图随意找了个表情包）<img src="data:image/jpeg;base64,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" alt=""></p>
<p>2、我免费请大家洗个头</p>
</li>
<li><p>电脑和雨伞而外检查</p>
</li>
<li><p>书包和随身携带物品都拿出来过安检</p>
</li>
<li><p>人扫描（检查的挺细致的，比火车严多了）</p>
</li>
<li><p>结果检查人员告知我：把 洗发液 和 两个螺丝刀 拿出来。（我当场就震惊了，我那么小的螺丝刀都被检查到了，这几乎把我的书包给透视了一个遍）</p>
<p><img src="https://encrypted-tbn0.gstatic.cn/images?q=tbn:ANd9GcSErzXLInCfeTtckRLSeur3xeBmOuEVbFY01v9te0TI7xg72BkGLQ" alt=""></p>
</li>
<li><p>然后呢，自己只好将违禁物品都拿出来，再次检查就可以通过了。</p>
</li>
<li><p>走进去的时候拍的一张照片, （电梯好长，不过后来在上海机场下车才发现那个也还好了）</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/sp20170423_101541.jpg" alt=""></p>
</li>
<li><p>进去后，又有一个小的进站室，又在那里等待了会。</p>
</li>
<li><p>又开始检票，检完票后坐公交车去飞机下面（因为飞机场太大，我坐的那架飞机不是靠近站台的）</p>
</li>
<li><p>上飞机后从窗口拍的一张照片</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/sp20170423_101559.jpg" alt=""></p>
</li>
</ul>
<h3 id="飞机上"><a href="#飞机上" class="headerlink" title="飞机上"></a>飞机上</h3><p>看见飞机的空姐和空少了。。（空姐很漂亮，嘻嘻，没拍照片）</p>
<p>飞机起飞的时候，机舱里有语音播放叫我们系上安全带，并且关闭手机，所以后面就没照片了。</p>
<p>起飞感觉走了好远，然后突然一加速，飞机就慢慢的向上飞起，整个人重心都是往后倒的。</p>
<p>不一会，飞机就飞的好高了，从窗口望下去，下面的感觉好美，一路上的风景感觉都挺漂亮的，有时还可以看到白云。</p>
<p>大概一个小时后，空姐推着个车，提供给我们点零食（面包、饼干、榨菜）和饮料（橙汁、苹果醋、矿泉水、咖啡，可自选一样，可再加一杯），服务还是挺贴心的，我在这里给中国东方航空点个赞。</p>
<p>飞机中途有时会颠簸，机舱里语音说是遇到空气气流的影响。（大部分时间还是很好的）</p>
<p>说说飞机下降的时候吧，同样，感觉声音很大，耳朵有点受不了。不知道空姐、空少们怎么长期受得了这这声音，长期下去，那估计耳朵都要出毛病的吧？</p>
<h3 id="上海虹桥机场"><a href="#上海虹桥机场" class="headerlink" title="上海虹桥机场"></a>上海虹桥机场</h3><p>机场给人的感觉很大，走了那个电梯都走了很远。</p>
<p><img src="http://ohfk1r827.bkt.clouddn.com/sp20170423_101524.jpg" alt=""></p>
<p>就只有一张照片。</p>
<p>然后再去取我的行李箱，有个专门来自南昌的取行李处，行李箱一个的放在传送带上，自己拿自己的行李出去。这里有个疑问，如果行李被别人提走的话，那该咋办，我看出口都没设置检查行李是否和本人的匹配？</p>
<h3 id="公司"><a href="#公司" class="headerlink" title="公司"></a>公司</h3><p>公司提前有大巴来接我们，坐上大巴，然后在车上躺了下，就睡着了，直到到达公司。</p>
<p>住宿地址和公司有点远，所以买了辆 死飞自行车，方便出行，自己周末也可以出去玩玩。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>第一次坐飞机，感觉还是挺好的。流程也不复杂，所以不麻烦。</p>
<p>不过自己要注意一些东西：</p>
<ul>
<li>不要携带飞机上违禁物品（液体、超过多大的充电宝、刀枪等）</li>
<li>一定要提前动身，以防发生突发事件</li>
<li>注意保管好自己的身份证</li>
</ul>
<h3 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h3><p>这是我在我博客上写的第一篇随笔文章，不知道咋写，就随便写。</p>
<p>因为星期六（昨天）出去玩了，所以今天早上起来写下来这篇，有些事还是得赶紧做掉去，不然一直拖，拖着拖着就没有想做的欲望了。</p>
<p>公司周围环境挺好的，水乡之地，有个阳澄湖，盛产大闸蟹，周围的大闸蟹庄，那叫一个字：<strong>多</strong>。有空的时候我尽量多去逛逛，拍点照片回来。</p>
<p>今后也会多写点随笔，记录生活中一些有趣且值得纪念的点滴。</p>
<p>感谢阅读！！！</p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前提&quot;&gt;&lt;a href=&quot;#前提&quot; class=&quot;headerlink&quot; title=&quot;前提&quot;&gt;&lt;/a&gt;前提&lt;/h3&gt;&lt;p&gt;因为学校的原因，需要在大三的时候出去实训几个月，然后选择的是在昆山，公司规定要在 2017 年 4 月 19 号之前赶到，所以我提前订的机票是 17 号，之所以会订机票，其实很大一部分原因是由于自己之前没有坐过飞机，所以想体验一下坐飞机的感脚（嘿嘿），再加上这是机票的淡季，所以坐飞机的价钱比做高铁还便宜。整个行程：学校 ——&amp;gt;  南昌机场 ——&amp;gt;  上海虹桥机场 ——&amp;gt;  公司&lt;/p&gt;
&lt;h3 id=&quot;学校出发&quot;&gt;&lt;a href=&quot;#学校出发&quot; class=&quot;headerlink&quot; title=&quot;学校出发&quot;&gt;&lt;/a&gt;学校出发&lt;/h3&gt;&lt;p&gt;10 点左右去食堂吃了个早餐，然后打包好自己的行李，由于第一次坐飞机，所以打算提前时间去机场，然后在机场熟悉熟悉环境，不然的话错过飞机，那就 gg 了。大概 11：30 了，就拖着行李出门，在学校门口叫了辆 滴滴车 去机场（因为公交车要坐好久并且去机场的路好烂），叫的滴滴车他走的是高速，很快。&lt;br&gt;
    
    </summary>
    
    
      <category term="随笔" scheme="http://yoursite.com/tags/%E9%9A%8F%E7%AC%94/"/>
    
  </entry>
  
  <entry>
    <title>Github pages + Hexo 博客 yilia 主题使用畅言评论系统</title>
    <link href="http://yoursite.com/2017/04/13/Hexo-yilia-changyan/"/>
    <id>http://yoursite.com/2017/04/13/Hexo-yilia-changyan/</id>
    <published>2017-04-13T14:38:53.710Z</published>
    <updated>2017-06-13T10:41:44.231Z</updated>
    
    <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Hexo的Yilia主题由于原来使用的是多说的留言板，近期<a href="http://dev.duoshuo.com/threads/58d1169ae293b89a20c57241" target="_blank" rel="external">多说公告要停止提供服务</a>了，所以我就把多说换成搜狐的畅言了，下面写一个简单的小教程。</p>
<p><img src="http://img.blog.csdn.net/20170413231005895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHpzXzEwNDEyMTgxMjk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="duoshuo"></p>
<h3 id="注册畅言"><a href="#注册畅言" class="headerlink" title="注册畅言"></a>注册畅言</h3><p>进入<a href="http://changyan.kuaizhan.com/" target="_blank" rel="external">畅言官网</a> , 点击右上角 “免费注册”，并填写注册信息。（注意域名需要备案信息）</p>
<a id="more"></a>
<h3 id="登录并进入畅言后台"><a href="#登录并进入畅言后台" class="headerlink" title="登录并进入畅言后台"></a>登录并进入畅言后台</h3><p>注册完后，登录进入畅言官网，获取你的畅言 <strong>app id</strong> 和 <strong>app key</strong>。</p>
<p><img src="http://img.blog.csdn.net/20170413231102348?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHpzXzEwNDEyMTgxMjk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="id"></p>
<h3 id="使用畅言系统"><a href="#使用畅言系统" class="headerlink" title="使用畅言系统"></a>使用畅言系统</h3><p>下面说下修改评论为<strong>畅言</strong>的方法，其实方法和多说是差不多的。</p>
<p>1、修改 <code>themes\yilia\layout\_partial\article.ejs</code> 模板，把如下代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&lt;% <span class="keyword">if</span> (!index &amp;&amp; post.comments &amp;&amp; config.disqus_shortname)&#123; %&gt;</div><div class="line"> <span class="xml"><span class="tag">&lt;<span class="name">section</span> <span class="attr">id</span>=<span class="string">"comments"</span>&gt;</span></span></div><div class="line">   <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"disqus_thread"</span>&gt;</span></div><div class="line">     这里还有很多代码</div><div class="line">   <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">section</span>&gt;</span></div><div class="line"> &lt;% &#125; %&gt;</div></pre></td></tr></table></figure>
<p>修改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> &lt;% if (!index &amp;&amp; post.comments)&#123; %&gt;</div><div class="line">  &lt;section id=&quot;comments&quot;&gt;</div><div class="line">&lt;!--高速版，加载速度快，使用前需测试页面的兼容性--&gt;</div><div class="line">&lt;div id=&quot;SOHUCS&quot; sid=&quot;&lt;%= page.title %&gt;&quot;&gt;&lt;/div&gt;</div><div class="line">&lt;script&gt;</div><div class="line">  (function()&#123;</div><div class="line">    var appid = &apos;你的APP ID&apos;,</div><div class="line">    conf = &apos;你的APP KEY&apos;;</div><div class="line">    var doc = document,</div><div class="line">    s = doc.createElement(&apos;script&apos;),</div><div class="line">    h = doc.getElementsByTagName(&apos;head&apos;)[0] || doc.head || doc.documentElement;</div><div class="line">    s.type = &apos;text/javascript&apos;;</div><div class="line">    s.charset = &apos;utf-8&apos;;</div><div class="line">    s.src =  &apos;http://assets.changyan.sohu.com/upload/changyan.js?conf=&apos;+ conf +&apos;&amp;appid=&apos; + appid;</div><div class="line">    h.insertBefore(s,h.firstChild);</div><div class="line">    window.SCS_NO_IFRAME = true;</div><div class="line">  &#125;)()</div><div class="line">&lt;/script&gt;</div><div class="line">  &lt;/section&gt;</div><div class="line">  &lt;% &#125; %&gt;</div></pre></td></tr></table></figure>
<p>上面的<code>APP ID</code>和<code>APP KEY</code>是在畅言设置中得到。</p>
<p>这里需要<strong>注意</strong>一点的是：<code>sid=&quot;&lt;%= page.title %&gt;&quot;&gt;</code> 这样的话畅言就可以直接根据对应的文章来识别，使得文章有对应的评论，不会都乱在一起。</p>
<p>2、在每篇文章开头的 front-matter 中添加一句<code>comments: true</code>，然后回到博客根目录执行命令 <code>hexo d -g</code> ，重新生成博客并部署博客，然后刷新，任选一篇文章进入下拉，会发现评论功能可以使用了。</p>
<p><img src="http://img.blog.csdn.net/20170413231216474?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHpzXzEwNDEyMTgxMjk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="comments"></p>
<h3 id="修改-BUG"><a href="#修改-BUG" class="headerlink" title="修改 BUG"></a>修改 BUG</h3><p>但是，这是你会发现一个 Bug，表情按钮点击不了，原因是被左侧的 div 层覆盖了，回到我们刚才改过的代码，找到 <code>&lt;div id=&quot;SOHUCS&quot;</code> 开头的一串代码。并做如下更改</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"SOHUCS"</span> <span class="attr">sid</span>=<span class="string">"&lt;%=title %&gt;"</span> <span class="attr">style</span>=<span class="string">"padding: 0px 30px 0px 46px;"</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
<p>加上上面这一段样式代码，即可修复。</p>
<hr>
<p>参考文章：</p>
<p>1、<a href="http://www.luck666.cn/2017/03/22/hexo-yilia-changyan/" target="_blank" rel="external">Hexo博客yilia主题更换畅言评论系统</a></p>
<p>2、<a href="http://www.lichanglin.cn/%E5%9C%A8Hexo%E4%B8%AD%E4%BD%BF%E7%94%A8%E7%95%85%E8%A8%80%E8%AF%84%E8%AE%BA%E7%B3%BB%E7%BB%9F/" target="_blank" rel="external">在Hexo中使用畅言评论系统</a></p>
]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;Hexo的Yilia主题由于原来使用的是多说的留言板，近期&lt;a href=&quot;http://dev.duoshuo.com/threads/58d1169ae293b89a20c57241&quot;&gt;多说公告要停止提供服务&lt;/a&gt;了，所以我就把多说换成搜狐的畅言了，下面写一个简单的小教程。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://img.blog.csdn.net/20170413231005895?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvdHpzXzEwNDEyMTgxMjk=/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast&quot; alt=&quot;duoshuo&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;注册畅言&quot;&gt;&lt;a href=&quot;#注册畅言&quot; class=&quot;headerlink&quot; title=&quot;注册畅言&quot;&gt;&lt;/a&gt;注册畅言&lt;/h3&gt;&lt;p&gt;进入&lt;a href=&quot;http://changyan.kuaizhan.com/&quot;&gt;畅言官网&lt;/a&gt; , 点击右上角 “免费注册”，并填写注册信息。（注意域名需要备案信息）&lt;/p&gt;
    
    </summary>
    
    
      <category term="hexo" scheme="http://yoursite.com/tags/hexo/"/>
    
      <category term="yilia" scheme="http://yoursite.com/tags/yilia/"/>
    
  </entry>
  
  <entry>
    <title>MyBatis的foreach语句详解</title>
    <link href="http://yoursite.com/2017/04/09/MyBatis-foreach/"/>
    <id>http://yoursite.com/2017/04/09/MyBatis-foreach/</id>
    <published>2017-04-09T12:11:33.627Z</published>
    <updated>2017-06-13T10:43:08.798Z</updated>
    
    <content type="html"><![CDATA[<p><strong>foreach</strong> 的主要用在构建in条件中，它可以在SQL语句中进行迭代一个集合。</p>
<p>foreach 元素的属性主要有 item，index，collection，open，separator，close。</p>
<ul>
<li><p>item 表示集合中每一个元素进行迭代时的别名，</p>
</li>
<li><p>index 指 定一个名字，用于表示在迭代过程中，每次迭代到的位置，</p>
</li>
<li><p>open 表示该语句以什么开始，</p>
</li>
<li><p>separator 表示在每次进行迭代之间以什么符号作为分隔 符，</p>
</li>
<li><p>close 表示以什么结束。</p>
</li>
</ul>
<p>在使用 foreach 的时候最关键的也是最容易出错的就是 collection 属性，该属性是必须指定的，但是在不同情况 下，该属性的值是不一样的，主要有一下3种情况：</p>
<ol>
<li>如果传入的是单参数且参数类型是一个List的时候，collection 属性值为 list</li>
<li>如果传入的是单参数且参数类型是一个 array 数组的时候，collection 的属性值为 array</li>
<li>如果传入的参数是多个的时候，我们就需要把它们封装成一个 Map 了，<strong>当然单参数也可以封装成map</strong>，实际上如果你在传入参数的时候，在 breast 里面也是会把它封装成一个 Map 的，map 的 key 就是参数名，所以这个时候 collection 属性值就是传入的 List 或 array 对象在自己封装的 map 里面的 key 。</li>
</ol>
<a id="more"></a>
<p>下面分别来看看上述三种情况的示例代码：</p>
<p>1.单参数 List 的类型： </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"dynamicForeachTest"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></div><div class="line">        select * from t_blog where id in</div><div class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">            #&#123;item&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上述 collection 的值为list，对应的 Mapper 是这样的 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;Blog&gt; <span class="title">dynamicForeachTest</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</div></pre></td></tr></table></figure>
<p>测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dynamicForeachTest</span><span class="params">()</span> </span>&#123;</div><div class="line">        SqlSession session = Util.getSqlSessionFactory().openSession();</div><div class="line">        BlogMapper blogMapper = session.getMapper(BlogMapper.class);</div><div class="line">        List&lt;Integer&gt; ids = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</div><div class="line">        ids.add(<span class="number">1</span>);</div><div class="line">        ids.add(<span class="number">3</span>);</div><div class="line">        ids.add(<span class="number">6</span>);</div><div class="line">        List&lt;Blog&gt; blogs = blogMapper.dynamicForeachTest(ids);</div><div class="line">        <span class="keyword">for</span> (Blog blog : blogs)</div><div class="line">            System.out.println(blog);</div><div class="line">        session.close();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>2.单参数array数组的类型：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"dynamicForeach2Test"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></div><div class="line">        select * from t_blog where id in</div><div class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"array"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">            #&#123;item&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上述collection为array，对应的Mapper代码： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">public List&lt;Blog&gt; dynamicForeach2Test(int[] ids);</div></pre></td></tr></table></figure>
<p>对应的测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dynamicForeach2Test</span><span class="params">()</span> </span>&#123;</div><div class="line">        SqlSession session = Util.getSqlSessionFactory().openSession();</div><div class="line">        BlogMapper blogMapper = session.getMapper(BlogMapper.class);</div><div class="line">        <span class="keyword">int</span>[] ids = <span class="keyword">new</span> <span class="keyword">int</span>[] &#123;<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">9</span>&#125;;</div><div class="line">        List&lt;Blog&gt; blogs = blogMapper.dynamicForeach2Test(ids);</div><div class="line">        <span class="keyword">for</span> (Blog blog : blogs)</div><div class="line">            System.out.println(blog);</div><div class="line">        session.close();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>3.自己把参数封装成Map的类型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"dynamicForeach3Test"</span> <span class="attr">resultType</span>=<span class="string">"Blog"</span>&gt;</span></div><div class="line">        select * from t_blog where title like "%"#&#123;title&#125;"%" and id in</div><div class="line">        <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"ids"</span> <span class="attr">index</span>=<span class="string">"index"</span> <span class="attr">item</span>=<span class="string">"item"</span> <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span></div><div class="line">            #&#123;item&#125;</div><div class="line">        <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<p>上述collection的值为ids，是传入的参数Map的key，对应的Mapper代码： </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;Blog&gt; <span class="title">dynamicForeach3Test</span><span class="params">(Map&lt;String, Object&gt; params)</span></span>;</div></pre></td></tr></table></figure>
<p>对应测试代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">dynamicForeach3Test</span><span class="params">()</span> </span>&#123;</div><div class="line">        SqlSession session = Util.getSqlSessionFactory().openSession();</div><div class="line">        BlogMapper blogMapper = session.getMapper(BlogMapper.class);</div><div class="line">        <span class="keyword">final</span> List&lt;Integer&gt; ids = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</div><div class="line">        ids.add(<span class="number">1</span>);</div><div class="line">        ids.add(<span class="number">2</span>);</div><div class="line">        ids.add(<span class="number">3</span>);</div><div class="line">        ids.add(<span class="number">6</span>);</div><div class="line">        ids.add(<span class="number">7</span>);</div><div class="line">        ids.add(<span class="number">9</span>);</div><div class="line">        Map&lt;String, Object&gt; params = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</div><div class="line">        params.put(<span class="string">"ids"</span>, ids);</div><div class="line">        params.put(<span class="string">"title"</span>, <span class="string">"中国"</span>);</div><div class="line">        List&lt;Blog&gt; blogs = blogMapper.dynamicForeach3Test(params);</div><div class="line">        <span class="keyword">for</span> (Blog blog : blogs)</div><div class="line">            System.out.println(blog);</div><div class="line">        session.close();</div><div class="line">    &#125;</div></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;foreach&lt;/strong&gt; 的主要用在构建in条件中，它可以在SQL语句中进行迭代一个集合。&lt;/p&gt;
&lt;p&gt;foreach 元素的属性主要有 item，index，collection，open，separator，close。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;item 表示集合中每一个元素进行迭代时的别名，&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;index 指 定一个名字，用于表示在迭代过程中，每次迭代到的位置，&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;open 表示该语句以什么开始，&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;separator 表示在每次进行迭代之间以什么符号作为分隔 符，&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;close 表示以什么结束。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在使用 foreach 的时候最关键的也是最容易出错的就是 collection 属性，该属性是必须指定的，但是在不同情况 下，该属性的值是不一样的，主要有一下3种情况：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;如果传入的是单参数且参数类型是一个List的时候，collection 属性值为 list&lt;/li&gt;
&lt;li&gt;如果传入的是单参数且参数类型是一个 array 数组的时候，collection 的属性值为 array&lt;/li&gt;
&lt;li&gt;如果传入的参数是多个的时候，我们就需要把它们封装成一个 Map 了，&lt;strong&gt;当然单参数也可以封装成map&lt;/strong&gt;，实际上如果你在传入参数的时候，在 breast 里面也是会把它封装成一个 Map 的，map 的 key 就是参数名，所以这个时候 collection 属性值就是传入的 List 或 array 对象在自己封装的 map 里面的 key 。&lt;/li&gt;
&lt;/ol&gt;
    
    </summary>
    
    
      <category term="Mybatis" scheme="http://yoursite.com/tags/Mybatis/"/>
    
      <category term="foreach" scheme="http://yoursite.com/tags/foreach/"/>
    
  </entry>
  
</feed>
